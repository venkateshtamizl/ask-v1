{"ast":null,"code":"\"use strict\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n  return _typeof(obj);\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n  return _assertThisInitialized(self);\n}\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n  return self;\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\nvar EventEmitter = require('events').EventEmitter;\nvar Logger = require('./Logger');\nvar JsSIP_C = require('./Constants');\nvar SIPMessage = require('./SIPMessage');\nvar Timers = require('./Timers');\nvar loggernict = new Logger('NonInviteClientTransaction');\nvar loggerict = new Logger('InviteClientTransaction');\nvar loggeract = new Logger('AckClientTransaction');\nvar loggernist = new Logger('NonInviteServerTransaction');\nvar loggerist = new Logger('InviteServerTransaction');\nvar C = {\n  // Transaction states.\n  STATUS_TRYING: 1,\n  STATUS_PROCEEDING: 2,\n  STATUS_CALLING: 3,\n  STATUS_ACCEPTED: 4,\n  STATUS_COMPLETED: 5,\n  STATUS_TERMINATED: 6,\n  STATUS_CONFIRMED: 7,\n  // Transaction types.\n  NON_INVITE_CLIENT: 'nict',\n  NON_INVITE_SERVER: 'nist',\n  INVITE_CLIENT: 'ict',\n  INVITE_SERVER: 'ist'\n};\nvar NonInviteClientTransaction = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(NonInviteClientTransaction, _EventEmitter);\n  var _super = _createSuper(NonInviteClientTransaction);\n  function NonInviteClientTransaction(ua, transport, request, eventHandlers) {\n    var _this;\n    _classCallCheck(this, NonInviteClientTransaction);\n    _this = _super.call(this);\n    _this.type = C.NON_INVITE_CLIENT;\n    _this.id = \"z9hG4bK\".concat(Math.floor(Math.random() * 10000000));\n    _this.ua = ua;\n    _this.transport = transport;\n    _this.request = request;\n    _this.eventHandlers = eventHandlers;\n    var via = \"SIP/2.0/\".concat(transport.via_transport);\n    via += \" \".concat(ua.configuration.via_host, \";branch=\").concat(_this.id);\n    _this.request.setHeader('via', via);\n    _this.ua.newTransaction(_assertThisInitialized(_this));\n    return _this;\n  }\n  _createClass(NonInviteClientTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"send\",\n    value: function send() {\n      var _this2 = this;\n      this.stateChanged(C.STATUS_TRYING);\n      this.F = setTimeout(function () {\n        _this2.timer_F();\n      }, Timers.TIMER_F);\n      if (!this.transport.send(this.request)) {\n        this.onTransportError();\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      loggernict.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n      clearTimeout(this.F);\n      clearTimeout(this.K);\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n      this.eventHandlers.onTransportError();\n    }\n  }, {\n    key: \"timer_F\",\n    value: function timer_F() {\n      loggernict.debug(\"Timer F expired for transaction \".concat(this.id));\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n      this.eventHandlers.onRequestTimeout();\n    }\n  }, {\n    key: \"timer_K\",\n    value: function timer_K() {\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(response) {\n      var _this3 = this;\n      var status_code = response.status_code;\n      if (status_code < 200) {\n        switch (this.state) {\n          case C.STATUS_TRYING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_PROCEEDING);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n        }\n      } else {\n        switch (this.state) {\n          case C.STATUS_TRYING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_COMPLETED);\n            clearTimeout(this.F);\n            if (status_code === 408) {\n              this.eventHandlers.onRequestTimeout();\n            } else {\n              this.eventHandlers.onReceiveResponse(response);\n            }\n            this.K = setTimeout(function () {\n              _this3.timer_K();\n            }, Timers.TIMER_K);\n            break;\n          case C.STATUS_COMPLETED:\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n  return NonInviteClientTransaction;\n}(EventEmitter);\nvar InviteClientTransaction = /*#__PURE__*/function (_EventEmitter2) {\n  _inherits(InviteClientTransaction, _EventEmitter2);\n  var _super2 = _createSuper(InviteClientTransaction);\n  function InviteClientTransaction(ua, transport, request, eventHandlers) {\n    var _this4;\n    _classCallCheck(this, InviteClientTransaction);\n    _this4 = _super2.call(this);\n    _this4.type = C.INVITE_CLIENT;\n    _this4.id = \"z9hG4bK\".concat(Math.floor(Math.random() * 10000000));\n    _this4.ua = ua;\n    _this4.transport = transport;\n    _this4.request = request;\n    _this4.eventHandlers = eventHandlers;\n    request.transaction = _assertThisInitialized(_this4);\n    var via = \"SIP/2.0/\".concat(transport.via_transport);\n    via += \" \".concat(ua.configuration.via_host, \";branch=\").concat(_this4.id);\n    _this4.request.setHeader('via', via);\n    _this4.ua.newTransaction(_assertThisInitialized(_this4));\n    return _this4;\n  }\n  _createClass(InviteClientTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"send\",\n    value: function send() {\n      var _this5 = this;\n      this.stateChanged(C.STATUS_CALLING);\n      this.B = setTimeout(function () {\n        _this5.timer_B();\n      }, Timers.TIMER_B);\n      if (!this.transport.send(this.request)) {\n        this.onTransportError();\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      clearTimeout(this.B);\n      clearTimeout(this.D);\n      clearTimeout(this.M);\n      if (this.state !== C.STATUS_ACCEPTED) {\n        loggerict.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n        this.eventHandlers.onTransportError();\n      }\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    } // RFC 6026 7.2.\n  }, {\n    key: \"timer_M\",\n    value: function timer_M() {\n      loggerict.debug(\"Timer M expired for transaction \".concat(this.id));\n      if (this.state === C.STATUS_ACCEPTED) {\n        clearTimeout(this.B);\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    } // RFC 3261 17.1.1.\n  }, {\n    key: \"timer_B\",\n    value: function timer_B() {\n      loggerict.debug(\"Timer B expired for transaction \".concat(this.id));\n      if (this.state === C.STATUS_CALLING) {\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n        this.eventHandlers.onRequestTimeout();\n      }\n    }\n  }, {\n    key: \"timer_D\",\n    value: function timer_D() {\n      loggerict.debug(\"Timer D expired for transaction \".concat(this.id));\n      clearTimeout(this.B);\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"sendACK\",\n    value: function sendACK(response) {\n      var _this6 = this;\n      var ack = new SIPMessage.OutgoingRequest(JsSIP_C.ACK, this.request.ruri, this.ua, {\n        'route_set': this.request.getHeaders('route'),\n        'call_id': this.request.getHeader('call-id'),\n        'cseq': this.request.cseq\n      });\n      ack.setHeader('from', this.request.getHeader('from'));\n      ack.setHeader('via', this.request.getHeader('via'));\n      ack.setHeader('to', response.getHeader('to'));\n      this.D = setTimeout(function () {\n        _this6.timer_D();\n      }, Timers.TIMER_D);\n      this.transport.send(ack);\n    }\n  }, {\n    key: \"cancel\",\n    value: function cancel(reason) {\n      // Send only if a provisional response (>100) has been received.\n      if (this.state !== C.STATUS_PROCEEDING) {\n        return;\n      }\n      var cancel = new SIPMessage.OutgoingRequest(JsSIP_C.CANCEL, this.request.ruri, this.ua, {\n        'route_set': this.request.getHeaders('route'),\n        'call_id': this.request.getHeader('call-id'),\n        'cseq': this.request.cseq\n      });\n      cancel.setHeader('from', this.request.getHeader('from'));\n      cancel.setHeader('via', this.request.getHeader('via'));\n      cancel.setHeader('to', this.request.getHeader('to'));\n      if (reason) {\n        cancel.setHeader('reason', reason);\n      }\n      this.transport.send(cancel);\n    }\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(response) {\n      var _this7 = this;\n      var status_code = response.status_code;\n      if (status_code >= 100 && status_code <= 199) {\n        switch (this.state) {\n          case C.STATUS_CALLING:\n            this.stateChanged(C.STATUS_PROCEEDING);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n          case C.STATUS_PROCEEDING:\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n        }\n      } else if (status_code >= 200 && status_code <= 299) {\n        switch (this.state) {\n          case C.STATUS_CALLING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_ACCEPTED);\n            this.M = setTimeout(function () {\n              _this7.timer_M();\n            }, Timers.TIMER_M);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n          case C.STATUS_ACCEPTED:\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n        }\n      } else if (status_code >= 300 && status_code <= 699) {\n        switch (this.state) {\n          case C.STATUS_CALLING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_COMPLETED);\n            this.sendACK(response);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n          case C.STATUS_COMPLETED:\n            this.sendACK(response);\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n  return InviteClientTransaction;\n}(EventEmitter);\nvar AckClientTransaction = /*#__PURE__*/function (_EventEmitter3) {\n  _inherits(AckClientTransaction, _EventEmitter3);\n  var _super3 = _createSuper(AckClientTransaction);\n  function AckClientTransaction(ua, transport, request, eventHandlers) {\n    var _this8;\n    _classCallCheck(this, AckClientTransaction);\n    _this8 = _super3.call(this);\n    _this8.id = \"z9hG4bK\".concat(Math.floor(Math.random() * 10000000));\n    _this8.transport = transport;\n    _this8.request = request;\n    _this8.eventHandlers = eventHandlers;\n    var via = \"SIP/2.0/\".concat(transport.via_transport);\n    via += \" \".concat(ua.configuration.via_host, \";branch=\").concat(_this8.id);\n    _this8.request.setHeader('via', via);\n    return _this8;\n  }\n  _createClass(AckClientTransaction, [{\n    key: \"send\",\n    value: function send() {\n      if (!this.transport.send(this.request)) {\n        this.onTransportError();\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      loggeract.debug(\"transport error occurred for transaction \".concat(this.id));\n      this.eventHandlers.onTransportError();\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n  return AckClientTransaction;\n}(EventEmitter);\nvar NonInviteServerTransaction = /*#__PURE__*/function (_EventEmitter4) {\n  _inherits(NonInviteServerTransaction, _EventEmitter4);\n  var _super4 = _createSuper(NonInviteServerTransaction);\n  function NonInviteServerTransaction(ua, transport, request) {\n    var _this9;\n    _classCallCheck(this, NonInviteServerTransaction);\n    _this9 = _super4.call(this);\n    _this9.type = C.NON_INVITE_SERVER;\n    _this9.id = request.via_branch;\n    _this9.ua = ua;\n    _this9.transport = transport;\n    _this9.request = request;\n    _this9.last_response = '';\n    request.server_transaction = _assertThisInitialized(_this9);\n    _this9.state = C.STATUS_TRYING;\n    ua.newTransaction(_assertThisInitialized(_this9));\n    return _this9;\n  }\n  _createClass(NonInviteServerTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"timer_J\",\n    value: function timer_J() {\n      loggernist.debug(\"Timer J expired for transaction \".concat(this.id));\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      if (!this.transportError) {\n        this.transportError = true;\n        loggernist.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n        clearTimeout(this.J);\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    }\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(status_code, response, onSuccess, onFailure) {\n      var _this10 = this;\n      if (status_code === 100) {\n        /* RFC 4320 4.1\n         * 'A SIP element MUST NOT\n         * send any provisional response with a\n         * Status-Code other than 100 to a non-INVITE request.'\n         */\n        switch (this.state) {\n          case C.STATUS_TRYING:\n            this.stateChanged(C.STATUS_PROCEEDING);\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n            }\n            break;\n          case C.STATUS_PROCEEDING:\n            this.last_response = response;\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n              if (onFailure) {\n                onFailure();\n              }\n            } else if (onSuccess) {\n              onSuccess();\n            }\n            break;\n        }\n      } else if (status_code >= 200 && status_code <= 699) {\n        switch (this.state) {\n          case C.STATUS_TRYING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_COMPLETED);\n            this.last_response = response;\n            this.J = setTimeout(function () {\n              _this10.timer_J();\n            }, Timers.TIMER_J);\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n              if (onFailure) {\n                onFailure();\n              }\n            } else if (onSuccess) {\n              onSuccess();\n            }\n            break;\n          case C.STATUS_COMPLETED:\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n  return NonInviteServerTransaction;\n}(EventEmitter);\nvar InviteServerTransaction = /*#__PURE__*/function (_EventEmitter5) {\n  _inherits(InviteServerTransaction, _EventEmitter5);\n  var _super5 = _createSuper(InviteServerTransaction);\n  function InviteServerTransaction(ua, transport, request) {\n    var _this11;\n    _classCallCheck(this, InviteServerTransaction);\n    _this11 = _super5.call(this);\n    _this11.type = C.INVITE_SERVER;\n    _this11.id = request.via_branch;\n    _this11.ua = ua;\n    _this11.transport = transport;\n    _this11.request = request;\n    _this11.last_response = '';\n    request.server_transaction = _assertThisInitialized(_this11);\n    _this11.state = C.STATUS_PROCEEDING;\n    ua.newTransaction(_assertThisInitialized(_this11));\n    _this11.resendProvisionalTimer = null;\n    request.reply(100);\n    return _this11;\n  }\n  _createClass(InviteServerTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"timer_H\",\n    value: function timer_H() {\n      loggerist.debug(\"Timer H expired for transaction \".concat(this.id));\n      if (this.state === C.STATUS_COMPLETED) {\n        loggerist.debug('ACK not received, dialog will be terminated');\n      }\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"timer_I\",\n    value: function timer_I() {\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    } // RFC 6026 7.1.\n  }, {\n    key: \"timer_L\",\n    value: function timer_L() {\n      loggerist.debug(\"Timer L expired for transaction \".concat(this.id));\n      if (this.state === C.STATUS_ACCEPTED) {\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      if (!this.transportError) {\n        this.transportError = true;\n        loggerist.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n        if (this.resendProvisionalTimer !== null) {\n          clearInterval(this.resendProvisionalTimer);\n          this.resendProvisionalTimer = null;\n        }\n        clearTimeout(this.L);\n        clearTimeout(this.H);\n        clearTimeout(this.I);\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    }\n  }, {\n    key: \"resend_provisional\",\n    value: function resend_provisional() {\n      if (!this.transport.send(this.last_response)) {\n        this.onTransportError();\n      }\n    } // INVITE Server Transaction RFC 3261 17.2.1.\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(status_code, response, onSuccess, onFailure) {\n      var _this12 = this;\n      if (status_code >= 100 && status_code <= 199) {\n        switch (this.state) {\n          case C.STATUS_PROCEEDING:\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n            }\n            this.last_response = response;\n            break;\n        }\n      }\n      if (status_code > 100 && status_code <= 199 && this.state === C.STATUS_PROCEEDING) {\n        // Trigger the resendProvisionalTimer only for the first non 100 provisional response.\n        if (this.resendProvisionalTimer === null) {\n          this.resendProvisionalTimer = setInterval(function () {\n            _this12.resend_provisional();\n          }, Timers.PROVISIONAL_RESPONSE_INTERVAL);\n        }\n      } else if (status_code >= 200 && status_code <= 299) {\n        switch (this.state) {\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_ACCEPTED);\n            this.last_response = response;\n            this.L = setTimeout(function () {\n              _this12.timer_L();\n            }, Timers.TIMER_L);\n            if (this.resendProvisionalTimer !== null) {\n              clearInterval(this.resendProvisionalTimer);\n              this.resendProvisionalTimer = null;\n            }\n\n          /* falls through */\n\n          case C.STATUS_ACCEPTED:\n            // Note that this point will be reached for proceeding this.state also.\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n              if (onFailure) {\n                onFailure();\n              }\n            } else if (onSuccess) {\n              onSuccess();\n            }\n            break;\n        }\n      } else if (status_code >= 300 && status_code <= 699) {\n        switch (this.state) {\n          case C.STATUS_PROCEEDING:\n            if (this.resendProvisionalTimer !== null) {\n              clearInterval(this.resendProvisionalTimer);\n              this.resendProvisionalTimer = null;\n            }\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n              if (onFailure) {\n                onFailure();\n              }\n            } else {\n              this.stateChanged(C.STATUS_COMPLETED);\n              this.H = setTimeout(function () {\n                _this12.timer_H();\n              }, Timers.TIMER_H);\n              if (onSuccess) {\n                onSuccess();\n              }\n            }\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n  return InviteServerTransaction;\n}(EventEmitter);\n/**\n * INVITE:\n *  _true_ if retransmission\n *  _false_ new request\n *\n * ACK:\n *  _true_  ACK to non2xx response\n *  _false_ ACK must be passed to TU (accepted state)\n *          ACK to 2xx response\n *\n * CANCEL:\n *  _true_  no matching invite transaction\n *  _false_ matching invite transaction and no final response sent\n *\n * OTHER:\n *  _true_  retransmission\n *  _false_ new request\n */\n\nfunction checkTransaction(_ref, request) {\n  var _transactions = _ref._transactions;\n  var tr;\n  switch (request.method) {\n    case JsSIP_C.INVITE:\n      tr = _transactions.ist[request.via_branch];\n      if (tr) {\n        switch (tr.state) {\n          case C.STATUS_PROCEEDING:\n            tr.transport.send(tr.last_response);\n            break;\n          // RFC 6026 7.1 Invite retransmission.\n          // Received while in C.STATUS_ACCEPTED state. Absorb it.\n\n          case C.STATUS_ACCEPTED:\n            break;\n        }\n        return true;\n      }\n      break;\n    case JsSIP_C.ACK:\n      tr = _transactions.ist[request.via_branch]; // RFC 6026 7.1.\n\n      if (tr) {\n        if (tr.state === C.STATUS_ACCEPTED) {\n          return false;\n        } else if (tr.state === C.STATUS_COMPLETED) {\n          tr.state = C.STATUS_CONFIRMED;\n          tr.I = setTimeout(function () {\n            tr.timer_I();\n          }, Timers.TIMER_I);\n          return true;\n        }\n      } // ACK to 2XX Response.\n      else {\n        return false;\n      }\n      break;\n    case JsSIP_C.CANCEL:\n      tr = _transactions.ist[request.via_branch];\n      if (tr) {\n        request.reply_sl(200);\n        if (tr.state === C.STATUS_PROCEEDING) {\n          return false;\n        } else {\n          return true;\n        }\n      } else {\n        request.reply_sl(481);\n        return true;\n      }\n    default:\n      // Non-INVITE Server Transaction RFC 3261 17.2.2.\n      tr = _transactions.nist[request.via_branch];\n      if (tr) {\n        switch (tr.state) {\n          case C.STATUS_TRYING:\n            break;\n          case C.STATUS_PROCEEDING:\n          case C.STATUS_COMPLETED:\n            tr.transport.send(tr.last_response);\n            break;\n        }\n        return true;\n      }\n      break;\n  }\n}\nmodule.exports = {\n  C: C,\n  NonInviteClientTransaction: NonInviteClientTransaction,\n  InviteClientTransaction: InviteClientTransaction,\n  AckClientTransaction: AckClientTransaction,\n  NonInviteServerTransaction: NonInviteServerTransaction,\n  InviteServerTransaction: InviteServerTransaction,\n  checkTransaction: checkTransaction\n};","map":{"version":3,"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","_inherits","subClass","superClass","create","value","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","arguments","apply","_possibleConstructorReturn","self","call","_assertThisInitialized","ReferenceError","sham","Proxy","Date","toString","e","getPrototypeOf","EventEmitter","require","Logger","JsSIP_C","SIPMessage","Timers","loggernict","loggerict","loggeract","loggernist","loggerist","C","STATUS_TRYING","STATUS_PROCEEDING","STATUS_CALLING","STATUS_ACCEPTED","STATUS_COMPLETED","STATUS_TERMINATED","STATUS_CONFIRMED","NON_INVITE_CLIENT","NON_INVITE_SERVER","INVITE_CLIENT","INVITE_SERVER","NonInviteClientTransaction","_EventEmitter","_super","ua","transport","request","eventHandlers","_this","type","id","concat","Math","floor","random","via","via_transport","configuration","via_host","setHeader","newTransaction","stateChanged","state","emit","send","_this2","F","setTimeout","timer_F","TIMER_F","onTransportError","debug","clearTimeout","K","destroyTransaction","onRequestTimeout","timer_K","receiveResponse","response","_this3","status_code","onReceiveResponse","TIMER_K","get","InviteClientTransaction","_EventEmitter2","_super2","_this4","transaction","_this5","B","timer_B","TIMER_B","D","M","timer_M","timer_D","sendACK","_this6","ack","OutgoingRequest","ACK","ruri","getHeaders","getHeader","cseq","TIMER_D","cancel","reason","CANCEL","_this7","TIMER_M","AckClientTransaction","_EventEmitter3","_super3","_this8","NonInviteServerTransaction","_EventEmitter4","_super4","_this9","via_branch","last_response","server_transaction","timer_J","transportError","J","onSuccess","onFailure","_this10","TIMER_J","InviteServerTransaction","_EventEmitter5","_super5","_this11","resendProvisionalTimer","reply","timer_H","timer_I","timer_L","clearInterval","L","H","I","resend_provisional","_this12","setInterval","PROVISIONAL_RESPONSE_INTERVAL","TIMER_L","TIMER_H","checkTransaction","_ref","_transactions","tr","method","INVITE","ist","TIMER_I","reply_sl","nist","module","exports"],"sources":["/etc/asterisk/webrtc-phone/node_modules/jssip/lib-es5/Transactions.js"],"sourcesContent":["\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar Logger = require('./Logger');\n\nvar JsSIP_C = require('./Constants');\n\nvar SIPMessage = require('./SIPMessage');\n\nvar Timers = require('./Timers');\n\nvar loggernict = new Logger('NonInviteClientTransaction');\nvar loggerict = new Logger('InviteClientTransaction');\nvar loggeract = new Logger('AckClientTransaction');\nvar loggernist = new Logger('NonInviteServerTransaction');\nvar loggerist = new Logger('InviteServerTransaction');\nvar C = {\n  // Transaction states.\n  STATUS_TRYING: 1,\n  STATUS_PROCEEDING: 2,\n  STATUS_CALLING: 3,\n  STATUS_ACCEPTED: 4,\n  STATUS_COMPLETED: 5,\n  STATUS_TERMINATED: 6,\n  STATUS_CONFIRMED: 7,\n  // Transaction types.\n  NON_INVITE_CLIENT: 'nict',\n  NON_INVITE_SERVER: 'nist',\n  INVITE_CLIENT: 'ict',\n  INVITE_SERVER: 'ist'\n};\n\nvar NonInviteClientTransaction = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(NonInviteClientTransaction, _EventEmitter);\n\n  var _super = _createSuper(NonInviteClientTransaction);\n\n  function NonInviteClientTransaction(ua, transport, request, eventHandlers) {\n    var _this;\n\n    _classCallCheck(this, NonInviteClientTransaction);\n\n    _this = _super.call(this);\n    _this.type = C.NON_INVITE_CLIENT;\n    _this.id = \"z9hG4bK\".concat(Math.floor(Math.random() * 10000000));\n    _this.ua = ua;\n    _this.transport = transport;\n    _this.request = request;\n    _this.eventHandlers = eventHandlers;\n    var via = \"SIP/2.0/\".concat(transport.via_transport);\n    via += \" \".concat(ua.configuration.via_host, \";branch=\").concat(_this.id);\n\n    _this.request.setHeader('via', via);\n\n    _this.ua.newTransaction(_assertThisInitialized(_this));\n\n    return _this;\n  }\n\n  _createClass(NonInviteClientTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"send\",\n    value: function send() {\n      var _this2 = this;\n\n      this.stateChanged(C.STATUS_TRYING);\n      this.F = setTimeout(function () {\n        _this2.timer_F();\n      }, Timers.TIMER_F);\n\n      if (!this.transport.send(this.request)) {\n        this.onTransportError();\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      loggernict.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n      clearTimeout(this.F);\n      clearTimeout(this.K);\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n      this.eventHandlers.onTransportError();\n    }\n  }, {\n    key: \"timer_F\",\n    value: function timer_F() {\n      loggernict.debug(\"Timer F expired for transaction \".concat(this.id));\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n      this.eventHandlers.onRequestTimeout();\n    }\n  }, {\n    key: \"timer_K\",\n    value: function timer_K() {\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(response) {\n      var _this3 = this;\n\n      var status_code = response.status_code;\n\n      if (status_code < 200) {\n        switch (this.state) {\n          case C.STATUS_TRYING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_PROCEEDING);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n        }\n      } else {\n        switch (this.state) {\n          case C.STATUS_TRYING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_COMPLETED);\n            clearTimeout(this.F);\n\n            if (status_code === 408) {\n              this.eventHandlers.onRequestTimeout();\n            } else {\n              this.eventHandlers.onReceiveResponse(response);\n            }\n\n            this.K = setTimeout(function () {\n              _this3.timer_K();\n            }, Timers.TIMER_K);\n            break;\n\n          case C.STATUS_COMPLETED:\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return NonInviteClientTransaction;\n}(EventEmitter);\n\nvar InviteClientTransaction = /*#__PURE__*/function (_EventEmitter2) {\n  _inherits(InviteClientTransaction, _EventEmitter2);\n\n  var _super2 = _createSuper(InviteClientTransaction);\n\n  function InviteClientTransaction(ua, transport, request, eventHandlers) {\n    var _this4;\n\n    _classCallCheck(this, InviteClientTransaction);\n\n    _this4 = _super2.call(this);\n    _this4.type = C.INVITE_CLIENT;\n    _this4.id = \"z9hG4bK\".concat(Math.floor(Math.random() * 10000000));\n    _this4.ua = ua;\n    _this4.transport = transport;\n    _this4.request = request;\n    _this4.eventHandlers = eventHandlers;\n    request.transaction = _assertThisInitialized(_this4);\n    var via = \"SIP/2.0/\".concat(transport.via_transport);\n    via += \" \".concat(ua.configuration.via_host, \";branch=\").concat(_this4.id);\n\n    _this4.request.setHeader('via', via);\n\n    _this4.ua.newTransaction(_assertThisInitialized(_this4));\n\n    return _this4;\n  }\n\n  _createClass(InviteClientTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"send\",\n    value: function send() {\n      var _this5 = this;\n\n      this.stateChanged(C.STATUS_CALLING);\n      this.B = setTimeout(function () {\n        _this5.timer_B();\n      }, Timers.TIMER_B);\n\n      if (!this.transport.send(this.request)) {\n        this.onTransportError();\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      clearTimeout(this.B);\n      clearTimeout(this.D);\n      clearTimeout(this.M);\n\n      if (this.state !== C.STATUS_ACCEPTED) {\n        loggerict.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n        this.eventHandlers.onTransportError();\n      }\n\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    } // RFC 6026 7.2.\n\n  }, {\n    key: \"timer_M\",\n    value: function timer_M() {\n      loggerict.debug(\"Timer M expired for transaction \".concat(this.id));\n\n      if (this.state === C.STATUS_ACCEPTED) {\n        clearTimeout(this.B);\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    } // RFC 3261 17.1.1.\n\n  }, {\n    key: \"timer_B\",\n    value: function timer_B() {\n      loggerict.debug(\"Timer B expired for transaction \".concat(this.id));\n\n      if (this.state === C.STATUS_CALLING) {\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n        this.eventHandlers.onRequestTimeout();\n      }\n    }\n  }, {\n    key: \"timer_D\",\n    value: function timer_D() {\n      loggerict.debug(\"Timer D expired for transaction \".concat(this.id));\n      clearTimeout(this.B);\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"sendACK\",\n    value: function sendACK(response) {\n      var _this6 = this;\n\n      var ack = new SIPMessage.OutgoingRequest(JsSIP_C.ACK, this.request.ruri, this.ua, {\n        'route_set': this.request.getHeaders('route'),\n        'call_id': this.request.getHeader('call-id'),\n        'cseq': this.request.cseq\n      });\n      ack.setHeader('from', this.request.getHeader('from'));\n      ack.setHeader('via', this.request.getHeader('via'));\n      ack.setHeader('to', response.getHeader('to'));\n      this.D = setTimeout(function () {\n        _this6.timer_D();\n      }, Timers.TIMER_D);\n      this.transport.send(ack);\n    }\n  }, {\n    key: \"cancel\",\n    value: function cancel(reason) {\n      // Send only if a provisional response (>100) has been received.\n      if (this.state !== C.STATUS_PROCEEDING) {\n        return;\n      }\n\n      var cancel = new SIPMessage.OutgoingRequest(JsSIP_C.CANCEL, this.request.ruri, this.ua, {\n        'route_set': this.request.getHeaders('route'),\n        'call_id': this.request.getHeader('call-id'),\n        'cseq': this.request.cseq\n      });\n      cancel.setHeader('from', this.request.getHeader('from'));\n      cancel.setHeader('via', this.request.getHeader('via'));\n      cancel.setHeader('to', this.request.getHeader('to'));\n\n      if (reason) {\n        cancel.setHeader('reason', reason);\n      }\n\n      this.transport.send(cancel);\n    }\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(response) {\n      var _this7 = this;\n\n      var status_code = response.status_code;\n\n      if (status_code >= 100 && status_code <= 199) {\n        switch (this.state) {\n          case C.STATUS_CALLING:\n            this.stateChanged(C.STATUS_PROCEEDING);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n\n          case C.STATUS_PROCEEDING:\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n        }\n      } else if (status_code >= 200 && status_code <= 299) {\n        switch (this.state) {\n          case C.STATUS_CALLING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_ACCEPTED);\n            this.M = setTimeout(function () {\n              _this7.timer_M();\n            }, Timers.TIMER_M);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n\n          case C.STATUS_ACCEPTED:\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n        }\n      } else if (status_code >= 300 && status_code <= 699) {\n        switch (this.state) {\n          case C.STATUS_CALLING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_COMPLETED);\n            this.sendACK(response);\n            this.eventHandlers.onReceiveResponse(response);\n            break;\n\n          case C.STATUS_COMPLETED:\n            this.sendACK(response);\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return InviteClientTransaction;\n}(EventEmitter);\n\nvar AckClientTransaction = /*#__PURE__*/function (_EventEmitter3) {\n  _inherits(AckClientTransaction, _EventEmitter3);\n\n  var _super3 = _createSuper(AckClientTransaction);\n\n  function AckClientTransaction(ua, transport, request, eventHandlers) {\n    var _this8;\n\n    _classCallCheck(this, AckClientTransaction);\n\n    _this8 = _super3.call(this);\n    _this8.id = \"z9hG4bK\".concat(Math.floor(Math.random() * 10000000));\n    _this8.transport = transport;\n    _this8.request = request;\n    _this8.eventHandlers = eventHandlers;\n    var via = \"SIP/2.0/\".concat(transport.via_transport);\n    via += \" \".concat(ua.configuration.via_host, \";branch=\").concat(_this8.id);\n\n    _this8.request.setHeader('via', via);\n\n    return _this8;\n  }\n\n  _createClass(AckClientTransaction, [{\n    key: \"send\",\n    value: function send() {\n      if (!this.transport.send(this.request)) {\n        this.onTransportError();\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      loggeract.debug(\"transport error occurred for transaction \".concat(this.id));\n      this.eventHandlers.onTransportError();\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return AckClientTransaction;\n}(EventEmitter);\n\nvar NonInviteServerTransaction = /*#__PURE__*/function (_EventEmitter4) {\n  _inherits(NonInviteServerTransaction, _EventEmitter4);\n\n  var _super4 = _createSuper(NonInviteServerTransaction);\n\n  function NonInviteServerTransaction(ua, transport, request) {\n    var _this9;\n\n    _classCallCheck(this, NonInviteServerTransaction);\n\n    _this9 = _super4.call(this);\n    _this9.type = C.NON_INVITE_SERVER;\n    _this9.id = request.via_branch;\n    _this9.ua = ua;\n    _this9.transport = transport;\n    _this9.request = request;\n    _this9.last_response = '';\n    request.server_transaction = _assertThisInitialized(_this9);\n    _this9.state = C.STATUS_TRYING;\n    ua.newTransaction(_assertThisInitialized(_this9));\n    return _this9;\n  }\n\n  _createClass(NonInviteServerTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"timer_J\",\n    value: function timer_J() {\n      loggernist.debug(\"Timer J expired for transaction \".concat(this.id));\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      if (!this.transportError) {\n        this.transportError = true;\n        loggernist.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n        clearTimeout(this.J);\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    }\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(status_code, response, onSuccess, onFailure) {\n      var _this10 = this;\n\n      if (status_code === 100) {\n        /* RFC 4320 4.1\n         * 'A SIP element MUST NOT\n         * send any provisional response with a\n         * Status-Code other than 100 to a non-INVITE request.'\n         */\n        switch (this.state) {\n          case C.STATUS_TRYING:\n            this.stateChanged(C.STATUS_PROCEEDING);\n\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n            }\n\n            break;\n\n          case C.STATUS_PROCEEDING:\n            this.last_response = response;\n\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n\n              if (onFailure) {\n                onFailure();\n              }\n            } else if (onSuccess) {\n              onSuccess();\n            }\n\n            break;\n        }\n      } else if (status_code >= 200 && status_code <= 699) {\n        switch (this.state) {\n          case C.STATUS_TRYING:\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_COMPLETED);\n            this.last_response = response;\n            this.J = setTimeout(function () {\n              _this10.timer_J();\n            }, Timers.TIMER_J);\n\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n\n              if (onFailure) {\n                onFailure();\n              }\n            } else if (onSuccess) {\n              onSuccess();\n            }\n\n            break;\n\n          case C.STATUS_COMPLETED:\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return NonInviteServerTransaction;\n}(EventEmitter);\n\nvar InviteServerTransaction = /*#__PURE__*/function (_EventEmitter5) {\n  _inherits(InviteServerTransaction, _EventEmitter5);\n\n  var _super5 = _createSuper(InviteServerTransaction);\n\n  function InviteServerTransaction(ua, transport, request) {\n    var _this11;\n\n    _classCallCheck(this, InviteServerTransaction);\n\n    _this11 = _super5.call(this);\n    _this11.type = C.INVITE_SERVER;\n    _this11.id = request.via_branch;\n    _this11.ua = ua;\n    _this11.transport = transport;\n    _this11.request = request;\n    _this11.last_response = '';\n    request.server_transaction = _assertThisInitialized(_this11);\n    _this11.state = C.STATUS_PROCEEDING;\n    ua.newTransaction(_assertThisInitialized(_this11));\n    _this11.resendProvisionalTimer = null;\n    request.reply(100);\n    return _this11;\n  }\n\n  _createClass(InviteServerTransaction, [{\n    key: \"stateChanged\",\n    value: function stateChanged(state) {\n      this.state = state;\n      this.emit('stateChanged');\n    }\n  }, {\n    key: \"timer_H\",\n    value: function timer_H() {\n      loggerist.debug(\"Timer H expired for transaction \".concat(this.id));\n\n      if (this.state === C.STATUS_COMPLETED) {\n        loggerist.debug('ACK not received, dialog will be terminated');\n      }\n\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    }\n  }, {\n    key: \"timer_I\",\n    value: function timer_I() {\n      this.stateChanged(C.STATUS_TERMINATED);\n      this.ua.destroyTransaction(this);\n    } // RFC 6026 7.1.\n\n  }, {\n    key: \"timer_L\",\n    value: function timer_L() {\n      loggerist.debug(\"Timer L expired for transaction \".concat(this.id));\n\n      if (this.state === C.STATUS_ACCEPTED) {\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    }\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      if (!this.transportError) {\n        this.transportError = true;\n        loggerist.debug(\"transport error occurred, deleting transaction \".concat(this.id));\n\n        if (this.resendProvisionalTimer !== null) {\n          clearInterval(this.resendProvisionalTimer);\n          this.resendProvisionalTimer = null;\n        }\n\n        clearTimeout(this.L);\n        clearTimeout(this.H);\n        clearTimeout(this.I);\n        this.stateChanged(C.STATUS_TERMINATED);\n        this.ua.destroyTransaction(this);\n      }\n    }\n  }, {\n    key: \"resend_provisional\",\n    value: function resend_provisional() {\n      if (!this.transport.send(this.last_response)) {\n        this.onTransportError();\n      }\n    } // INVITE Server Transaction RFC 3261 17.2.1.\n\n  }, {\n    key: \"receiveResponse\",\n    value: function receiveResponse(status_code, response, onSuccess, onFailure) {\n      var _this12 = this;\n\n      if (status_code >= 100 && status_code <= 199) {\n        switch (this.state) {\n          case C.STATUS_PROCEEDING:\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n            }\n\n            this.last_response = response;\n            break;\n        }\n      }\n\n      if (status_code > 100 && status_code <= 199 && this.state === C.STATUS_PROCEEDING) {\n        // Trigger the resendProvisionalTimer only for the first non 100 provisional response.\n        if (this.resendProvisionalTimer === null) {\n          this.resendProvisionalTimer = setInterval(function () {\n            _this12.resend_provisional();\n          }, Timers.PROVISIONAL_RESPONSE_INTERVAL);\n        }\n      } else if (status_code >= 200 && status_code <= 299) {\n        switch (this.state) {\n          case C.STATUS_PROCEEDING:\n            this.stateChanged(C.STATUS_ACCEPTED);\n            this.last_response = response;\n            this.L = setTimeout(function () {\n              _this12.timer_L();\n            }, Timers.TIMER_L);\n\n            if (this.resendProvisionalTimer !== null) {\n              clearInterval(this.resendProvisionalTimer);\n              this.resendProvisionalTimer = null;\n            }\n\n          /* falls through */\n\n          case C.STATUS_ACCEPTED:\n            // Note that this point will be reached for proceeding this.state also.\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n\n              if (onFailure) {\n                onFailure();\n              }\n            } else if (onSuccess) {\n              onSuccess();\n            }\n\n            break;\n        }\n      } else if (status_code >= 300 && status_code <= 699) {\n        switch (this.state) {\n          case C.STATUS_PROCEEDING:\n            if (this.resendProvisionalTimer !== null) {\n              clearInterval(this.resendProvisionalTimer);\n              this.resendProvisionalTimer = null;\n            }\n\n            if (!this.transport.send(response)) {\n              this.onTransportError();\n\n              if (onFailure) {\n                onFailure();\n              }\n            } else {\n              this.stateChanged(C.STATUS_COMPLETED);\n              this.H = setTimeout(function () {\n                _this12.timer_H();\n              }, Timers.TIMER_H);\n\n              if (onSuccess) {\n                onSuccess();\n              }\n            }\n\n            break;\n        }\n      }\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  return InviteServerTransaction;\n}(EventEmitter);\n/**\n * INVITE:\n *  _true_ if retransmission\n *  _false_ new request\n *\n * ACK:\n *  _true_  ACK to non2xx response\n *  _false_ ACK must be passed to TU (accepted state)\n *          ACK to 2xx response\n *\n * CANCEL:\n *  _true_  no matching invite transaction\n *  _false_ matching invite transaction and no final response sent\n *\n * OTHER:\n *  _true_  retransmission\n *  _false_ new request\n */\n\n\nfunction checkTransaction(_ref, request) {\n  var _transactions = _ref._transactions;\n  var tr;\n\n  switch (request.method) {\n    case JsSIP_C.INVITE:\n      tr = _transactions.ist[request.via_branch];\n\n      if (tr) {\n        switch (tr.state) {\n          case C.STATUS_PROCEEDING:\n            tr.transport.send(tr.last_response);\n            break;\n          // RFC 6026 7.1 Invite retransmission.\n          // Received while in C.STATUS_ACCEPTED state. Absorb it.\n\n          case C.STATUS_ACCEPTED:\n            break;\n        }\n\n        return true;\n      }\n\n      break;\n\n    case JsSIP_C.ACK:\n      tr = _transactions.ist[request.via_branch]; // RFC 6026 7.1.\n\n      if (tr) {\n        if (tr.state === C.STATUS_ACCEPTED) {\n          return false;\n        } else if (tr.state === C.STATUS_COMPLETED) {\n          tr.state = C.STATUS_CONFIRMED;\n          tr.I = setTimeout(function () {\n            tr.timer_I();\n          }, Timers.TIMER_I);\n          return true;\n        }\n      } // ACK to 2XX Response.\n      else {\n          return false;\n        }\n\n      break;\n\n    case JsSIP_C.CANCEL:\n      tr = _transactions.ist[request.via_branch];\n\n      if (tr) {\n        request.reply_sl(200);\n\n        if (tr.state === C.STATUS_PROCEEDING) {\n          return false;\n        } else {\n          return true;\n        }\n      } else {\n        request.reply_sl(481);\n        return true;\n      }\n\n    default:\n      // Non-INVITE Server Transaction RFC 3261 17.2.2.\n      tr = _transactions.nist[request.via_branch];\n\n      if (tr) {\n        switch (tr.state) {\n          case C.STATUS_TRYING:\n            break;\n\n          case C.STATUS_PROCEEDING:\n          case C.STATUS_COMPLETED:\n            tr.transport.send(tr.last_response);\n            break;\n        }\n\n        return true;\n      }\n\n      break;\n  }\n}\n\nmodule.exports = {\n  C: C,\n  NonInviteClientTransaction: NonInviteClientTransaction,\n  InviteClientTransaction: InviteClientTransaction,\n  AckClientTransaction: AckClientTransaction,\n  NonInviteServerTransaction: NonInviteServerTransaction,\n  InviteServerTransaction: InviteServerTransaction,\n  checkTransaction: checkTransaction\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}