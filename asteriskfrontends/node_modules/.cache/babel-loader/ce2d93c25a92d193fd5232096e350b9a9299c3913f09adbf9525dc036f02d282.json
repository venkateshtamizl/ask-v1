{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import JsSIP from'jssip';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const SIPPhone=()=>{const[session,setSession]=useState(null);const[isMuted,setIsMuted]=useState(false);const[isCalling,setIsCalling]=useState(false);const[isInCall,setIsInCall]=useState(false);const sessionRef=useRef(null);useEffect(()=>{const socket=new JsSIP.WebSocketInterface('wss://10.30.250.50:8089/ws');const configuration={sockets:[socket],uri:'sip:9001@10.30.250.50',password:'your_password_here'// change this!\n};const ua=new JsSIP.UA(configuration);ua.start();ua.on('newRTCSession',data=>{const newSession=data.session;if(sessionRef.current){console.log('Already in session, rejecting new one');newSession.terminate();return;}sessionRef.current=newSession;setSession(newSession);if(data.originator==='remote'){newSession.answer({mediaConstraints:{audio:true,video:false}});}newSession.on('ended',()=>{console.log('Call ended');sessionRef.current=null;setSession(null);setIsCalling(false);setIsInCall(false);setIsMuted(false);});newSession.on('accepted',()=>{console.log('Call accepted');setIsCalling(false);setIsInCall(true);setIsMuted(false);});newSession.on('failed',()=>{console.log('Call failed');sessionRef.current=null;setSession(null);setIsCalling(false);setIsInCall(false);setIsMuted(false);});newSession.on('muted',()=>{console.log('Muted');});newSession.on('unmuted',()=>{console.log('Unmuted');});});return()=>{ua.stop();};},[]);const handleCall=()=>{const eventHandlers={progress:()=>console.log('Call in progress'),failed:e=>console.log('Call failed',e),ended:()=>{console.log('Call ended');sessionRef.current=null;setIsInCall(false);setIsMuted(false);},confirmed:()=>console.log('Call confirmed')};const options={eventHandlers,mediaConstraints:{audio:true,video:false}};const newSession=sessionRef.current=window.ua.call('sip:9008@10.30.250.50',options);setSession(newSession);setIsCalling(true);};const handleHangup=()=>{if(sessionRef.current){sessionRef.current.terminate();sessionRef.current=null;}setSession(null);setIsCalling(false);setIsInCall(false);setIsMuted(false);};const handleMuteToggle=()=>{if(!sessionRef.current)return;if(isMuted){sessionRef.current.unmute({audio:true});}else{sessionRef.current.mute({audio:true});}setIsMuted(!isMuted);};return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px',fontFamily:'sans-serif'},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCDE WebRTC SIP Phone\"}),!isInCall&&/*#__PURE__*/_jsx(\"button\",{onClick:handleCall,disabled:isCalling,children:isCalling?'Calling...':'Call'}),isInCall&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleHangup,children:\"Hangup\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleMuteToggle,children:isMuted?'ðŸ”ˆ Unmute':'ðŸ”‡ Mute'})]})]});};export default SIPPhone;","map":{"version":3,"names":["React","useEffect","useRef","useState","JsSIP","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","SIPPhone","session","setSession","isMuted","setIsMuted","isCalling","setIsCalling","isInCall","setIsInCall","sessionRef","socket","WebSocketInterface","configuration","sockets","uri","password","ua","UA","start","on","data","newSession","current","console","log","terminate","originator","answer","mediaConstraints","audio","video","stop","handleCall","eventHandlers","progress","failed","e","ended","confirmed","options","window","call","handleHangup","handleMuteToggle","unmute","mute","style","padding","fontFamily","children","onClick","disabled"],"sources":["/etc/asterisk/webrtc-phone/src/components/AsteriskWebRTCPhone.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport JsSIP from 'jssip';\n\nconst SIPPhone = () => {\n  const [session, setSession] = useState(null);\n  const [isMuted, setIsMuted] = useState(false);\n  const [isCalling, setIsCalling] = useState(false);\n  const [isInCall, setIsInCall] = useState(false);\n  const sessionRef = useRef(null);\n\n  useEffect(() => {\n    const socket = new JsSIP.WebSocketInterface('wss://10.30.250.50:8089/ws');\n    const configuration = {\n      sockets: [socket],\n      uri: 'sip:9001@10.30.250.50',\n      password: 'your_password_here', // change this!\n    };\n\n    const ua = new JsSIP.UA(configuration);\n    ua.start();\n\n    ua.on('newRTCSession', (data) => {\n      const newSession = data.session;\n\n      if (sessionRef.current) {\n        console.log('Already in session, rejecting new one');\n        newSession.terminate();\n        return;\n      }\n\n      sessionRef.current = newSession;\n      setSession(newSession);\n\n      if (data.originator === 'remote') {\n        newSession.answer({\n          mediaConstraints: { audio: true, video: false },\n        });\n      }\n\n      newSession.on('ended', () => {\n        console.log('Call ended');\n        sessionRef.current = null;\n        setSession(null);\n        setIsCalling(false);\n        setIsInCall(false);\n        setIsMuted(false);\n      });\n\n      newSession.on('accepted', () => {\n        console.log('Call accepted');\n        setIsCalling(false);\n        setIsInCall(true);\n        setIsMuted(false);\n      });\n\n      newSession.on('failed', () => {\n        console.log('Call failed');\n        sessionRef.current = null;\n        setSession(null);\n        setIsCalling(false);\n        setIsInCall(false);\n        setIsMuted(false);\n      });\n\n      newSession.on('muted', () => {\n        console.log('Muted');\n      });\n\n      newSession.on('unmuted', () => {\n        console.log('Unmuted');\n      });\n    });\n\n    return () => {\n      ua.stop();\n    };\n  }, []);\n\n  const handleCall = () => {\n    const eventHandlers = {\n      progress: () => console.log('Call in progress'),\n      failed: (e) => console.log('Call failed', e),\n      ended: () => {\n        console.log('Call ended');\n        sessionRef.current = null;\n        setIsInCall(false);\n        setIsMuted(false);\n      },\n      confirmed: () => console.log('Call confirmed'),\n    };\n\n    const options = {\n      eventHandlers,\n      mediaConstraints: { audio: true, video: false },\n    };\n\n    const newSession = sessionRef.current = window.ua.call('sip:9008@10.30.250.50', options);\n    setSession(newSession);\n    setIsCalling(true);\n  };\n\n  const handleHangup = () => {\n    if (sessionRef.current) {\n      sessionRef.current.terminate();\n      sessionRef.current = null;\n    }\n    setSession(null);\n    setIsCalling(false);\n    setIsInCall(false);\n    setIsMuted(false);\n  };\n\n  const handleMuteToggle = () => {\n    if (!sessionRef.current) return;\n\n    if (isMuted) {\n      sessionRef.current.unmute({ audio: true });\n    } else {\n      sessionRef.current.mute({ audio: true });\n    }\n\n    setIsMuted(!isMuted);\n  };\n\n  return (\n    <div style={{ padding: '20px', fontFamily: 'sans-serif' }}>\n      <h2>ðŸ“ž WebRTC SIP Phone</h2>\n\n      {!isInCall && (\n        <button onClick={handleCall} disabled={isCalling}>\n          {isCalling ? 'Calling...' : 'Call'}\n        </button>\n      )}\n\n      {isInCall && (\n        <>\n          <button onClick={handleHangup}>Hangup</button>\n          <button onClick={handleMuteToggle}>\n            {isMuted ? 'ðŸ”ˆ Unmute' : 'ðŸ”‡ Mute'}\n          </button>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default SIPPhone;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,MAAM,CAAEC,QAAQ,KAAQ,OAAO,CAC1D,MAAO,CAAAC,KAAK,KAAM,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,QAAA,IAAAC,SAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE1B,KAAM,CAAAC,QAAQ,CAAGA,CAAA,GAAM,CACrB,KAAM,CAACC,OAAO,CAAEC,UAAU,CAAC,CAAGV,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACW,OAAO,CAAEC,UAAU,CAAC,CAAGZ,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACa,SAAS,CAAEC,YAAY,CAAC,CAAGd,QAAQ,CAAC,KAAK,CAAC,CACjD,KAAM,CAACe,QAAQ,CAAEC,WAAW,CAAC,CAAGhB,QAAQ,CAAC,KAAK,CAAC,CAC/C,KAAM,CAAAiB,UAAU,CAAGlB,MAAM,CAAC,IAAI,CAAC,CAE/BD,SAAS,CAAC,IAAM,CACd,KAAM,CAAAoB,MAAM,CAAG,GAAI,CAAAjB,KAAK,CAACkB,kBAAkB,CAAC,4BAA4B,CAAC,CACzE,KAAM,CAAAC,aAAa,CAAG,CACpBC,OAAO,CAAE,CAACH,MAAM,CAAC,CACjBI,GAAG,CAAE,uBAAuB,CAC5BC,QAAQ,CAAE,oBAAsB;AAClC,CAAC,CAED,KAAM,CAAAC,EAAE,CAAG,GAAI,CAAAvB,KAAK,CAACwB,EAAE,CAACL,aAAa,CAAC,CACtCI,EAAE,CAACE,KAAK,CAAC,CAAC,CAEVF,EAAE,CAACG,EAAE,CAAC,eAAe,CAAGC,IAAI,EAAK,CAC/B,KAAM,CAAAC,UAAU,CAAGD,IAAI,CAACnB,OAAO,CAE/B,GAAIQ,UAAU,CAACa,OAAO,CAAE,CACtBC,OAAO,CAACC,GAAG,CAAC,uCAAuC,CAAC,CACpDH,UAAU,CAACI,SAAS,CAAC,CAAC,CACtB,OACF,CAEAhB,UAAU,CAACa,OAAO,CAAGD,UAAU,CAC/BnB,UAAU,CAACmB,UAAU,CAAC,CAEtB,GAAID,IAAI,CAACM,UAAU,GAAK,QAAQ,CAAE,CAChCL,UAAU,CAACM,MAAM,CAAC,CAChBC,gBAAgB,CAAE,CAAEC,KAAK,CAAE,IAAI,CAAEC,KAAK,CAAE,KAAM,CAChD,CAAC,CAAC,CACJ,CAEAT,UAAU,CAACF,EAAE,CAAC,OAAO,CAAE,IAAM,CAC3BI,OAAO,CAACC,GAAG,CAAC,YAAY,CAAC,CACzBf,UAAU,CAACa,OAAO,CAAG,IAAI,CACzBpB,UAAU,CAAC,IAAI,CAAC,CAChBI,YAAY,CAAC,KAAK,CAAC,CACnBE,WAAW,CAAC,KAAK,CAAC,CAClBJ,UAAU,CAAC,KAAK,CAAC,CACnB,CAAC,CAAC,CAEFiB,UAAU,CAACF,EAAE,CAAC,UAAU,CAAE,IAAM,CAC9BI,OAAO,CAACC,GAAG,CAAC,eAAe,CAAC,CAC5BlB,YAAY,CAAC,KAAK,CAAC,CACnBE,WAAW,CAAC,IAAI,CAAC,CACjBJ,UAAU,CAAC,KAAK,CAAC,CACnB,CAAC,CAAC,CAEFiB,UAAU,CAACF,EAAE,CAAC,QAAQ,CAAE,IAAM,CAC5BI,OAAO,CAACC,GAAG,CAAC,aAAa,CAAC,CAC1Bf,UAAU,CAACa,OAAO,CAAG,IAAI,CACzBpB,UAAU,CAAC,IAAI,CAAC,CAChBI,YAAY,CAAC,KAAK,CAAC,CACnBE,WAAW,CAAC,KAAK,CAAC,CAClBJ,UAAU,CAAC,KAAK,CAAC,CACnB,CAAC,CAAC,CAEFiB,UAAU,CAACF,EAAE,CAAC,OAAO,CAAE,IAAM,CAC3BI,OAAO,CAACC,GAAG,CAAC,OAAO,CAAC,CACtB,CAAC,CAAC,CAEFH,UAAU,CAACF,EAAE,CAAC,SAAS,CAAE,IAAM,CAC7BI,OAAO,CAACC,GAAG,CAAC,SAAS,CAAC,CACxB,CAAC,CAAC,CACJ,CAAC,CAAC,CAEF,MAAO,IAAM,CACXR,EAAE,CAACe,IAAI,CAAC,CAAC,CACX,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAC,UAAU,CAAGA,CAAA,GAAM,CACvB,KAAM,CAAAC,aAAa,CAAG,CACpBC,QAAQ,CAAEA,CAAA,GAAMX,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAC,CAC/CW,MAAM,CAAGC,CAAC,EAAKb,OAAO,CAACC,GAAG,CAAC,aAAa,CAAEY,CAAC,CAAC,CAC5CC,KAAK,CAAEA,CAAA,GAAM,CACXd,OAAO,CAACC,GAAG,CAAC,YAAY,CAAC,CACzBf,UAAU,CAACa,OAAO,CAAG,IAAI,CACzBd,WAAW,CAAC,KAAK,CAAC,CAClBJ,UAAU,CAAC,KAAK,CAAC,CACnB,CAAC,CACDkC,SAAS,CAAEA,CAAA,GAAMf,OAAO,CAACC,GAAG,CAAC,gBAAgB,CAC/C,CAAC,CAED,KAAM,CAAAe,OAAO,CAAG,CACdN,aAAa,CACbL,gBAAgB,CAAE,CAAEC,KAAK,CAAE,IAAI,CAAEC,KAAK,CAAE,KAAM,CAChD,CAAC,CAED,KAAM,CAAAT,UAAU,CAAGZ,UAAU,CAACa,OAAO,CAAGkB,MAAM,CAACxB,EAAE,CAACyB,IAAI,CAAC,uBAAuB,CAAEF,OAAO,CAAC,CACxFrC,UAAU,CAACmB,UAAU,CAAC,CACtBf,YAAY,CAAC,IAAI,CAAC,CACpB,CAAC,CAED,KAAM,CAAAoC,YAAY,CAAGA,CAAA,GAAM,CACzB,GAAIjC,UAAU,CAACa,OAAO,CAAE,CACtBb,UAAU,CAACa,OAAO,CAACG,SAAS,CAAC,CAAC,CAC9BhB,UAAU,CAACa,OAAO,CAAG,IAAI,CAC3B,CACApB,UAAU,CAAC,IAAI,CAAC,CAChBI,YAAY,CAAC,KAAK,CAAC,CACnBE,WAAW,CAAC,KAAK,CAAC,CAClBJ,UAAU,CAAC,KAAK,CAAC,CACnB,CAAC,CAED,KAAM,CAAAuC,gBAAgB,CAAGA,CAAA,GAAM,CAC7B,GAAI,CAAClC,UAAU,CAACa,OAAO,CAAE,OAEzB,GAAInB,OAAO,CAAE,CACXM,UAAU,CAACa,OAAO,CAACsB,MAAM,CAAC,CAAEf,KAAK,CAAE,IAAK,CAAC,CAAC,CAC5C,CAAC,IAAM,CACLpB,UAAU,CAACa,OAAO,CAACuB,IAAI,CAAC,CAAEhB,KAAK,CAAE,IAAK,CAAC,CAAC,CAC1C,CAEAzB,UAAU,CAAC,CAACD,OAAO,CAAC,CACtB,CAAC,CAED,mBACEJ,KAAA,QAAK+C,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAM,CAAEC,UAAU,CAAE,YAAa,CAAE,CAAAC,QAAA,eACxDtD,IAAA,OAAAsD,QAAA,CAAI,+BAAmB,CAAI,CAAC,CAE3B,CAAC1C,QAAQ,eACRZ,IAAA,WAAQuD,OAAO,CAAElB,UAAW,CAACmB,QAAQ,CAAE9C,SAAU,CAAA4C,QAAA,CAC9C5C,SAAS,CAAG,YAAY,CAAG,MAAM,CAC5B,CACT,CAEAE,QAAQ,eACPR,KAAA,CAAAF,SAAA,EAAAoD,QAAA,eACEtD,IAAA,WAAQuD,OAAO,CAAER,YAAa,CAAAO,QAAA,CAAC,QAAM,CAAQ,CAAC,cAC9CtD,IAAA,WAAQuD,OAAO,CAAEP,gBAAiB,CAAAM,QAAA,CAC/B9C,OAAO,CAAG,WAAW,CAAG,SAAS,CAC5B,CAAC,EACT,CACH,EACE,CAAC,CAEV,CAAC,CAED,cAAe,CAAAH,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}