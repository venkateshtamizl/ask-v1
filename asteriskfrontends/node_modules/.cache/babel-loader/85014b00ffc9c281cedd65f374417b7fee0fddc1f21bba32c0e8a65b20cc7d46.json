{"ast":null,"code":"\"use strict\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n  return _typeof(obj);\n}\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it;\n  if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n      var F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e2) {\n          throw _e2;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var normalCompletion = true,\n    didErr = false,\n    err;\n  return {\n    s: function s() {\n      it = o[Symbol.iterator]();\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e3) {\n      didErr = true;\n      err = _e3;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n  return arr2;\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n  return _assertThisInitialized(self);\n}\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n  return self;\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\n/* globals RTCPeerConnection: false, RTCSessionDescription: false */\nvar EventEmitter = require('events').EventEmitter;\nvar sdp_transform = require('sdp-transform');\nvar Logger = require('./Logger');\nvar JsSIP_C = require('./Constants');\nvar Exceptions = require('./Exceptions');\nvar Transactions = require('./Transactions');\nvar Utils = require('./Utils');\nvar Timers = require('./Timers');\nvar SIPMessage = require('./SIPMessage');\nvar Dialog = require('./Dialog');\nvar RequestSender = require('./RequestSender');\nvar RTCSession_DTMF = require('./RTCSession/DTMF');\nvar RTCSession_Info = require('./RTCSession/Info');\nvar RTCSession_ReferNotifier = require('./RTCSession/ReferNotifier');\nvar RTCSession_ReferSubscriber = require('./RTCSession/ReferSubscriber');\nvar URI = require('./URI');\nvar logger = new Logger('RTCSession');\nvar C = {\n  // RTCSession states.\n  STATUS_NULL: 0,\n  STATUS_INVITE_SENT: 1,\n  STATUS_1XX_RECEIVED: 2,\n  STATUS_INVITE_RECEIVED: 3,\n  STATUS_WAITING_FOR_ANSWER: 4,\n  STATUS_ANSWERED: 5,\n  STATUS_WAITING_FOR_ACK: 6,\n  STATUS_CANCELED: 7,\n  STATUS_TERMINATED: 8,\n  STATUS_CONFIRMED: 9\n};\n/**\n * Local variables.\n */\n\nvar holdMediaTypes = ['audio', 'video'];\nmodule.exports = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(RTCSession, _EventEmitter);\n  var _super = _createSuper(RTCSession);\n  _createClass(RTCSession, null, [{\n    key: \"C\",\n    /**\n     * Expose C object.\n     */\n    get: function get() {\n      return C;\n    }\n  }]);\n  function RTCSession(ua) {\n    var _this;\n    _classCallCheck(this, RTCSession);\n    logger.debug('new');\n    _this = _super.call(this);\n    _this._id = null;\n    _this._ua = ua;\n    _this._status = C.STATUS_NULL;\n    _this._dialog = null;\n    _this._earlyDialogs = {};\n    _this._contact = null;\n    _this._from_tag = null;\n    _this._to_tag = null; // The RTCPeerConnection instance (public attribute).\n\n    _this._connection = null; // Prevent races on serial PeerConnction operations.\n\n    _this._connectionPromiseQueue = Promise.resolve(); // Incoming/Outgoing request being currently processed.\n\n    _this._request = null; // Cancel state for initial outgoing request.\n\n    _this._is_canceled = false;\n    _this._cancel_reason = ''; // RTCSession confirmation flag.\n\n    _this._is_confirmed = false; // Is late SDP being negotiated.\n\n    _this._late_sdp = false; // Default rtcOfferConstraints and rtcAnswerConstrainsts (passed in connect() or answer()).\n\n    _this._rtcOfferConstraints = null;\n    _this._rtcAnswerConstraints = null; // Local MediaStream.\n\n    _this._localMediaStream = null;\n    _this._localMediaStreamLocallyGenerated = false; // Flag to indicate PeerConnection ready for new actions.\n\n    _this._rtcReady = true; // Flag to indicate ICE candidate gathering is finished even if iceGatheringState is not yet 'complete'.\n\n    _this._iceReady = false; // SIP Timers.\n\n    _this._timers = {\n      ackTimer: null,\n      expiresTimer: null,\n      invite2xxTimer: null,\n      userNoAnswerTimer: null\n    }; // Session info.\n\n    _this._direction = null;\n    _this._local_identity = null;\n    _this._remote_identity = null;\n    _this._start_time = null;\n    _this._end_time = null;\n    _this._tones = null; // Mute/Hold state.\n\n    _this._audioMuted = false;\n    _this._videoMuted = false;\n    _this._localHold = false;\n    _this._remoteHold = false; // Session Timers (RFC 4028).\n\n    _this._sessionTimers = {\n      enabled: _this._ua.configuration.session_timers,\n      refreshMethod: _this._ua.configuration.session_timers_refresh_method,\n      defaultExpires: JsSIP_C.SESSION_EXPIRES,\n      currentExpires: null,\n      running: false,\n      refresher: false,\n      timer: null // A setTimeout.\n    }; // Map of ReferSubscriber instances indexed by the REFER's CSeq number.\n\n    _this._referSubscribers = {}; // Custom session empty object for high level use.\n\n    _this._data = {};\n    return _this;\n  }\n  /**\n   * User API\n   */\n  // Expose RTCSession constants as a property of the RTCSession instance.\n\n  _createClass(RTCSession, [{\n    key: \"isInProgress\",\n    value: function isInProgress() {\n      switch (this._status) {\n        case C.STATUS_NULL:\n        case C.STATUS_INVITE_SENT:\n        case C.STATUS_1XX_RECEIVED:\n        case C.STATUS_INVITE_RECEIVED:\n        case C.STATUS_WAITING_FOR_ANSWER:\n          return true;\n        default:\n          return false;\n      }\n    }\n  }, {\n    key: \"isEstablished\",\n    value: function isEstablished() {\n      switch (this._status) {\n        case C.STATUS_ANSWERED:\n        case C.STATUS_WAITING_FOR_ACK:\n        case C.STATUS_CONFIRMED:\n          return true;\n        default:\n          return false;\n      }\n    }\n  }, {\n    key: \"isEnded\",\n    value: function isEnded() {\n      switch (this._status) {\n        case C.STATUS_CANCELED:\n        case C.STATUS_TERMINATED:\n          return true;\n        default:\n          return false;\n      }\n    }\n  }, {\n    key: \"isMuted\",\n    value: function isMuted() {\n      return {\n        audio: this._audioMuted,\n        video: this._videoMuted\n      };\n    }\n  }, {\n    key: \"isOnHold\",\n    value: function isOnHold() {\n      return {\n        local: this._localHold,\n        remote: this._remoteHold\n      };\n    }\n  }, {\n    key: \"connect\",\n    value: function connect(target) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var initCallback = arguments.length > 2 ? arguments[2] : undefined;\n      logger.debug('connect()');\n      var originalTarget = target;\n      var eventHandlers = Utils.cloneObject(options.eventHandlers);\n      var extraHeaders = Utils.cloneArray(options.extraHeaders);\n      var mediaConstraints = Utils.cloneObject(options.mediaConstraints, {\n        audio: true,\n        video: true\n      });\n      var mediaStream = options.mediaStream || null;\n      var pcConfig = Utils.cloneObject(options.pcConfig, {\n        iceServers: []\n      });\n      var rtcConstraints = options.rtcConstraints || null;\n      var rtcOfferConstraints = options.rtcOfferConstraints || null;\n      this._rtcOfferConstraints = rtcOfferConstraints;\n      this._rtcAnswerConstraints = options.rtcAnswerConstraints || null;\n      this._data = options.data || this._data; // Check target.\n\n      if (target === undefined) {\n        throw new TypeError('Not enough arguments');\n      } // Check Session Status.\n\n      if (this._status !== C.STATUS_NULL) {\n        throw new Exceptions.InvalidStateError(this._status);\n      } // Check WebRTC support.\n\n      if (!window.RTCPeerConnection) {\n        throw new Exceptions.NotSupportedError('WebRTC not supported');\n      } // Check target validity.\n\n      target = this._ua.normalizeTarget(target);\n      if (!target) {\n        throw new TypeError(\"Invalid target: \".concat(originalTarget));\n      } // Session Timers.\n\n      if (this._sessionTimers.enabled) {\n        if (Utils.isDecimal(options.sessionTimersExpires)) {\n          if (options.sessionTimersExpires >= JsSIP_C.MIN_SESSION_EXPIRES) {\n            this._sessionTimers.defaultExpires = options.sessionTimersExpires;\n          } else {\n            this._sessionTimers.defaultExpires = JsSIP_C.SESSION_EXPIRES;\n          }\n        }\n      } // Set event handlers.\n\n      for (var event in eventHandlers) {\n        if (Object.prototype.hasOwnProperty.call(eventHandlers, event)) {\n          this.on(event, eventHandlers[event]);\n        }\n      } // Session parameter initialization.\n\n      this._from_tag = Utils.newTag(); // Set anonymous property.\n\n      var anonymous = options.anonymous || false;\n      var requestParams = {\n        from_tag: this._from_tag\n      };\n      this._contact = this._ua.contact.toString({\n        anonymous: anonymous,\n        outbound: true\n      });\n      if (anonymous) {\n        requestParams.from_display_name = 'Anonymous';\n        requestParams.from_uri = new URI('sip', 'anonymous', 'anonymous.invalid');\n        extraHeaders.push(\"P-Preferred-Identity: \".concat(this._ua.configuration.uri.toString()));\n        extraHeaders.push('Privacy: id');\n      } else if (options.fromUserName) {\n        requestParams.from_uri = new URI('sip', options.fromUserName, this._ua.configuration.uri.host);\n        extraHeaders.push(\"P-Preferred-Identity: \".concat(this._ua.configuration.uri.toString()));\n      }\n      if (options.fromDisplayName) {\n        requestParams.from_display_name = options.fromDisplayName;\n      }\n      extraHeaders.push(\"Contact: \".concat(this._contact));\n      extraHeaders.push('Content-Type: application/sdp');\n      if (this._sessionTimers.enabled) {\n        extraHeaders.push(\"Session-Expires: \".concat(this._sessionTimers.defaultExpires).concat(this._ua.configuration.session_timers_force_refresher ? ';refresher=uac' : ''));\n      }\n      this._request = new SIPMessage.InitialOutgoingInviteRequest(target, this._ua, requestParams, extraHeaders);\n      this._id = this._request.call_id + this._from_tag; // Create a new RTCPeerConnection instance.\n\n      this._createRTCConnection(pcConfig, rtcConstraints); // Set internal properties.\n\n      this._direction = 'outgoing';\n      this._local_identity = this._request.from;\n      this._remote_identity = this._request.to; // User explicitly provided a newRTCSession callback for this session.\n\n      if (initCallback) {\n        initCallback(this);\n      }\n      this._newRTCSession('local', this._request);\n      this._sendInitialRequest(mediaConstraints, rtcOfferConstraints, mediaStream);\n    }\n  }, {\n    key: \"init_incoming\",\n    value: function init_incoming(request, initCallback) {\n      var _this2 = this;\n      logger.debug('init_incoming()');\n      var expires;\n      var contentType = request.hasHeader('Content-Type') ? request.getHeader('Content-Type').toLowerCase() : undefined; // Check body and content type.\n\n      if (request.body && contentType !== 'application/sdp') {\n        request.reply(415);\n        return;\n      } // Session parameter initialization.\n\n      this._status = C.STATUS_INVITE_RECEIVED;\n      this._from_tag = request.from_tag;\n      this._id = request.call_id + this._from_tag;\n      this._request = request;\n      this._contact = this._ua.contact.toString(); // Get the Expires header value if exists.\n\n      if (request.hasHeader('expires')) {\n        expires = request.getHeader('expires') * 1000;\n      }\n      /* Set the to_tag before\n       * replying a response code that will create a dialog.\n       */\n\n      request.to_tag = Utils.newTag(); // An error on dialog creation will fire 'failed' event.\n\n      if (!this._createDialog(request, 'UAS', true)) {\n        request.reply(500, 'Missing Contact header field');\n        return;\n      }\n      if (request.body) {\n        this._late_sdp = false;\n      } else {\n        this._late_sdp = true;\n      }\n      this._status = C.STATUS_WAITING_FOR_ANSWER; // Set userNoAnswerTimer.\n\n      this._timers.userNoAnswerTimer = setTimeout(function () {\n        request.reply(408);\n        _this2._failed('local', null, JsSIP_C.causes.NO_ANSWER);\n      }, this._ua.configuration.no_answer_timeout);\n      /* Set expiresTimer\n       * RFC3261 13.3.1\n       */\n\n      if (expires) {\n        this._timers.expiresTimer = setTimeout(function () {\n          if (_this2._status === C.STATUS_WAITING_FOR_ANSWER) {\n            request.reply(487);\n            _this2._failed('system', null, JsSIP_C.causes.EXPIRES);\n          }\n        }, expires);\n      } // Set internal properties.\n\n      this._direction = 'incoming';\n      this._local_identity = request.to;\n      this._remote_identity = request.from; // A init callback was specifically defined.\n\n      if (initCallback) {\n        initCallback(this);\n      } // Fire 'newRTCSession' event.\n\n      this._newRTCSession('remote', request); // The user may have rejected the call in the 'newRTCSession' event.\n\n      if (this._status === C.STATUS_TERMINATED) {\n        return;\n      } // Reply 180.\n\n      request.reply(180, null, [\"Contact: \".concat(this._contact)]); // Fire 'progress' event.\n      // TODO: Document that 'response' field in 'progress' event is null for incoming calls.\n\n      this._progress('local', null);\n    }\n    /**\n     * Answer the call.\n     */\n  }, {\n    key: \"answer\",\n    value: function answer() {\n      var _this3 = this;\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      logger.debug('answer()');\n      var request = this._request;\n      var extraHeaders = Utils.cloneArray(options.extraHeaders);\n      var mediaConstraints = Utils.cloneObject(options.mediaConstraints);\n      var mediaStream = options.mediaStream || null;\n      var pcConfig = Utils.cloneObject(options.pcConfig, {\n        iceServers: []\n      });\n      var rtcConstraints = options.rtcConstraints || null;\n      var rtcAnswerConstraints = options.rtcAnswerConstraints || null;\n      var rtcOfferConstraints = Utils.cloneObject(options.rtcOfferConstraints);\n      var tracks;\n      var peerHasAudioLine = false;\n      var peerHasVideoLine = false;\n      var peerOffersFullAudio = false;\n      var peerOffersFullVideo = false;\n      this._rtcAnswerConstraints = rtcAnswerConstraints;\n      this._rtcOfferConstraints = options.rtcOfferConstraints || null;\n      this._data = options.data || this._data; // Check Session Direction and Status.\n\n      if (this._direction !== 'incoming') {\n        throw new Exceptions.NotSupportedError('\"answer\" not supported for outgoing RTCSession');\n      } // Check Session status.\n\n      if (this._status !== C.STATUS_WAITING_FOR_ANSWER) {\n        throw new Exceptions.InvalidStateError(this._status);\n      } // Session Timers.\n\n      if (this._sessionTimers.enabled) {\n        if (Utils.isDecimal(options.sessionTimersExpires)) {\n          if (options.sessionTimersExpires >= JsSIP_C.MIN_SESSION_EXPIRES) {\n            this._sessionTimers.defaultExpires = options.sessionTimersExpires;\n          } else {\n            this._sessionTimers.defaultExpires = JsSIP_C.SESSION_EXPIRES;\n          }\n        }\n      }\n      this._status = C.STATUS_ANSWERED; // An error on dialog creation will fire 'failed' event.\n\n      if (!this._createDialog(request, 'UAS')) {\n        request.reply(500, 'Error creating dialog');\n        return;\n      }\n      clearTimeout(this._timers.userNoAnswerTimer);\n      extraHeaders.unshift(\"Contact: \".concat(this._contact)); // Determine incoming media from incoming SDP offer (if any).\n\n      var sdp = request.parseSDP(); // Make sure sdp.media is an array, not the case if there is only one media.\n\n      if (!Array.isArray(sdp.media)) {\n        sdp.media = [sdp.media];\n      } // Go through all medias in SDP to find offered capabilities to answer with.\n\n      var _iterator = _createForOfIteratorHelper(sdp.media),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var m = _step.value;\n          if (m.type === 'audio') {\n            peerHasAudioLine = true;\n            if (!m.direction || m.direction === 'sendrecv') {\n              peerOffersFullAudio = true;\n            }\n          }\n          if (m.type === 'video') {\n            peerHasVideoLine = true;\n            if (!m.direction || m.direction === 'sendrecv') {\n              peerOffersFullVideo = true;\n            }\n          }\n        } // Remove audio from mediaStream if suggested by mediaConstraints.\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n      if (mediaStream && mediaConstraints.audio === false) {\n        tracks = mediaStream.getAudioTracks();\n        var _iterator2 = _createForOfIteratorHelper(tracks),\n          _step2;\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var track = _step2.value;\n            mediaStream.removeTrack(track);\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      } // Remove video from mediaStream if suggested by mediaConstraints.\n\n      if (mediaStream && mediaConstraints.video === false) {\n        tracks = mediaStream.getVideoTracks();\n        var _iterator3 = _createForOfIteratorHelper(tracks),\n          _step3;\n        try {\n          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n            var _track = _step3.value;\n            mediaStream.removeTrack(_track);\n          }\n        } catch (err) {\n          _iterator3.e(err);\n        } finally {\n          _iterator3.f();\n        }\n      } // Set audio constraints based on incoming stream if not supplied.\n\n      if (!mediaStream && mediaConstraints.audio === undefined) {\n        mediaConstraints.audio = peerOffersFullAudio;\n      } // Set video constraints based on incoming stream if not supplied.\n\n      if (!mediaStream && mediaConstraints.video === undefined) {\n        mediaConstraints.video = peerOffersFullVideo;\n      } // Don't ask for audio if the incoming offer has no audio section.\n\n      if (!mediaStream && !peerHasAudioLine && !rtcOfferConstraints.offerToReceiveAudio) {\n        mediaConstraints.audio = false;\n      } // Don't ask for video if the incoming offer has no video section.\n\n      if (!mediaStream && !peerHasVideoLine && !rtcOfferConstraints.offerToReceiveVideo) {\n        mediaConstraints.video = false;\n      } // Create a new RTCPeerConnection instance.\n      // TODO: This may throw an error, should react.\n\n      this._createRTCConnection(pcConfig, rtcConstraints);\n      Promise.resolve() // Handle local MediaStream.\n      .then(function () {\n        // A local MediaStream is given, use it.\n        if (mediaStream) {\n          return mediaStream;\n        } // Audio and/or video requested, prompt getUserMedia.\n        else if (mediaConstraints.audio || mediaConstraints.video) {\n          _this3._localMediaStreamLocallyGenerated = true;\n          return navigator.mediaDevices.getUserMedia(mediaConstraints)[\"catch\"](function (error) {\n            if (_this3._status === C.STATUS_TERMINATED) {\n              throw new Error('terminated');\n            }\n            request.reply(480);\n            _this3._failed('local', null, JsSIP_C.causes.USER_DENIED_MEDIA_ACCESS);\n            logger.warn('emit \"getusermediafailed\" [error:%o]', error);\n            _this3.emit('getusermediafailed', error);\n            throw new Error('getUserMedia() failed');\n          });\n        }\n      }) // Attach MediaStream to RTCPeerconnection.\n      .then(function (stream) {\n        if (_this3._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        }\n        _this3._localMediaStream = stream;\n        if (stream) {\n          stream.getTracks().forEach(function (track) {\n            _this3._connection.addTrack(track, stream);\n          });\n        }\n      }) // Set remote description.\n      .then(function () {\n        if (_this3._late_sdp) {\n          return;\n        }\n        var e = {\n          originator: 'remote',\n          type: 'offer',\n          sdp: request.body\n        };\n        logger.debug('emit \"sdp\"');\n        _this3.emit('sdp', e);\n        var offer = new RTCSessionDescription({\n          type: 'offer',\n          sdp: e.sdp\n        });\n        _this3._connectionPromiseQueue = _this3._connectionPromiseQueue.then(function () {\n          return _this3._connection.setRemoteDescription(offer);\n        })[\"catch\"](function (error) {\n          request.reply(488);\n          _this3._failed('system', null, JsSIP_C.causes.WEBRTC_ERROR);\n          logger.warn('emit \"peerconnection:setremotedescriptionfailed\" [error:%o]', error);\n          _this3.emit('peerconnection:setremotedescriptionfailed', error);\n          throw new Error('peerconnection.setRemoteDescription() failed');\n        });\n        return _this3._connectionPromiseQueue;\n      }) // Create local description.\n      .then(function () {\n        if (_this3._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        } // TODO: Is this event already useful?\n\n        _this3._connecting(request);\n        if (!_this3._late_sdp) {\n          return _this3._createLocalDescription('answer', rtcAnswerConstraints)[\"catch\"](function () {\n            request.reply(500);\n            throw new Error('_createLocalDescription() failed');\n          });\n        } else {\n          return _this3._createLocalDescription('offer', _this3._rtcOfferConstraints)[\"catch\"](function () {\n            request.reply(500);\n            throw new Error('_createLocalDescription() failed');\n          });\n        }\n      }) // Send reply.\n      .then(function (desc) {\n        if (_this3._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        }\n        _this3._handleSessionTimersInIncomingRequest(request, extraHeaders);\n        request.reply(200, null, extraHeaders, desc, function () {\n          _this3._status = C.STATUS_WAITING_FOR_ACK;\n          _this3._setInvite2xxTimer(request, desc);\n          _this3._setACKTimer();\n          _this3._accepted('local');\n        }, function () {\n          _this3._failed('system', null, JsSIP_C.causes.CONNECTION_ERROR);\n        });\n      })[\"catch\"](function (error) {\n        if (_this3._status === C.STATUS_TERMINATED) {\n          return;\n        }\n        logger.warn(error);\n      });\n    }\n    /**\n     * Terminate the call.\n     */\n  }, {\n    key: \"terminate\",\n    value: function terminate() {\n      var _this4 = this;\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      logger.debug('terminate()');\n      var cause = options.cause || JsSIP_C.causes.BYE;\n      var extraHeaders = Utils.cloneArray(options.extraHeaders);\n      var body = options.body;\n      var cancel_reason;\n      var status_code = options.status_code;\n      var reason_phrase = options.reason_phrase; // Check Session Status.\n\n      if (this._status === C.STATUS_TERMINATED) {\n        throw new Exceptions.InvalidStateError(this._status);\n      }\n      switch (this._status) {\n        // - UAC -\n        case C.STATUS_NULL:\n        case C.STATUS_INVITE_SENT:\n        case C.STATUS_1XX_RECEIVED:\n          logger.debug('canceling session');\n          if (status_code && (status_code < 200 || status_code >= 700)) {\n            throw new TypeError(\"Invalid status_code: \".concat(status_code));\n          } else if (status_code) {\n            reason_phrase = reason_phrase || JsSIP_C.REASON_PHRASE[status_code] || '';\n            cancel_reason = \"SIP ;cause=\".concat(status_code, \" ;text=\\\"\").concat(reason_phrase, \"\\\"\");\n          } // Check Session Status.\n\n          if (this._status === C.STATUS_NULL || this._status === C.STATUS_INVITE_SENT) {\n            this._is_canceled = true;\n            this._cancel_reason = cancel_reason;\n          } else if (this._status === C.STATUS_1XX_RECEIVED) {\n            this._request.cancel(cancel_reason);\n          }\n          this._status = C.STATUS_CANCELED;\n          this._failed('local', null, JsSIP_C.causes.CANCELED);\n          break;\n        // - UAS -\n\n        case C.STATUS_WAITING_FOR_ANSWER:\n        case C.STATUS_ANSWERED:\n          logger.debug('rejecting session');\n          status_code = status_code || 480;\n          if (status_code < 300 || status_code >= 700) {\n            throw new TypeError(\"Invalid status_code: \".concat(status_code));\n          }\n          this._request.reply(status_code, reason_phrase, extraHeaders, body);\n          this._failed('local', null, JsSIP_C.causes.REJECTED);\n          break;\n        case C.STATUS_WAITING_FOR_ACK:\n        case C.STATUS_CONFIRMED:\n          logger.debug('terminating session');\n          reason_phrase = options.reason_phrase || JsSIP_C.REASON_PHRASE[status_code] || '';\n          if (status_code && (status_code < 200 || status_code >= 700)) {\n            throw new TypeError(\"Invalid status_code: \".concat(status_code));\n          } else if (status_code) {\n            extraHeaders.push(\"Reason: SIP ;cause=\".concat(status_code, \"; text=\\\"\").concat(reason_phrase, \"\\\"\"));\n          }\n          /* RFC 3261 section 15 (Terminating a session):\n            *\n            * \"...the callee's UA MUST NOT send a BYE on a confirmed dialog\n            * until it has received an ACK for its 2xx response or until the server\n            * transaction times out.\"\n            */\n\n          if (this._status === C.STATUS_WAITING_FOR_ACK && this._direction === 'incoming' && this._request.server_transaction.state !== Transactions.C.STATUS_TERMINATED) {\n            // Save the dialog for later restoration.\n            var dialog = this._dialog; // Send the BYE as soon as the ACK is received...\n\n            this.receiveRequest = function (_ref) {\n              var method = _ref.method;\n              if (method === JsSIP_C.ACK) {\n                _this4.sendRequest(JsSIP_C.BYE, {\n                  extraHeaders: extraHeaders,\n                  body: body\n                });\n                dialog.terminate();\n              }\n            }; // .., or when the INVITE transaction times out\n\n            this._request.server_transaction.on('stateChanged', function () {\n              if (_this4._request.server_transaction.state === Transactions.C.STATUS_TERMINATED) {\n                _this4.sendRequest(JsSIP_C.BYE, {\n                  extraHeaders: extraHeaders,\n                  body: body\n                });\n                dialog.terminate();\n              }\n            });\n            this._ended('local', null, cause); // Restore the dialog into 'this' in order to be able to send the in-dialog BYE :-).\n\n            this._dialog = dialog; // Restore the dialog into 'ua' so the ACK can reach 'this' session.\n\n            this._ua.newDialog(dialog);\n          } else {\n            this.sendRequest(JsSIP_C.BYE, {\n              extraHeaders: extraHeaders,\n              body: body\n            });\n            this._ended('local', null, cause);\n          }\n      }\n    }\n  }, {\n    key: \"sendDTMF\",\n    value: function sendDTMF(tones) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      logger.debug('sendDTMF() | tones: %s', tones);\n      var position = 0;\n      var duration = options.duration || null;\n      var interToneGap = options.interToneGap || null;\n      var transportType = options.transportType || JsSIP_C.DTMF_TRANSPORT.INFO;\n      if (tones === undefined) {\n        throw new TypeError('Not enough arguments');\n      } // Check Session Status.\n\n      if (this._status !== C.STATUS_CONFIRMED && this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_1XX_RECEIVED) {\n        throw new Exceptions.InvalidStateError(this._status);\n      } // Check Transport type.\n\n      if (transportType !== JsSIP_C.DTMF_TRANSPORT.INFO && transportType !== JsSIP_C.DTMF_TRANSPORT.RFC2833) {\n        throw new TypeError(\"invalid transportType: \".concat(transportType));\n      } // Convert to string.\n\n      if (typeof tones === 'number') {\n        tones = tones.toString();\n      } // Check tones.\n\n      if (!tones || typeof tones !== 'string' || !tones.match(/^[0-9A-DR#*,]+$/i)) {\n        throw new TypeError(\"Invalid tones: \".concat(tones));\n      } // Check duration.\n\n      if (duration && !Utils.isDecimal(duration)) {\n        throw new TypeError(\"Invalid tone duration: \".concat(duration));\n      } else if (!duration) {\n        duration = RTCSession_DTMF.C.DEFAULT_DURATION;\n      } else if (duration < RTCSession_DTMF.C.MIN_DURATION) {\n        logger.debug(\"\\\"duration\\\" value is lower than the minimum allowed, setting it to \".concat(RTCSession_DTMF.C.MIN_DURATION, \" milliseconds\"));\n        duration = RTCSession_DTMF.C.MIN_DURATION;\n      } else if (duration > RTCSession_DTMF.C.MAX_DURATION) {\n        logger.debug(\"\\\"duration\\\" value is greater than the maximum allowed, setting it to \".concat(RTCSession_DTMF.C.MAX_DURATION, \" milliseconds\"));\n        duration = RTCSession_DTMF.C.MAX_DURATION;\n      } else {\n        duration = Math.abs(duration);\n      }\n      options.duration = duration; // Check interToneGap.\n\n      if (interToneGap && !Utils.isDecimal(interToneGap)) {\n        throw new TypeError(\"Invalid interToneGap: \".concat(interToneGap));\n      } else if (!interToneGap) {\n        interToneGap = RTCSession_DTMF.C.DEFAULT_INTER_TONE_GAP;\n      } else if (interToneGap < RTCSession_DTMF.C.MIN_INTER_TONE_GAP) {\n        logger.debug(\"\\\"interToneGap\\\" value is lower than the minimum allowed, setting it to \".concat(RTCSession_DTMF.C.MIN_INTER_TONE_GAP, \" milliseconds\"));\n        interToneGap = RTCSession_DTMF.C.MIN_INTER_TONE_GAP;\n      } else {\n        interToneGap = Math.abs(interToneGap);\n      } // RFC2833. Let RTCDTMFSender enqueue the DTMFs.\n\n      if (transportType === JsSIP_C.DTMF_TRANSPORT.RFC2833) {\n        // Send DTMF in current audio RTP stream.\n        var sender = this._getDTMFRTPSender();\n        if (sender) {\n          // Add remaining buffered tones.\n          tones = sender.toneBuffer + tones; // Insert tones.\n\n          sender.insertDTMF(tones, duration, interToneGap);\n        }\n        return;\n      }\n      if (this._tones) {\n        // Tones are already queued, just add to the queue.\n        this._tones += tones;\n        return;\n      }\n      this._tones = tones; // Send the first tone.\n\n      _sendDTMF.call(this);\n      function _sendDTMF() {\n        var _this5 = this;\n        var timeout;\n        if (this._status === C.STATUS_TERMINATED || !this._tones || position >= this._tones.length) {\n          // Stop sending DTMF.\n          this._tones = null;\n          return;\n        }\n        var tone = this._tones[position];\n        position += 1;\n        if (tone === ',') {\n          timeout = 2000;\n        } else {\n          // Send DTMF via SIP INFO messages.\n          var dtmf = new RTCSession_DTMF(this);\n          options.eventHandlers = {\n            onFailed: function onFailed() {\n              _this5._tones = null;\n            }\n          };\n          dtmf.send(tone, options);\n          timeout = duration + interToneGap;\n        } // Set timeout for the next tone.\n\n        setTimeout(_sendDTMF.bind(this), timeout);\n      }\n    }\n  }, {\n    key: \"sendInfo\",\n    value: function sendInfo(contentType, body) {\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      logger.debug('sendInfo()'); // Check Session Status.\n\n      if (this._status !== C.STATUS_CONFIRMED && this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_1XX_RECEIVED) {\n        throw new Exceptions.InvalidStateError(this._status);\n      }\n      var info = new RTCSession_Info(this);\n      info.send(contentType, body, options);\n    }\n    /**\n     * Mute\n     */\n  }, {\n    key: \"mute\",\n    value: function mute() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n        audio: true,\n        video: false\n      };\n      logger.debug('mute()');\n      var audioMuted = false,\n        videoMuted = false;\n      if (this._audioMuted === false && options.audio) {\n        audioMuted = true;\n        this._audioMuted = true;\n        this._toggleMuteAudio(true);\n      }\n      if (this._videoMuted === false && options.video) {\n        videoMuted = true;\n        this._videoMuted = true;\n        this._toggleMuteVideo(true);\n      }\n      if (audioMuted === true || videoMuted === true) {\n        this._onmute({\n          audio: audioMuted,\n          video: videoMuted\n        });\n      }\n    }\n    /**\n     * Unmute\n     */\n  }, {\n    key: \"unmute\",\n    value: function unmute() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n        audio: true,\n        video: true\n      };\n      logger.debug('unmute()');\n      var audioUnMuted = false,\n        videoUnMuted = false;\n      if (this._audioMuted === true && options.audio) {\n        audioUnMuted = true;\n        this._audioMuted = false;\n        if (this._localHold === false) {\n          this._toggleMuteAudio(false);\n        }\n      }\n      if (this._videoMuted === true && options.video) {\n        videoUnMuted = true;\n        this._videoMuted = false;\n        if (this._localHold === false) {\n          this._toggleMuteVideo(false);\n        }\n      }\n      if (audioUnMuted === true || videoUnMuted === true) {\n        this._onunmute({\n          audio: audioUnMuted,\n          video: videoUnMuted\n        });\n      }\n    }\n    /**\n     * Hold\n     */\n  }, {\n    key: \"hold\",\n    value: function hold() {\n      var _this6 = this;\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var done = arguments.length > 1 ? arguments[1] : undefined;\n      logger.debug('hold()');\n      if (this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_CONFIRMED) {\n        return false;\n      }\n      if (this._localHold === true) {\n        return false;\n      }\n      if (!this._isReadyToReOffer()) {\n        return false;\n      }\n      this._localHold = true;\n      this._onhold('local');\n      var eventHandlers = {\n        succeeded: function succeeded() {\n          if (done) {\n            done();\n          }\n        },\n        failed: function failed() {\n          _this6.terminate({\n            cause: JsSIP_C.causes.WEBRTC_ERROR,\n            status_code: 500,\n            reason_phrase: 'Hold Failed'\n          });\n        }\n      };\n      if (options.useUpdate) {\n        this._sendUpdate({\n          sdpOffer: true,\n          eventHandlers: eventHandlers,\n          extraHeaders: options.extraHeaders\n        });\n      } else {\n        this._sendReinvite({\n          eventHandlers: eventHandlers,\n          extraHeaders: options.extraHeaders\n        });\n      }\n      return true;\n    }\n  }, {\n    key: \"unhold\",\n    value: function unhold() {\n      var _this7 = this;\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var done = arguments.length > 1 ? arguments[1] : undefined;\n      logger.debug('unhold()');\n      if (this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_CONFIRMED) {\n        return false;\n      }\n      if (this._localHold === false) {\n        return false;\n      }\n      if (!this._isReadyToReOffer()) {\n        return false;\n      }\n      this._localHold = false;\n      this._onunhold('local');\n      var eventHandlers = {\n        succeeded: function succeeded() {\n          if (done) {\n            done();\n          }\n        },\n        failed: function failed() {\n          _this7.terminate({\n            cause: JsSIP_C.causes.WEBRTC_ERROR,\n            status_code: 500,\n            reason_phrase: 'Unhold Failed'\n          });\n        }\n      };\n      if (options.useUpdate) {\n        this._sendUpdate({\n          sdpOffer: true,\n          eventHandlers: eventHandlers,\n          extraHeaders: options.extraHeaders\n        });\n      } else {\n        this._sendReinvite({\n          eventHandlers: eventHandlers,\n          extraHeaders: options.extraHeaders\n        });\n      }\n      return true;\n    }\n  }, {\n    key: \"renegotiate\",\n    value: function renegotiate() {\n      var _this8 = this;\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var done = arguments.length > 1 ? arguments[1] : undefined;\n      logger.debug('renegotiate()');\n      var rtcOfferConstraints = options.rtcOfferConstraints || null;\n      if (this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_CONFIRMED) {\n        return false;\n      }\n      if (!this._isReadyToReOffer()) {\n        return false;\n      }\n      var eventHandlers = {\n        succeeded: function succeeded() {\n          if (done) {\n            done();\n          }\n        },\n        failed: function failed() {\n          _this8.terminate({\n            cause: JsSIP_C.causes.WEBRTC_ERROR,\n            status_code: 500,\n            reason_phrase: 'Media Renegotiation Failed'\n          });\n        }\n      };\n      this._setLocalMediaStatus();\n      if (options.useUpdate) {\n        this._sendUpdate({\n          sdpOffer: true,\n          eventHandlers: eventHandlers,\n          rtcOfferConstraints: rtcOfferConstraints,\n          extraHeaders: options.extraHeaders\n        });\n      } else {\n        this._sendReinvite({\n          eventHandlers: eventHandlers,\n          rtcOfferConstraints: rtcOfferConstraints,\n          extraHeaders: options.extraHeaders\n        });\n      }\n      return true;\n    }\n    /**\n     * Refer\n     */\n  }, {\n    key: \"refer\",\n    value: function refer(target, options) {\n      var _this9 = this;\n      logger.debug('refer()');\n      var originalTarget = target;\n      if (this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_CONFIRMED) {\n        return false;\n      } // Check target validity.\n\n      target = this._ua.normalizeTarget(target);\n      if (!target) {\n        throw new TypeError(\"Invalid target: \".concat(originalTarget));\n      }\n      var referSubscriber = new RTCSession_ReferSubscriber(this);\n      referSubscriber.sendRefer(target, options); // Store in the map.\n\n      var id = referSubscriber.id;\n      this._referSubscribers[id] = referSubscriber; // Listen for ending events so we can remove it from the map.\n\n      referSubscriber.on('requestFailed', function () {\n        delete _this9._referSubscribers[id];\n      });\n      referSubscriber.on('accepted', function () {\n        delete _this9._referSubscribers[id];\n      });\n      referSubscriber.on('failed', function () {\n        delete _this9._referSubscribers[id];\n      });\n      return referSubscriber;\n    }\n    /**\n     * Send a generic in-dialog Request\n     */\n  }, {\n    key: \"sendRequest\",\n    value: function sendRequest(method, options) {\n      logger.debug('sendRequest()');\n      return this._dialog.sendRequest(method, options);\n    }\n    /**\n     * In dialog Request Reception\n     */\n  }, {\n    key: \"receiveRequest\",\n    value: function receiveRequest(request) {\n      var _this10 = this;\n      logger.debug('receiveRequest()');\n      if (request.method === JsSIP_C.CANCEL) {\n        /* RFC3261 15 States that a UAS may have accepted an invitation while a CANCEL\n        * was in progress and that the UAC MAY continue with the session established by\n        * any 2xx response, or MAY terminate with BYE. JsSIP does continue with the\n        * established session. So the CANCEL is processed only if the session is not yet\n        * established.\n        */\n\n        /*\n        * Terminate the whole session in case the user didn't accept (or yet send the answer)\n        * nor reject the request opening the session.\n        */\n        if (this._status === C.STATUS_WAITING_FOR_ANSWER || this._status === C.STATUS_ANSWERED) {\n          this._status = C.STATUS_CANCELED;\n          this._request.reply(487);\n          this._failed('remote', request, JsSIP_C.causes.CANCELED);\n        }\n      } else {\n        // Requests arriving here are in-dialog requests.\n        switch (request.method) {\n          case JsSIP_C.ACK:\n            if (this._status !== C.STATUS_WAITING_FOR_ACK) {\n              return;\n            } // Update signaling status.\n\n            this._status = C.STATUS_CONFIRMED;\n            clearTimeout(this._timers.ackTimer);\n            clearTimeout(this._timers.invite2xxTimer);\n            if (this._late_sdp) {\n              if (!request.body) {\n                this.terminate({\n                  cause: JsSIP_C.causes.MISSING_SDP,\n                  status_code: 400\n                });\n                break;\n              }\n              var e = {\n                originator: 'remote',\n                type: 'answer',\n                sdp: request.body\n              };\n              logger.debug('emit \"sdp\"');\n              this.emit('sdp', e);\n              var answer = new RTCSessionDescription({\n                type: 'answer',\n                sdp: e.sdp\n              });\n              this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n                return _this10._connection.setRemoteDescription(answer);\n              }).then(function () {\n                if (!_this10._is_confirmed) {\n                  _this10._confirmed('remote', request);\n                }\n              })[\"catch\"](function (error) {\n                _this10.terminate({\n                  cause: JsSIP_C.causes.BAD_MEDIA_DESCRIPTION,\n                  status_code: 488\n                });\n                logger.warn('emit \"peerconnection:setremotedescriptionfailed\" [error:%o]', error);\n                _this10.emit('peerconnection:setremotedescriptionfailed', error);\n              });\n            } else if (!this._is_confirmed) {\n              this._confirmed('remote', request);\n            }\n            break;\n          case JsSIP_C.BYE:\n            if (this._status === C.STATUS_CONFIRMED || this._status === C.STATUS_WAITING_FOR_ACK) {\n              request.reply(200);\n              this._ended('remote', request, JsSIP_C.causes.BYE);\n            } else if (this._status === C.STATUS_INVITE_RECEIVED || this._status === C.STATUS_WAITING_FOR_ANSWER) {\n              request.reply(200);\n              this._request.reply(487, 'BYE Received');\n              this._ended('remote', request, JsSIP_C.causes.BYE);\n            } else {\n              request.reply(403, 'Wrong Status');\n            }\n            break;\n          case JsSIP_C.INVITE:\n            if (this._status === C.STATUS_CONFIRMED) {\n              if (request.hasHeader('replaces')) {\n                this._receiveReplaces(request);\n              } else {\n                this._receiveReinvite(request);\n              }\n            } else {\n              request.reply(403, 'Wrong Status');\n            }\n            break;\n          case JsSIP_C.INFO:\n            if (this._status === C.STATUS_1XX_RECEIVED || this._status === C.STATUS_WAITING_FOR_ANSWER || this._status === C.STATUS_ANSWERED || this._status === C.STATUS_WAITING_FOR_ACK || this._status === C.STATUS_CONFIRMED) {\n              var contentType = request.hasHeader('Content-Type') ? request.getHeader('Content-Type').toLowerCase() : undefined;\n              if (contentType && contentType.match(/^application\\/dtmf-relay/i)) {\n                new RTCSession_DTMF(this).init_incoming(request);\n              } else if (contentType !== undefined) {\n                new RTCSession_Info(this).init_incoming(request);\n              } else {\n                request.reply(415);\n              }\n            } else {\n              request.reply(403, 'Wrong Status');\n            }\n            break;\n          case JsSIP_C.UPDATE:\n            if (this._status === C.STATUS_CONFIRMED) {\n              this._receiveUpdate(request);\n            } else {\n              request.reply(403, 'Wrong Status');\n            }\n            break;\n          case JsSIP_C.REFER:\n            if (this._status === C.STATUS_CONFIRMED) {\n              this._receiveRefer(request);\n            } else {\n              request.reply(403, 'Wrong Status');\n            }\n            break;\n          case JsSIP_C.NOTIFY:\n            if (this._status === C.STATUS_CONFIRMED) {\n              this._receiveNotify(request);\n            } else {\n              request.reply(403, 'Wrong Status');\n            }\n            break;\n          default:\n            request.reply(501);\n        }\n      }\n    }\n    /**\n     * Session Callbacks\n     */\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      logger.warn('onTransportError()');\n      if (this._status !== C.STATUS_TERMINATED) {\n        this.terminate({\n          status_code: 500,\n          reason_phrase: JsSIP_C.causes.CONNECTION_ERROR,\n          cause: JsSIP_C.causes.CONNECTION_ERROR\n        });\n      }\n    }\n  }, {\n    key: \"onRequestTimeout\",\n    value: function onRequestTimeout() {\n      logger.warn('onRequestTimeout()');\n      if (this._status !== C.STATUS_TERMINATED) {\n        this.terminate({\n          status_code: 408,\n          reason_phrase: JsSIP_C.causes.REQUEST_TIMEOUT,\n          cause: JsSIP_C.causes.REQUEST_TIMEOUT\n        });\n      }\n    }\n  }, {\n    key: \"onDialogError\",\n    value: function onDialogError() {\n      logger.warn('onDialogError()');\n      if (this._status !== C.STATUS_TERMINATED) {\n        this.terminate({\n          status_code: 500,\n          reason_phrase: JsSIP_C.causes.DIALOG_ERROR,\n          cause: JsSIP_C.causes.DIALOG_ERROR\n        });\n      }\n    } // Called from DTMF handler.\n  }, {\n    key: \"newDTMF\",\n    value: function newDTMF(data) {\n      logger.debug('newDTMF()');\n      this.emit('newDTMF', data);\n    } // Called from Info handler.\n  }, {\n    key: \"newInfo\",\n    value: function newInfo(data) {\n      logger.debug('newInfo()');\n      this.emit('newInfo', data);\n    }\n    /**\n     * Check if RTCSession is ready for an outgoing re-INVITE or UPDATE with SDP.\n     */\n  }, {\n    key: \"_isReadyToReOffer\",\n    value: function _isReadyToReOffer() {\n      if (!this._rtcReady) {\n        logger.debug('_isReadyToReOffer() | internal WebRTC status not ready');\n        return false;\n      } // No established yet.\n\n      if (!this._dialog) {\n        logger.debug('_isReadyToReOffer() | session not established yet');\n        return false;\n      } // Another INVITE transaction is in progress.\n\n      if (this._dialog.uac_pending_reply === true || this._dialog.uas_pending_reply === true) {\n        logger.debug('_isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress');\n        return false;\n      }\n      return true;\n    }\n  }, {\n    key: \"_close\",\n    value: function _close() {\n      logger.debug('close()'); // Close local MediaStream if it was not given by the user.\n\n      if (this._localMediaStream && this._localMediaStreamLocallyGenerated) {\n        logger.debug('close() | closing local MediaStream');\n        Utils.closeMediaStream(this._localMediaStream);\n      }\n      if (this._status === C.STATUS_TERMINATED) {\n        return;\n      }\n      this._status = C.STATUS_TERMINATED; // Terminate RTC.\n\n      if (this._connection) {\n        try {\n          this._connection.close();\n        } catch (error) {\n          logger.warn('close() | error closing the RTCPeerConnection: %o', error);\n        }\n      } // Terminate signaling.\n      // Clear SIP timers.\n\n      for (var timer in this._timers) {\n        if (Object.prototype.hasOwnProperty.call(this._timers, timer)) {\n          clearTimeout(this._timers[timer]);\n        }\n      } // Clear Session Timers.\n\n      clearTimeout(this._sessionTimers.timer); // Terminate confirmed dialog.\n\n      if (this._dialog) {\n        this._dialog.terminate();\n        delete this._dialog;\n      } // Terminate early dialogs.\n\n      for (var dialog in this._earlyDialogs) {\n        if (Object.prototype.hasOwnProperty.call(this._earlyDialogs, dialog)) {\n          this._earlyDialogs[dialog].terminate();\n          delete this._earlyDialogs[dialog];\n        }\n      } // Terminate REFER subscribers.\n\n      for (var subscriber in this._referSubscribers) {\n        if (Object.prototype.hasOwnProperty.call(this._referSubscribers, subscriber)) {\n          delete this._referSubscribers[subscriber];\n        }\n      }\n      this._ua.destroyRTCSession(this);\n    }\n    /**\n     * Private API.\n     */\n\n    /**\n     * RFC3261 13.3.1.4\n     * Response retransmissions cannot be accomplished by transaction layer\n     *  since it is destroyed when receiving the first 2xx answer\n     */\n  }, {\n    key: \"_setInvite2xxTimer\",\n    value: function _setInvite2xxTimer(request, body) {\n      var timeout = Timers.T1;\n      function invite2xxRetransmission() {\n        if (this._status !== C.STATUS_WAITING_FOR_ACK) {\n          return;\n        }\n        request.reply(200, null, [\"Contact: \".concat(this._contact)], body);\n        if (timeout < Timers.T2) {\n          timeout = timeout * 2;\n          if (timeout > Timers.T2) {\n            timeout = Timers.T2;\n          }\n        }\n        this._timers.invite2xxTimer = setTimeout(invite2xxRetransmission.bind(this), timeout);\n      }\n      this._timers.invite2xxTimer = setTimeout(invite2xxRetransmission.bind(this), timeout);\n    }\n    /**\n     * RFC3261 14.2\n     * If a UAS generates a 2xx response and never receives an ACK,\n     *  it SHOULD generate a BYE to terminate the dialog.\n     */\n  }, {\n    key: \"_setACKTimer\",\n    value: function _setACKTimer() {\n      var _this11 = this;\n      this._timers.ackTimer = setTimeout(function () {\n        if (_this11._status === C.STATUS_WAITING_FOR_ACK) {\n          logger.debug('no ACK received, terminating the session');\n          clearTimeout(_this11._timers.invite2xxTimer);\n          _this11.sendRequest(JsSIP_C.BYE);\n          _this11._ended('remote', null, JsSIP_C.causes.NO_ACK);\n        }\n      }, Timers.TIMER_H);\n    }\n  }, {\n    key: \"_createRTCConnection\",\n    value: function _createRTCConnection(pcConfig, rtcConstraints) {\n      var _this12 = this;\n      this._connection = new RTCPeerConnection(pcConfig, rtcConstraints);\n      this._connection.addEventListener('iceconnectionstatechange', function () {\n        var state = _this12._connection.iceConnectionState; // TODO: Do more with different states.\n\n        if (state === 'failed') {\n          _this12.terminate({\n            cause: JsSIP_C.causes.RTP_TIMEOUT,\n            status_code: 408,\n            reason_phrase: JsSIP_C.causes.RTP_TIMEOUT\n          });\n        }\n      });\n      logger.debug('emit \"peerconnection\"');\n      this.emit('peerconnection', {\n        peerconnection: this._connection\n      });\n    }\n  }, {\n    key: \"_createLocalDescription\",\n    value: function _createLocalDescription(type, constraints) {\n      var _this13 = this;\n      logger.debug('createLocalDescription()');\n      if (type !== 'offer' && type !== 'answer') throw new Error(\"createLocalDescription() | invalid type \\\"\".concat(type, \"\\\"\"));\n      var connection = this._connection;\n      this._rtcReady = false;\n      return Promise.resolve() // Create Offer or Answer.\n      .then(function () {\n        if (type === 'offer') {\n          return connection.createOffer(constraints)[\"catch\"](function (error) {\n            logger.warn('emit \"peerconnection:createofferfailed\" [error:%o]', error);\n            _this13.emit('peerconnection:createofferfailed', error);\n            return Promise.reject(error);\n          });\n        } else {\n          return connection.createAnswer(constraints)[\"catch\"](function (error) {\n            logger.warn('emit \"peerconnection:createanswerfailed\" [error:%o]', error);\n            _this13.emit('peerconnection:createanswerfailed', error);\n            return Promise.reject(error);\n          });\n        }\n      }) // Set local description.\n      .then(function (desc) {\n        return connection.setLocalDescription(desc)[\"catch\"](function (error) {\n          _this13._rtcReady = true;\n          logger.warn('emit \"peerconnection:setlocaldescriptionfailed\" [error:%o]', error);\n          _this13.emit('peerconnection:setlocaldescriptionfailed', error);\n          return Promise.reject(error);\n        });\n      }).then(function () {\n        // Resolve right away if 'pc.iceGatheringState' is 'complete'.\n\n        /**\n         * Resolve right away if:\n         * - 'connection.iceGatheringState' is 'complete' and no 'iceRestart' constraint is set.\n         * - 'connection.iceGatheringState' is 'gathering' and 'iceReady' is true.\n         */\n        var iceRestart = constraints && constraints.iceRestart;\n        if (connection.iceGatheringState === 'complete' && !iceRestart || connection.iceGatheringState === 'gathering' && _this13._iceReady) {\n          _this13._rtcReady = true;\n          var e = {\n            originator: 'local',\n            type: type,\n            sdp: connection.localDescription.sdp\n          };\n          logger.debug('emit \"sdp\"');\n          _this13.emit('sdp', e);\n          return Promise.resolve(e.sdp);\n        } // Add 'pc.onicencandidate' event handler to resolve on last candidate.\n\n        return new Promise(function (resolve) {\n          var finished = false;\n          var iceCandidateListener;\n          var iceGatheringStateListener;\n          _this13._iceReady = false;\n          var ready = function ready() {\n            if (finished) {\n              return;\n            }\n            connection.removeEventListener('icecandidate', iceCandidateListener);\n            connection.removeEventListener('icegatheringstatechange', iceGatheringStateListener);\n            finished = true;\n            _this13._rtcReady = true; // connection.iceGatheringState will still indicate 'gathering' and thus be blocking.\n\n            _this13._iceReady = true;\n            var e = {\n              originator: 'local',\n              type: type,\n              sdp: connection.localDescription.sdp\n            };\n            logger.debug('emit \"sdp\"');\n            _this13.emit('sdp', e);\n            resolve(e.sdp);\n          };\n          connection.addEventListener('icecandidate', iceCandidateListener = function iceCandidateListener(event) {\n            var candidate = event.candidate;\n            if (candidate) {\n              _this13.emit('icecandidate', {\n                candidate: candidate,\n                ready: ready\n              });\n            } else {\n              ready();\n            }\n          });\n          connection.addEventListener('icegatheringstatechange', iceGatheringStateListener = function iceGatheringStateListener() {\n            if (connection.iceGatheringState === 'complete') {\n              ready();\n            }\n          });\n        });\n      });\n    }\n    /**\n     * Dialog Management\n     */\n  }, {\n    key: \"_createDialog\",\n    value: function _createDialog(message, type, early) {\n      var local_tag = type === 'UAS' ? message.to_tag : message.from_tag;\n      var remote_tag = type === 'UAS' ? message.from_tag : message.to_tag;\n      var id = message.call_id + local_tag + remote_tag;\n      var early_dialog = this._earlyDialogs[id]; // Early Dialog.\n\n      if (early) {\n        if (early_dialog) {\n          return true;\n        } else {\n          early_dialog = new Dialog(this, message, type, Dialog.C.STATUS_EARLY); // Dialog has been successfully created.\n\n          if (early_dialog.error) {\n            logger.debug(early_dialog.error);\n            this._failed('remote', message, JsSIP_C.causes.INTERNAL_ERROR);\n            return false;\n          } else {\n            this._earlyDialogs[id] = early_dialog;\n            return true;\n          }\n        }\n      } // Confirmed Dialog.\n      else {\n        this._from_tag = message.from_tag;\n        this._to_tag = message.to_tag; // In case the dialog is in _early_ state, update it.\n\n        if (early_dialog) {\n          early_dialog.update(message, type);\n          this._dialog = early_dialog;\n          delete this._earlyDialogs[id];\n          return true;\n        } // Otherwise, create a _confirmed_ dialog.\n\n        var dialog = new Dialog(this, message, type);\n        if (dialog.error) {\n          logger.debug(dialog.error);\n          this._failed('remote', message, JsSIP_C.causes.INTERNAL_ERROR);\n          return false;\n        } else {\n          this._dialog = dialog;\n          return true;\n        }\n      }\n    }\n    /**\n     * In dialog INVITE Reception\n     */\n  }, {\n    key: \"_receiveReinvite\",\n    value: function _receiveReinvite(request) {\n      var _this14 = this;\n      logger.debug('receiveReinvite()');\n      var contentType = request.hasHeader('Content-Type') ? request.getHeader('Content-Type').toLowerCase() : undefined;\n      var data = {\n        request: request,\n        callback: undefined,\n        reject: reject.bind(this)\n      };\n      var rejected = false;\n      function reject() {\n        var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n        rejected = true;\n        var status_code = options.status_code || 403;\n        var reason_phrase = options.reason_phrase || '';\n        var extraHeaders = Utils.cloneArray(options.extraHeaders);\n        if (this._status !== C.STATUS_CONFIRMED) {\n          return false;\n        }\n        if (status_code < 300 || status_code >= 700) {\n          throw new TypeError(\"Invalid status_code: \".concat(status_code));\n        }\n        request.reply(status_code, reason_phrase, extraHeaders);\n      } // Emit 'reinvite'.\n\n      this.emit('reinvite', data);\n      if (rejected) {\n        return;\n      }\n      this._late_sdp = false; // Request without SDP.\n\n      if (!request.body) {\n        this._late_sdp = true;\n        if (this._remoteHold) {\n          this._remoteHold = false;\n          this._onunhold('remote');\n        }\n        this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n          return _this14._createLocalDescription('offer', _this14._rtcOfferConstraints);\n        }).then(function (sdp) {\n          sendAnswer.call(_this14, sdp);\n        })[\"catch\"](function () {\n          request.reply(500);\n        });\n        return;\n      } // Request with SDP.\n\n      if (contentType !== 'application/sdp') {\n        logger.debug('invalid Content-Type');\n        request.reply(415);\n        return;\n      }\n      this._processInDialogSdpOffer(request) // Send answer.\n      .then(function (desc) {\n        if (_this14._status === C.STATUS_TERMINATED) {\n          return;\n        }\n        sendAnswer.call(_this14, desc);\n      })[\"catch\"](function (error) {\n        logger.warn(error);\n      });\n      function sendAnswer(desc) {\n        var _this15 = this;\n        var extraHeaders = [\"Contact: \".concat(this._contact)];\n        this._handleSessionTimersInIncomingRequest(request, extraHeaders);\n        if (this._late_sdp) {\n          desc = this._mangleOffer(desc);\n        }\n        request.reply(200, null, extraHeaders, desc, function () {\n          _this15._status = C.STATUS_WAITING_FOR_ACK;\n          _this15._setInvite2xxTimer(request, desc);\n          _this15._setACKTimer();\n        }); // If callback is given execute it.\n\n        if (typeof data.callback === 'function') {\n          data.callback();\n        }\n      }\n    }\n    /**\n     * In dialog UPDATE Reception\n     */\n  }, {\n    key: \"_receiveUpdate\",\n    value: function _receiveUpdate(request) {\n      var _this16 = this;\n      logger.debug('receiveUpdate()');\n      var contentType = request.hasHeader('Content-Type') ? request.getHeader('Content-Type').toLowerCase() : undefined;\n      var data = {\n        request: request,\n        callback: undefined,\n        reject: reject.bind(this)\n      };\n      var rejected = false;\n      function reject() {\n        var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n        rejected = true;\n        var status_code = options.status_code || 403;\n        var reason_phrase = options.reason_phrase || '';\n        var extraHeaders = Utils.cloneArray(options.extraHeaders);\n        if (this._status !== C.STATUS_CONFIRMED) {\n          return false;\n        }\n        if (status_code < 300 || status_code >= 700) {\n          throw new TypeError(\"Invalid status_code: \".concat(status_code));\n        }\n        request.reply(status_code, reason_phrase, extraHeaders);\n      } // Emit 'update'.\n\n      this.emit('update', data);\n      if (rejected) {\n        return;\n      }\n      if (!request.body) {\n        sendAnswer.call(this, null);\n        return;\n      }\n      if (contentType !== 'application/sdp') {\n        logger.debug('invalid Content-Type');\n        request.reply(415);\n        return;\n      }\n      this._processInDialogSdpOffer(request) // Send answer.\n      .then(function (desc) {\n        if (_this16._status === C.STATUS_TERMINATED) {\n          return;\n        }\n        sendAnswer.call(_this16, desc);\n      })[\"catch\"](function (error) {\n        logger.warn(error);\n      });\n      function sendAnswer(desc) {\n        var extraHeaders = [\"Contact: \".concat(this._contact)];\n        this._handleSessionTimersInIncomingRequest(request, extraHeaders);\n        request.reply(200, null, extraHeaders, desc); // If callback is given execute it.\n\n        if (typeof data.callback === 'function') {\n          data.callback();\n        }\n      }\n    }\n  }, {\n    key: \"_processInDialogSdpOffer\",\n    value: function _processInDialogSdpOffer(request) {\n      var _this17 = this;\n      logger.debug('_processInDialogSdpOffer()');\n      var sdp = request.parseSDP();\n      var hold = false;\n      var _iterator4 = _createForOfIteratorHelper(sdp.media),\n        _step4;\n      try {\n        for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n          var m = _step4.value;\n          if (holdMediaTypes.indexOf(m.type) === -1) {\n            continue;\n          }\n          var direction = m.direction || sdp.direction || 'sendrecv';\n          if (direction === 'sendonly' || direction === 'inactive') {\n            hold = true;\n          } // If at least one of the streams is active don't emit 'hold'.\n          else {\n            hold = false;\n            break;\n          }\n        }\n      } catch (err) {\n        _iterator4.e(err);\n      } finally {\n        _iterator4.f();\n      }\n      var e = {\n        originator: 'remote',\n        type: 'offer',\n        sdp: request.body\n      };\n      logger.debug('emit \"sdp\"');\n      this.emit('sdp', e);\n      var offer = new RTCSessionDescription({\n        type: 'offer',\n        sdp: e.sdp\n      });\n      this._connectionPromiseQueue = this._connectionPromiseQueue // Set remote description.\n      .then(function () {\n        if (_this17._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        }\n        return _this17._connection.setRemoteDescription(offer)[\"catch\"](function (error) {\n          request.reply(488);\n          logger.warn('emit \"peerconnection:setremotedescriptionfailed\" [error:%o]', error);\n          _this17.emit('peerconnection:setremotedescriptionfailed', error);\n          throw error;\n        });\n      }).then(function () {\n        if (_this17._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        }\n        if (_this17._remoteHold === true && hold === false) {\n          _this17._remoteHold = false;\n          _this17._onunhold('remote');\n        } else if (_this17._remoteHold === false && hold === true) {\n          _this17._remoteHold = true;\n          _this17._onhold('remote');\n        }\n      }) // Create local description.\n      .then(function () {\n        if (_this17._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        }\n        return _this17._createLocalDescription('answer', _this17._rtcAnswerConstraints)[\"catch\"](function (error) {\n          request.reply(500);\n          logger.warn('emit \"peerconnection:createtelocaldescriptionfailed\" [error:%o]', error);\n          throw error;\n        });\n      })[\"catch\"](function (error) {\n        logger.warn('_processInDialogSdpOffer() failed [error: %o]', error);\n      });\n      return this._connectionPromiseQueue;\n    }\n    /**\n     * In dialog Refer Reception\n     */\n  }, {\n    key: \"_receiveRefer\",\n    value: function _receiveRefer(request) {\n      var _this18 = this;\n      logger.debug('receiveRefer()');\n      if (!request.refer_to) {\n        logger.debug('no Refer-To header field present in REFER');\n        request.reply(400);\n        return;\n      }\n      if (request.refer_to.uri.scheme !== JsSIP_C.SIP) {\n        logger.debug('Refer-To header field points to a non-SIP URI scheme');\n        request.reply(416);\n        return;\n      } // Reply before the transaction timer expires.\n\n      request.reply(202);\n      var notifier = new RTCSession_ReferNotifier(this, request.cseq);\n      logger.debug('emit \"refer\"'); // Emit 'refer'.\n\n      this.emit('refer', {\n        request: request,\n        accept: function accept(initCallback, options) {\n          _accept.call(_this18, initCallback, options);\n        },\n        reject: function reject() {\n          _reject.call(_this18);\n        }\n      });\n      function _accept(initCallback) {\n        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n        initCallback = typeof initCallback === 'function' ? initCallback : null;\n        if (this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_CONFIRMED) {\n          return false;\n        }\n        var session = new RTCSession(this._ua);\n        session.on('progress', function (_ref2) {\n          var response = _ref2.response;\n          notifier.notify(response.status_code, response.reason_phrase);\n        });\n        session.on('accepted', function (_ref3) {\n          var response = _ref3.response;\n          notifier.notify(response.status_code, response.reason_phrase);\n        });\n        session.on('_failed', function (_ref4) {\n          var message = _ref4.message,\n            cause = _ref4.cause;\n          if (message) {\n            notifier.notify(message.status_code, message.reason_phrase);\n          } else {\n            notifier.notify(487, cause);\n          }\n        }); // Consider the Replaces header present in the Refer-To URI.\n\n        if (request.refer_to.uri.hasHeader('replaces')) {\n          var replaces = decodeURIComponent(request.refer_to.uri.getHeader('replaces'));\n          options.extraHeaders = Utils.cloneArray(options.extraHeaders);\n          options.extraHeaders.push(\"Replaces: \".concat(replaces));\n        }\n        session.connect(request.refer_to.uri.toAor(), options, initCallback);\n      }\n      function _reject() {\n        notifier.notify(603);\n      }\n    }\n    /**\n     * In dialog Notify Reception\n     */\n  }, {\n    key: \"_receiveNotify\",\n    value: function _receiveNotify(request) {\n      logger.debug('receiveNotify()');\n      if (!request.event) {\n        request.reply(400);\n      }\n      switch (request.event.event) {\n        case 'refer':\n          {\n            var id;\n            var referSubscriber;\n            if (request.event.params && request.event.params.id) {\n              id = request.event.params.id;\n              referSubscriber = this._referSubscribers[id];\n            } else if (Object.keys(this._referSubscribers).length === 1) {\n              referSubscriber = this._referSubscribers[Object.keys(this._referSubscribers)[0]];\n            } else {\n              request.reply(400, 'Missing event id parameter');\n              return;\n            }\n            if (!referSubscriber) {\n              request.reply(481, 'Subscription does not exist');\n              return;\n            }\n            referSubscriber.receiveNotify(request);\n            request.reply(200);\n            break;\n          }\n        default:\n          {\n            request.reply(489);\n          }\n      }\n    }\n    /**\n     * INVITE with Replaces Reception\n     */\n  }, {\n    key: \"_receiveReplaces\",\n    value: function _receiveReplaces(request) {\n      var _this20 = this;\n      logger.debug('receiveReplaces()');\n      function _accept2(initCallback) {\n        var _this19 = this;\n        if (this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_CONFIRMED) {\n          return false;\n        }\n        var session = new RTCSession(this._ua); // Terminate the current session when the new one is confirmed.\n\n        session.on('confirmed', function () {\n          _this19.terminate();\n        });\n        session.init_incoming(request, initCallback);\n      }\n      function _reject2() {\n        logger.debug('Replaced INVITE rejected by the user');\n        request.reply(486);\n      } // Emit 'replace'.\n\n      this.emit('replaces', {\n        request: request,\n        accept: function accept(initCallback) {\n          _accept2.call(_this20, initCallback);\n        },\n        reject: function reject() {\n          _reject2.call(_this20);\n        }\n      });\n    }\n    /**\n     * Initial Request Sender\n     */\n  }, {\n    key: \"_sendInitialRequest\",\n    value: function _sendInitialRequest(mediaConstraints, rtcOfferConstraints, mediaStream) {\n      var _this21 = this;\n      var request_sender = new RequestSender(this._ua, this._request, {\n        onRequestTimeout: function onRequestTimeout() {\n          _this21.onRequestTimeout();\n        },\n        onTransportError: function onTransportError() {\n          _this21.onTransportError();\n        },\n        // Update the request on authentication.\n        onAuthenticated: function onAuthenticated(request) {\n          _this21._request = request;\n        },\n        onReceiveResponse: function onReceiveResponse(response) {\n          _this21._receiveInviteResponse(response);\n        }\n      }); // This Promise is resolved within the next iteration, so the app has now\n      // a chance to set events such as 'peerconnection' and 'connecting'.\n\n      Promise.resolve() // Get a stream if required.\n      .then(function () {\n        // A stream is given, let the app set events such as 'peerconnection' and 'connecting'.\n        if (mediaStream) {\n          return mediaStream;\n        } // Request for user media access.\n        else if (mediaConstraints.audio || mediaConstraints.video) {\n          _this21._localMediaStreamLocallyGenerated = true;\n          return navigator.mediaDevices.getUserMedia(mediaConstraints)[\"catch\"](function (error) {\n            if (_this21._status === C.STATUS_TERMINATED) {\n              throw new Error('terminated');\n            }\n            _this21._failed('local', null, JsSIP_C.causes.USER_DENIED_MEDIA_ACCESS);\n            logger.warn('emit \"getusermediafailed\" [error:%o]', error);\n            _this21.emit('getusermediafailed', error);\n            throw error;\n          });\n        }\n      }).then(function (stream) {\n        if (_this21._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        }\n        _this21._localMediaStream = stream;\n        if (stream) {\n          stream.getTracks().forEach(function (track) {\n            _this21._connection.addTrack(track, stream);\n          });\n        } // TODO: should this be triggered here?\n\n        _this21._connecting(_this21._request);\n        return _this21._createLocalDescription('offer', rtcOfferConstraints)[\"catch\"](function (error) {\n          _this21._failed('local', null, JsSIP_C.causes.WEBRTC_ERROR);\n          throw error;\n        });\n      }).then(function (desc) {\n        if (_this21._is_canceled || _this21._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        }\n        _this21._request.body = desc;\n        _this21._status = C.STATUS_INVITE_SENT;\n        logger.debug('emit \"sending\" [request:%o]', _this21._request); // Emit 'sending' so the app can mangle the body before the request is sent.\n\n        _this21.emit('sending', {\n          request: _this21._request\n        });\n        request_sender.send();\n      })[\"catch\"](function (error) {\n        if (_this21._status === C.STATUS_TERMINATED) {\n          return;\n        }\n        logger.warn(error);\n      });\n    }\n    /**\n     * Get DTMF RTCRtpSender.\n     */\n  }, {\n    key: \"_getDTMFRTPSender\",\n    value: function _getDTMFRTPSender() {\n      var sender = this._connection.getSenders().find(function (rtpSender) {\n        return rtpSender.track && rtpSender.track.kind === 'audio';\n      });\n      if (!(sender && sender.dtmf)) {\n        logger.warn('sendDTMF() | no local audio track to send DTMF with');\n        return;\n      }\n      return sender.dtmf;\n    }\n    /**\n     * Reception of Response for Initial INVITE\n     */\n  }, {\n    key: \"_receiveInviteResponse\",\n    value: function _receiveInviteResponse(response) {\n      var _this22 = this;\n      logger.debug('receiveInviteResponse()'); // Handle 2XX retransmissions and responses from forked requests.\n\n      if (this._dialog && response.status_code >= 200 && response.status_code <= 299) {\n        /*\n         * If it is a retransmission from the endpoint that established\n         * the dialog, send an ACK\n         */\n        if (this._dialog.id.call_id === response.call_id && this._dialog.id.local_tag === response.from_tag && this._dialog.id.remote_tag === response.to_tag) {\n          this.sendRequest(JsSIP_C.ACK);\n          return;\n        } // If not, send an ACK  and terminate.\n        else {\n          var dialog = new Dialog(this, response, 'UAC');\n          if (dialog.error !== undefined) {\n            logger.debug(dialog.error);\n            return;\n          }\n          this.sendRequest(JsSIP_C.ACK);\n          this.sendRequest(JsSIP_C.BYE);\n          return;\n        }\n      } // Proceed to cancellation if the user requested.\n\n      if (this._is_canceled) {\n        if (response.status_code >= 100 && response.status_code < 200) {\n          this._request.cancel(this._cancel_reason);\n        } else if (response.status_code >= 200 && response.status_code < 299) {\n          this._acceptAndTerminate(response);\n        }\n        return;\n      }\n      if (this._status !== C.STATUS_INVITE_SENT && this._status !== C.STATUS_1XX_RECEIVED) {\n        return;\n      }\n      switch (true) {\n        case /^100$/.test(response.status_code):\n          this._status = C.STATUS_1XX_RECEIVED;\n          break;\n        case /^1[0-9]{2}$/.test(response.status_code):\n          {\n            // Do nothing with 1xx responses without To tag.\n            if (!response.to_tag) {\n              logger.debug('1xx response received without to tag');\n              break;\n            } // Create Early Dialog if 1XX comes with contact.\n\n            if (response.hasHeader('contact')) {\n              // An error on dialog creation will fire 'failed' event.\n              if (!this._createDialog(response, 'UAC', true)) {\n                break;\n              }\n            }\n            this._status = C.STATUS_1XX_RECEIVED;\n            if (!response.body) {\n              this._progress('remote', response);\n              break;\n            }\n            var e = {\n              originator: 'remote',\n              type: 'answer',\n              sdp: response.body\n            };\n            logger.debug('emit \"sdp\"');\n            this.emit('sdp', e);\n            var answer = new RTCSessionDescription({\n              type: 'answer',\n              sdp: e.sdp\n            });\n            this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n              return _this22._connection.setRemoteDescription(answer);\n            }).then(function () {\n              return _this22._progress('remote', response);\n            })[\"catch\"](function (error) {\n              logger.warn('emit \"peerconnection:setremotedescriptionfailed\" [error:%o]', error);\n              _this22.emit('peerconnection:setremotedescriptionfailed', error);\n            });\n            break;\n          }\n        case /^2[0-9]{2}$/.test(response.status_code):\n          {\n            this._status = C.STATUS_CONFIRMED;\n            if (!response.body) {\n              this._acceptAndTerminate(response, 400, JsSIP_C.causes.MISSING_SDP);\n              this._failed('remote', response, JsSIP_C.causes.BAD_MEDIA_DESCRIPTION);\n              break;\n            } // An error on dialog creation will fire 'failed' event.\n\n            if (!this._createDialog(response, 'UAC')) {\n              break;\n            }\n            var _e = {\n              originator: 'remote',\n              type: 'answer',\n              sdp: response.body\n            };\n            logger.debug('emit \"sdp\"');\n            this.emit('sdp', _e);\n            var _answer = new RTCSessionDescription({\n              type: 'answer',\n              sdp: _e.sdp\n            });\n            this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n              // Be ready for 200 with SDP after a 180/183 with SDP.\n              // We created a SDP 'answer' for it, so check the current signaling state.\n              if (_this22._connection.signalingState === 'stable') {\n                return _this22._connection.createOffer(_this22._rtcOfferConstraints).then(function (offer) {\n                  return _this22._connection.setLocalDescription(offer);\n                })[\"catch\"](function (error) {\n                  _this22._acceptAndTerminate(response, 500, error.toString());\n                  _this22._failed('local', response, JsSIP_C.causes.WEBRTC_ERROR);\n                });\n              }\n            }).then(function () {\n              _this22._connection.setRemoteDescription(_answer).then(function () {\n                // Handle Session Timers.\n                _this22._handleSessionTimersInIncomingResponse(response);\n                _this22._accepted('remote', response);\n                _this22.sendRequest(JsSIP_C.ACK);\n                _this22._confirmed('local', null);\n              })[\"catch\"](function (error) {\n                _this22._acceptAndTerminate(response, 488, 'Not Acceptable Here');\n                _this22._failed('remote', response, JsSIP_C.causes.BAD_MEDIA_DESCRIPTION);\n                logger.warn('emit \"peerconnection:setremotedescriptionfailed\" [error:%o]', error);\n                _this22.emit('peerconnection:setremotedescriptionfailed', error);\n              });\n            });\n            break;\n          }\n        default:\n          {\n            var cause = Utils.sipErrorCause(response.status_code);\n            this._failed('remote', response, cause);\n          }\n      }\n    }\n    /**\n     * Send Re-INVITE\n     */\n  }, {\n    key: \"_sendReinvite\",\n    value: function _sendReinvite() {\n      var _this23 = this;\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      logger.debug('sendReinvite()');\n      var extraHeaders = Utils.cloneArray(options.extraHeaders);\n      var eventHandlers = Utils.cloneObject(options.eventHandlers);\n      var rtcOfferConstraints = options.rtcOfferConstraints || this._rtcOfferConstraints || null;\n      var succeeded = false;\n      extraHeaders.push(\"Contact: \".concat(this._contact));\n      extraHeaders.push('Content-Type: application/sdp'); // Session Timers.\n\n      if (this._sessionTimers.running) {\n        extraHeaders.push(\"Session-Expires: \".concat(this._sessionTimers.currentExpires, \";refresher=\").concat(this._sessionTimers.refresher ? 'uac' : 'uas'));\n      }\n      this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n        return _this23._createLocalDescription('offer', rtcOfferConstraints);\n      }).then(function (sdp) {\n        sdp = _this23._mangleOffer(sdp);\n        var e = {\n          originator: 'local',\n          type: 'offer',\n          sdp: sdp\n        };\n        logger.debug('emit \"sdp\"');\n        _this23.emit('sdp', e);\n        _this23.sendRequest(JsSIP_C.INVITE, {\n          extraHeaders: extraHeaders,\n          body: sdp,\n          eventHandlers: {\n            onSuccessResponse: function onSuccessResponse(response) {\n              onSucceeded.call(_this23, response);\n              succeeded = true;\n            },\n            onErrorResponse: function onErrorResponse(response) {\n              onFailed.call(_this23, response);\n            },\n            onTransportError: function onTransportError() {\n              _this23.onTransportError(); // Do nothing because session ends.\n            },\n            onRequestTimeout: function onRequestTimeout() {\n              _this23.onRequestTimeout(); // Do nothing because session ends.\n            },\n            onDialogError: function onDialogError() {\n              _this23.onDialogError(); // Do nothing because session ends.\n            }\n          }\n        });\n      })[\"catch\"](function () {\n        onFailed();\n      });\n      function onSucceeded(response) {\n        var _this24 = this;\n        if (this._status === C.STATUS_TERMINATED) {\n          return;\n        }\n        this.sendRequest(JsSIP_C.ACK); // If it is a 2XX retransmission exit now.\n\n        if (succeeded) {\n          return;\n        } // Handle Session Timers.\n\n        this._handleSessionTimersInIncomingResponse(response); // Must have SDP answer.\n\n        if (!response.body) {\n          onFailed.call(this);\n          return;\n        } else if (!response.hasHeader('Content-Type') || response.getHeader('Content-Type').toLowerCase() !== 'application/sdp') {\n          onFailed.call(this);\n          return;\n        }\n        var e = {\n          originator: 'remote',\n          type: 'answer',\n          sdp: response.body\n        };\n        logger.debug('emit \"sdp\"');\n        this.emit('sdp', e);\n        var answer = new RTCSessionDescription({\n          type: 'answer',\n          sdp: e.sdp\n        });\n        this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n          return _this24._connection.setRemoteDescription(answer);\n        }).then(function () {\n          if (eventHandlers.succeeded) {\n            eventHandlers.succeeded(response);\n          }\n        })[\"catch\"](function (error) {\n          onFailed.call(_this24);\n          logger.warn('emit \"peerconnection:setremotedescriptionfailed\" [error:%o]', error);\n          _this24.emit('peerconnection:setremotedescriptionfailed', error);\n        });\n      }\n      function onFailed(response) {\n        if (eventHandlers.failed) {\n          eventHandlers.failed(response);\n        }\n      }\n    }\n    /**\n     * Send UPDATE\n     */\n  }, {\n    key: \"_sendUpdate\",\n    value: function _sendUpdate() {\n      var _this25 = this;\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      logger.debug('sendUpdate()');\n      var extraHeaders = Utils.cloneArray(options.extraHeaders);\n      var eventHandlers = Utils.cloneObject(options.eventHandlers);\n      var rtcOfferConstraints = options.rtcOfferConstraints || this._rtcOfferConstraints || null;\n      var sdpOffer = options.sdpOffer || false;\n      var succeeded = false;\n      extraHeaders.push(\"Contact: \".concat(this._contact)); // Session Timers.\n\n      if (this._sessionTimers.running) {\n        extraHeaders.push(\"Session-Expires: \".concat(this._sessionTimers.currentExpires, \";refresher=\").concat(this._sessionTimers.refresher ? 'uac' : 'uas'));\n      }\n      if (sdpOffer) {\n        extraHeaders.push('Content-Type: application/sdp');\n        this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n          return _this25._createLocalDescription('offer', rtcOfferConstraints);\n        }).then(function (sdp) {\n          sdp = _this25._mangleOffer(sdp);\n          var e = {\n            originator: 'local',\n            type: 'offer',\n            sdp: sdp\n          };\n          logger.debug('emit \"sdp\"');\n          _this25.emit('sdp', e);\n          _this25.sendRequest(JsSIP_C.UPDATE, {\n            extraHeaders: extraHeaders,\n            body: sdp,\n            eventHandlers: {\n              onSuccessResponse: function onSuccessResponse(response) {\n                onSucceeded.call(_this25, response);\n                succeeded = true;\n              },\n              onErrorResponse: function onErrorResponse(response) {\n                onFailed.call(_this25, response);\n              },\n              onTransportError: function onTransportError() {\n                _this25.onTransportError(); // Do nothing because session ends.\n              },\n              onRequestTimeout: function onRequestTimeout() {\n                _this25.onRequestTimeout(); // Do nothing because session ends.\n              },\n              onDialogError: function onDialogError() {\n                _this25.onDialogError(); // Do nothing because session ends.\n              }\n            }\n          });\n        })[\"catch\"](function () {\n          onFailed.call(_this25);\n        });\n      } // No SDP.\n      else {\n        this.sendRequest(JsSIP_C.UPDATE, {\n          extraHeaders: extraHeaders,\n          eventHandlers: {\n            onSuccessResponse: function onSuccessResponse(response) {\n              onSucceeded.call(_this25, response);\n            },\n            onErrorResponse: function onErrorResponse(response) {\n              onFailed.call(_this25, response);\n            },\n            onTransportError: function onTransportError() {\n              _this25.onTransportError(); // Do nothing because session ends.\n            },\n            onRequestTimeout: function onRequestTimeout() {\n              _this25.onRequestTimeout(); // Do nothing because session ends.\n            },\n            onDialogError: function onDialogError() {\n              _this25.onDialogError(); // Do nothing because session ends.\n            }\n          }\n        });\n      }\n      function onSucceeded(response) {\n        var _this26 = this;\n        if (this._status === C.STATUS_TERMINATED) {\n          return;\n        } // If it is a 2XX retransmission exit now.\n\n        if (succeeded) {\n          return;\n        } // Handle Session Timers.\n\n        this._handleSessionTimersInIncomingResponse(response); // Must have SDP answer.\n\n        if (sdpOffer) {\n          if (!response.body) {\n            onFailed.call(this);\n            return;\n          } else if (!response.hasHeader('Content-Type') || response.getHeader('Content-Type').toLowerCase() !== 'application/sdp') {\n            onFailed.call(this);\n            return;\n          }\n          var e = {\n            originator: 'remote',\n            type: 'answer',\n            sdp: response.body\n          };\n          logger.debug('emit \"sdp\"');\n          this.emit('sdp', e);\n          var answer = new RTCSessionDescription({\n            type: 'answer',\n            sdp: e.sdp\n          });\n          this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n            return _this26._connection.setRemoteDescription(answer);\n          }).then(function () {\n            if (eventHandlers.succeeded) {\n              eventHandlers.succeeded(response);\n            }\n          })[\"catch\"](function (error) {\n            onFailed.call(_this26);\n            logger.warn('emit \"peerconnection:setremotedescriptionfailed\" [error:%o]', error);\n            _this26.emit('peerconnection:setremotedescriptionfailed', error);\n          });\n        } // No SDP answer.\n        else if (eventHandlers.succeeded) {\n          eventHandlers.succeeded(response);\n        }\n      }\n      function onFailed(response) {\n        if (eventHandlers.failed) {\n          eventHandlers.failed(response);\n        }\n      }\n    }\n  }, {\n    key: \"_acceptAndTerminate\",\n    value: function _acceptAndTerminate(response, status_code, reason_phrase) {\n      logger.debug('acceptAndTerminate()');\n      var extraHeaders = [];\n      if (status_code) {\n        reason_phrase = reason_phrase || JsSIP_C.REASON_PHRASE[status_code] || '';\n        extraHeaders.push(\"Reason: SIP ;cause=\".concat(status_code, \"; text=\\\"\").concat(reason_phrase, \"\\\"\"));\n      } // An error on dialog creation will fire 'failed' event.\n\n      if (this._dialog || this._createDialog(response, 'UAC')) {\n        this.sendRequest(JsSIP_C.ACK);\n        this.sendRequest(JsSIP_C.BYE, {\n          extraHeaders: extraHeaders\n        });\n      } // Update session status.\n\n      this._status = C.STATUS_TERMINATED;\n    }\n    /**\n     * Correctly set the SDP direction attributes if the call is on local hold\n     */\n  }, {\n    key: \"_mangleOffer\",\n    value: function _mangleOffer(sdp) {\n      if (!this._localHold && !this._remoteHold) {\n        return sdp;\n      }\n      sdp = sdp_transform.parse(sdp); // Local hold.\n\n      if (this._localHold && !this._remoteHold) {\n        logger.debug('mangleOffer() | me on hold, mangling offer');\n        var _iterator5 = _createForOfIteratorHelper(sdp.media),\n          _step5;\n        try {\n          for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n            var m = _step5.value;\n            if (holdMediaTypes.indexOf(m.type) === -1) {\n              continue;\n            }\n            if (!m.direction) {\n              m.direction = 'sendonly';\n            } else if (m.direction === 'sendrecv') {\n              m.direction = 'sendonly';\n            } else if (m.direction === 'recvonly') {\n              m.direction = 'inactive';\n            }\n          }\n        } catch (err) {\n          _iterator5.e(err);\n        } finally {\n          _iterator5.f();\n        }\n      } // Local and remote hold.\n      else if (this._localHold && this._remoteHold) {\n        logger.debug('mangleOffer() | both on hold, mangling offer');\n        var _iterator6 = _createForOfIteratorHelper(sdp.media),\n          _step6;\n        try {\n          for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n            var _m = _step6.value;\n            if (holdMediaTypes.indexOf(_m.type) === -1) {\n              continue;\n            }\n            _m.direction = 'inactive';\n          }\n        } catch (err) {\n          _iterator6.e(err);\n        } finally {\n          _iterator6.f();\n        }\n      } // Remote hold.\n      else if (this._remoteHold) {\n        logger.debug('mangleOffer() | remote on hold, mangling offer');\n        var _iterator7 = _createForOfIteratorHelper(sdp.media),\n          _step7;\n        try {\n          for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {\n            var _m2 = _step7.value;\n            if (holdMediaTypes.indexOf(_m2.type) === -1) {\n              continue;\n            }\n            if (!_m2.direction) {\n              _m2.direction = 'recvonly';\n            } else if (_m2.direction === 'sendrecv') {\n              _m2.direction = 'recvonly';\n            } else if (_m2.direction === 'recvonly') {\n              _m2.direction = 'inactive';\n            }\n          }\n        } catch (err) {\n          _iterator7.e(err);\n        } finally {\n          _iterator7.f();\n        }\n      }\n      return sdp_transform.write(sdp);\n    }\n  }, {\n    key: \"_setLocalMediaStatus\",\n    value: function _setLocalMediaStatus() {\n      var enableAudio = true,\n        enableVideo = true;\n      if (this._localHold || this._remoteHold) {\n        enableAudio = false;\n        enableVideo = false;\n      }\n      if (this._audioMuted) {\n        enableAudio = false;\n      }\n      if (this._videoMuted) {\n        enableVideo = false;\n      }\n      this._toggleMuteAudio(!enableAudio);\n      this._toggleMuteVideo(!enableVideo);\n    }\n    /**\n     * Handle SessionTimers for an incoming INVITE or UPDATE.\n     * @param  {IncomingRequest} request\n     * @param  {Array} responseExtraHeaders  Extra headers for the 200 response.\n     */\n  }, {\n    key: \"_handleSessionTimersInIncomingRequest\",\n    value: function _handleSessionTimersInIncomingRequest(request, responseExtraHeaders) {\n      if (!this._sessionTimers.enabled) {\n        return;\n      }\n      var session_expires_refresher;\n      if (request.session_expires && request.session_expires >= JsSIP_C.MIN_SESSION_EXPIRES) {\n        this._sessionTimers.currentExpires = request.session_expires;\n        session_expires_refresher = request.session_expires_refresher || 'uas';\n      } else {\n        this._sessionTimers.currentExpires = this._sessionTimers.defaultExpires;\n        session_expires_refresher = 'uas';\n      }\n      responseExtraHeaders.push(\"Session-Expires: \".concat(this._sessionTimers.currentExpires, \";refresher=\").concat(session_expires_refresher));\n      this._sessionTimers.refresher = session_expires_refresher === 'uas';\n      this._runSessionTimer();\n    }\n    /**\n     * Handle SessionTimers for an incoming response to INVITE or UPDATE.\n     * @param  {IncomingResponse} response\n     */\n  }, {\n    key: \"_handleSessionTimersInIncomingResponse\",\n    value: function _handleSessionTimersInIncomingResponse(response) {\n      if (!this._sessionTimers.enabled) {\n        return;\n      }\n      var session_expires_refresher;\n      if (response.session_expires && response.session_expires >= JsSIP_C.MIN_SESSION_EXPIRES) {\n        this._sessionTimers.currentExpires = response.session_expires;\n        session_expires_refresher = response.session_expires_refresher || 'uac';\n      } else {\n        this._sessionTimers.currentExpires = this._sessionTimers.defaultExpires;\n        session_expires_refresher = 'uac';\n      }\n      this._sessionTimers.refresher = session_expires_refresher === 'uac';\n      this._runSessionTimer();\n    }\n  }, {\n    key: \"_runSessionTimer\",\n    value: function _runSessionTimer() {\n      var _this27 = this;\n      var expires = this._sessionTimers.currentExpires;\n      this._sessionTimers.running = true;\n      clearTimeout(this._sessionTimers.timer); // I'm the refresher.\n\n      if (this._sessionTimers.refresher) {\n        this._sessionTimers.timer = setTimeout(function () {\n          if (_this27._status === C.STATUS_TERMINATED) {\n            return;\n          }\n          if (!_this27._isReadyToReOffer()) {\n            return;\n          }\n          logger.debug('runSessionTimer() | sending session refresh request');\n          if (_this27._sessionTimers.refreshMethod === JsSIP_C.UPDATE) {\n            _this27._sendUpdate();\n          } else {\n            _this27._sendReinvite();\n          }\n        }, expires * 500); // Half the given interval (as the RFC states).\n      } // I'm not the refresher.\n      else {\n        this._sessionTimers.timer = setTimeout(function () {\n          if (_this27._status === C.STATUS_TERMINATED) {\n            return;\n          }\n          logger.warn('runSessionTimer() | timer expired, terminating the session');\n          _this27.terminate({\n            cause: JsSIP_C.causes.REQUEST_TIMEOUT,\n            status_code: 408,\n            reason_phrase: 'Session Timer Expired'\n          });\n        }, expires * 1100);\n      }\n    }\n  }, {\n    key: \"_toggleMuteAudio\",\n    value: function _toggleMuteAudio(mute) {\n      var senders = this._connection.getSenders().filter(function (sender) {\n        return sender.track && sender.track.kind === 'audio';\n      });\n      var _iterator8 = _createForOfIteratorHelper(senders),\n        _step8;\n      try {\n        for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {\n          var sender = _step8.value;\n          sender.track.enabled = !mute;\n        }\n      } catch (err) {\n        _iterator8.e(err);\n      } finally {\n        _iterator8.f();\n      }\n    }\n  }, {\n    key: \"_toggleMuteVideo\",\n    value: function _toggleMuteVideo(mute) {\n      var senders = this._connection.getSenders().filter(function (sender) {\n        return sender.track && sender.track.kind === 'video';\n      });\n      var _iterator9 = _createForOfIteratorHelper(senders),\n        _step9;\n      try {\n        for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {\n          var sender = _step9.value;\n          sender.track.enabled = !mute;\n        }\n      } catch (err) {\n        _iterator9.e(err);\n      } finally {\n        _iterator9.f();\n      }\n    }\n  }, {\n    key: \"_newRTCSession\",\n    value: function _newRTCSession(originator, request) {\n      logger.debug('newRTCSession()');\n      this._ua.newRTCSession(this, {\n        originator: originator,\n        session: this,\n        request: request\n      });\n    }\n  }, {\n    key: \"_connecting\",\n    value: function _connecting(request) {\n      logger.debug('session connecting');\n      logger.debug('emit \"connecting\"');\n      this.emit('connecting', {\n        request: request\n      });\n    }\n  }, {\n    key: \"_progress\",\n    value: function _progress(originator, response) {\n      logger.debug('session progress');\n      logger.debug('emit \"progress\"');\n      this.emit('progress', {\n        originator: originator,\n        response: response || null\n      });\n    }\n  }, {\n    key: \"_accepted\",\n    value: function _accepted(originator, message) {\n      logger.debug('session accepted');\n      this._start_time = new Date();\n      logger.debug('emit \"accepted\"');\n      this.emit('accepted', {\n        originator: originator,\n        response: message || null\n      });\n    }\n  }, {\n    key: \"_confirmed\",\n    value: function _confirmed(originator, ack) {\n      logger.debug('session confirmed');\n      this._is_confirmed = true;\n      logger.debug('emit \"confirmed\"');\n      this.emit('confirmed', {\n        originator: originator,\n        ack: ack || null\n      });\n    }\n  }, {\n    key: \"_ended\",\n    value: function _ended(originator, message, cause) {\n      logger.debug('session ended');\n      this._end_time = new Date();\n      this._close();\n      logger.debug('emit \"ended\"');\n      this.emit('ended', {\n        originator: originator,\n        message: message || null,\n        cause: cause\n      });\n    }\n  }, {\n    key: \"_failed\",\n    value: function _failed(originator, message, cause) {\n      logger.debug('session failed'); // Emit private '_failed' event first.\n\n      logger.debug('emit \"_failed\"');\n      this.emit('_failed', {\n        originator: originator,\n        message: message || null,\n        cause: cause\n      });\n      this._close();\n      logger.debug('emit \"failed\"');\n      this.emit('failed', {\n        originator: originator,\n        message: message || null,\n        cause: cause\n      });\n    }\n  }, {\n    key: \"_onhold\",\n    value: function _onhold(originator) {\n      logger.debug('session onhold');\n      this._setLocalMediaStatus();\n      logger.debug('emit \"hold\"');\n      this.emit('hold', {\n        originator: originator\n      });\n    }\n  }, {\n    key: \"_onunhold\",\n    value: function _onunhold(originator) {\n      logger.debug('session onunhold');\n      this._setLocalMediaStatus();\n      logger.debug('emit \"unhold\"');\n      this.emit('unhold', {\n        originator: originator\n      });\n    }\n  }, {\n    key: \"_onmute\",\n    value: function _onmute(_ref5) {\n      var audio = _ref5.audio,\n        video = _ref5.video;\n      logger.debug('session onmute');\n      this._setLocalMediaStatus();\n      logger.debug('emit \"muted\"');\n      this.emit('muted', {\n        audio: audio,\n        video: video\n      });\n    }\n  }, {\n    key: \"_onunmute\",\n    value: function _onunmute(_ref6) {\n      var audio = _ref6.audio,\n        video = _ref6.video;\n      logger.debug('session onunmute');\n      this._setLocalMediaStatus();\n      logger.debug('emit \"unmuted\"');\n      this.emit('unmuted', {\n        audio: audio,\n        video: video\n      });\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    } // Expose session failed/ended causes as a property of the RTCSession instance.\n  }, {\n    key: \"causes\",\n    get: function get() {\n      return JsSIP_C.causes;\n    }\n  }, {\n    key: \"id\",\n    get: function get() {\n      return this._id;\n    }\n  }, {\n    key: \"connection\",\n    get: function get() {\n      return this._connection;\n    }\n  }, {\n    key: \"contact\",\n    get: function get() {\n      return this._contact;\n    }\n  }, {\n    key: \"direction\",\n    get: function get() {\n      return this._direction;\n    }\n  }, {\n    key: \"local_identity\",\n    get: function get() {\n      return this._local_identity;\n    }\n  }, {\n    key: \"remote_identity\",\n    get: function get() {\n      return this._remote_identity;\n    }\n  }, {\n    key: \"start_time\",\n    get: function get() {\n      return this._start_time;\n    }\n  }, {\n    key: \"end_time\",\n    get: function get() {\n      return this._end_time;\n    }\n  }, {\n    key: \"data\",\n    get: function get() {\n      return this._data;\n    },\n    set: function set(_data) {\n      this._data = _data;\n    }\n  }, {\n    key: \"status\",\n    get: function get() {\n      return this._status;\n    }\n  }]);\n  return RTCSession;\n}(EventEmitter);","map":{"version":3,"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_createForOfIteratorHelper","o","allowArrayLike","it","Array","isArray","_unsupportedIterableToArray","length","i","F","s","n","done","value","e","_e2","f","TypeError","normalCompletion","didErr","err","step","next","_e3","minLen","_arrayLikeToArray","Object","toString","call","slice","name","from","test","arr","len","arr2","_classCallCheck","instance","Constructor","_defineProperties","target","props","descriptor","enumerable","configurable","writable","defineProperty","key","_createClass","protoProps","staticProps","_inherits","subClass","superClass","create","_setPrototypeOf","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","result","NewTarget","Reflect","construct","arguments","apply","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Date","getPrototypeOf","EventEmitter","require","sdp_transform","Logger","JsSIP_C","Exceptions","Transactions","Utils","Timers","SIPMessage","Dialog","RequestSender","RTCSession_DTMF","RTCSession_Info","RTCSession_ReferNotifier","RTCSession_ReferSubscriber","URI","logger","C","STATUS_NULL","STATUS_INVITE_SENT","STATUS_1XX_RECEIVED","STATUS_INVITE_RECEIVED","STATUS_WAITING_FOR_ANSWER","STATUS_ANSWERED","STATUS_WAITING_FOR_ACK","STATUS_CANCELED","STATUS_TERMINATED","STATUS_CONFIRMED","holdMediaTypes","module","exports","_EventEmitter","RTCSession","_super","get","ua","_this","debug","_id","_ua","_status","_dialog","_earlyDialogs","_contact","_from_tag","_to_tag","_connection","_connectionPromiseQueue","Promise","resolve","_request","_is_canceled","_cancel_reason","_is_confirmed","_late_sdp","_rtcOfferConstraints","_rtcAnswerConstraints","_localMediaStream","_localMediaStreamLocallyGenerated","_rtcReady","_iceReady","_timers","ackTimer","expiresTimer","invite2xxTimer","userNoAnswerTimer","_direction","_local_identity","_remote_identity","_start_time","_end_time","_tones","_audioMuted","_videoMuted","_localHold","_remoteHold","_sessionTimers","enabled","configuration","session_timers","refreshMethod","session_timers_refresh_method","defaultExpires","SESSION_EXPIRES","currentExpires","running","refresher","timer","_referSubscribers","_data","isInProgress","isEstablished","isEnded","isMuted","audio","video","isOnHold","local","remote","connect","options","undefined","initCallback","originalTarget","eventHandlers","cloneObject","extraHeaders","cloneArray","mediaConstraints","mediaStream","pcConfig","iceServers","rtcConstraints","rtcOfferConstraints","rtcAnswerConstraints","data","InvalidStateError","window","RTCPeerConnection","NotSupportedError","normalizeTarget","concat","isDecimal","sessionTimersExpires","MIN_SESSION_EXPIRES","event","hasOwnProperty","on","newTag","anonymous","requestParams","from_tag","contact","outbound","from_display_name","from_uri","push","uri","fromUserName","host","fromDisplayName","session_timers_force_refresher","InitialOutgoingInviteRequest","call_id","_createRTCConnection","to","_newRTCSession","_sendInitialRequest","init_incoming","request","_this2","expires","contentType","hasHeader","getHeader","toLowerCase","body","reply","to_tag","_createDialog","setTimeout","_failed","causes","NO_ANSWER","no_answer_timeout","EXPIRES","_progress","answer","_this3","tracks","peerHasAudioLine","peerHasVideoLine","peerOffersFullAudio","peerOffersFullVideo","clearTimeout","unshift","sdp","parseSDP","media","_iterator","_step","m","type","direction","getAudioTracks","_iterator2","_step2","track","removeTrack","getVideoTracks","_iterator3","_step3","_track","offerToReceiveAudio","offerToReceiveVideo","then","navigator","mediaDevices","getUserMedia","error","Error","USER_DENIED_MEDIA_ACCESS","warn","emit","stream","getTracks","forEach","addTrack","originator","offer","RTCSessionDescription","setRemoteDescription","WEBRTC_ERROR","_connecting","_createLocalDescription","desc","_handleSessionTimersInIncomingRequest","_setInvite2xxTimer","_setACKTimer","_accepted","CONNECTION_ERROR","terminate","_this4","cause","BYE","cancel_reason","status_code","reason_phrase","REASON_PHRASE","cancel","CANCELED","REJECTED","server_transaction","state","dialog","receiveRequest","_ref","method","ACK","sendRequest","_ended","newDialog","sendDTMF","tones","position","duration","interToneGap","transportType","DTMF_TRANSPORT","INFO","RFC2833","match","DEFAULT_DURATION","MIN_DURATION","MAX_DURATION","Math","abs","DEFAULT_INTER_TONE_GAP","MIN_INTER_TONE_GAP","sender","_getDTMFRTPSender","toneBuffer","insertDTMF","_sendDTMF","_this5","timeout","tone","dtmf","onFailed","send","bind","sendInfo","info","mute","audioMuted","videoMuted","_toggleMuteAudio","_toggleMuteVideo","_onmute","unmute","audioUnMuted","videoUnMuted","_onunmute","hold","_this6","_isReadyToReOffer","_onhold","succeeded","failed","useUpdate","_sendUpdate","sdpOffer","_sendReinvite","unhold","_this7","_onunhold","renegotiate","_this8","_setLocalMediaStatus","refer","_this9","referSubscriber","sendRefer","id","_this10","CANCEL","MISSING_SDP","_confirmed","BAD_MEDIA_DESCRIPTION","INVITE","_receiveReplaces","_receiveReinvite","UPDATE","_receiveUpdate","REFER","_receiveRefer","NOTIFY","_receiveNotify","onTransportError","onRequestTimeout","REQUEST_TIMEOUT","onDialogError","DIALOG_ERROR","newDTMF","newInfo","uac_pending_reply","uas_pending_reply","_close","closeMediaStream","close","subscriber","destroyRTCSession","T1","invite2xxRetransmission","T2","_this11","NO_ACK","TIMER_H","_this12","addEventListener","iceConnectionState","RTP_TIMEOUT","peerconnection","constraints","_this13","connection","createOffer","reject","createAnswer","setLocalDescription","iceRestart","iceGatheringState","localDescription","finished","iceCandidateListener","iceGatheringStateListener","ready","removeEventListener","candidate","message","early","local_tag","remote_tag","early_dialog","STATUS_EARLY","INTERNAL_ERROR","update","_this14","callback","rejected","sendAnswer","_processInDialogSdpOffer","_this15","_mangleOffer","_this16","_this17","_iterator4","_step4","indexOf","_this18","refer_to","scheme","SIP","notifier","cseq","accept","_accept","_reject","session","_ref2","response","notify","_ref3","_ref4","replaces","decodeURIComponent","toAor","params","keys","receiveNotify","_this20","_accept2","_this19","_reject2","_this21","request_sender","onAuthenticated","onReceiveResponse","_receiveInviteResponse","getSenders","find","rtpSender","kind","_this22","_acceptAndTerminate","_e","_answer","signalingState","_handleSessionTimersInIncomingResponse","sipErrorCause","_this23","onSuccessResponse","onSucceeded","onErrorResponse","_this24","_this25","_this26","parse","_iterator5","_step5","_iterator6","_step6","_m","_iterator7","_step7","_m2","write","enableAudio","enableVideo","responseExtraHeaders","session_expires_refresher","session_expires","_runSessionTimer","_this27","senders","filter","_iterator8","_step8","_iterator9","_step9","newRTCSession","ack","_ref5","_ref6","set"],"sources":["/app/node_modules/jssip/lib-es5/RTCSession.js"],"sourcesContent":["\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n/* globals RTCPeerConnection: false, RTCSessionDescription: false */\nvar EventEmitter = require('events').EventEmitter;\n\nvar sdp_transform = require('sdp-transform');\n\nvar Logger = require('./Logger');\n\nvar JsSIP_C = require('./Constants');\n\nvar Exceptions = require('./Exceptions');\n\nvar Transactions = require('./Transactions');\n\nvar Utils = require('./Utils');\n\nvar Timers = require('./Timers');\n\nvar SIPMessage = require('./SIPMessage');\n\nvar Dialog = require('./Dialog');\n\nvar RequestSender = require('./RequestSender');\n\nvar RTCSession_DTMF = require('./RTCSession/DTMF');\n\nvar RTCSession_Info = require('./RTCSession/Info');\n\nvar RTCSession_ReferNotifier = require('./RTCSession/ReferNotifier');\n\nvar RTCSession_ReferSubscriber = require('./RTCSession/ReferSubscriber');\n\nvar URI = require('./URI');\n\nvar logger = new Logger('RTCSession');\nvar C = {\n  // RTCSession states.\n  STATUS_NULL: 0,\n  STATUS_INVITE_SENT: 1,\n  STATUS_1XX_RECEIVED: 2,\n  STATUS_INVITE_RECEIVED: 3,\n  STATUS_WAITING_FOR_ANSWER: 4,\n  STATUS_ANSWERED: 5,\n  STATUS_WAITING_FOR_ACK: 6,\n  STATUS_CANCELED: 7,\n  STATUS_TERMINATED: 8,\n  STATUS_CONFIRMED: 9\n};\n/**\n * Local variables.\n */\n\nvar holdMediaTypes = ['audio', 'video'];\n\nmodule.exports = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(RTCSession, _EventEmitter);\n\n  var _super = _createSuper(RTCSession);\n\n  _createClass(RTCSession, null, [{\n    key: \"C\",\n\n    /**\n     * Expose C object.\n     */\n    get: function get() {\n      return C;\n    }\n  }]);\n\n  function RTCSession(ua) {\n    var _this;\n\n    _classCallCheck(this, RTCSession);\n\n    logger.debug('new');\n    _this = _super.call(this);\n    _this._id = null;\n    _this._ua = ua;\n    _this._status = C.STATUS_NULL;\n    _this._dialog = null;\n    _this._earlyDialogs = {};\n    _this._contact = null;\n    _this._from_tag = null;\n    _this._to_tag = null; // The RTCPeerConnection instance (public attribute).\n\n    _this._connection = null; // Prevent races on serial PeerConnction operations.\n\n    _this._connectionPromiseQueue = Promise.resolve(); // Incoming/Outgoing request being currently processed.\n\n    _this._request = null; // Cancel state for initial outgoing request.\n\n    _this._is_canceled = false;\n    _this._cancel_reason = ''; // RTCSession confirmation flag.\n\n    _this._is_confirmed = false; // Is late SDP being negotiated.\n\n    _this._late_sdp = false; // Default rtcOfferConstraints and rtcAnswerConstrainsts (passed in connect() or answer()).\n\n    _this._rtcOfferConstraints = null;\n    _this._rtcAnswerConstraints = null; // Local MediaStream.\n\n    _this._localMediaStream = null;\n    _this._localMediaStreamLocallyGenerated = false; // Flag to indicate PeerConnection ready for new actions.\n\n    _this._rtcReady = true; // Flag to indicate ICE candidate gathering is finished even if iceGatheringState is not yet 'complete'.\n\n    _this._iceReady = false; // SIP Timers.\n\n    _this._timers = {\n      ackTimer: null,\n      expiresTimer: null,\n      invite2xxTimer: null,\n      userNoAnswerTimer: null\n    }; // Session info.\n\n    _this._direction = null;\n    _this._local_identity = null;\n    _this._remote_identity = null;\n    _this._start_time = null;\n    _this._end_time = null;\n    _this._tones = null; // Mute/Hold state.\n\n    _this._audioMuted = false;\n    _this._videoMuted = false;\n    _this._localHold = false;\n    _this._remoteHold = false; // Session Timers (RFC 4028).\n\n    _this._sessionTimers = {\n      enabled: _this._ua.configuration.session_timers,\n      refreshMethod: _this._ua.configuration.session_timers_refresh_method,\n      defaultExpires: JsSIP_C.SESSION_EXPIRES,\n      currentExpires: null,\n      running: false,\n      refresher: false,\n      timer: null // A setTimeout.\n\n    }; // Map of ReferSubscriber instances indexed by the REFER's CSeq number.\n\n    _this._referSubscribers = {}; // Custom session empty object for high level use.\n\n    _this._data = {};\n    return _this;\n  }\n  /**\n   * User API\n   */\n  // Expose RTCSession constants as a property of the RTCSession instance.\n\n\n  _createClass(RTCSession, [{\n    key: \"isInProgress\",\n    value: function isInProgress() {\n      switch (this._status) {\n        case C.STATUS_NULL:\n        case C.STATUS_INVITE_SENT:\n        case C.STATUS_1XX_RECEIVED:\n        case C.STATUS_INVITE_RECEIVED:\n        case C.STATUS_WAITING_FOR_ANSWER:\n          return true;\n\n        default:\n          return false;\n      }\n    }\n  }, {\n    key: \"isEstablished\",\n    value: function isEstablished() {\n      switch (this._status) {\n        case C.STATUS_ANSWERED:\n        case C.STATUS_WAITING_FOR_ACK:\n        case C.STATUS_CONFIRMED:\n          return true;\n\n        default:\n          return false;\n      }\n    }\n  }, {\n    key: \"isEnded\",\n    value: function isEnded() {\n      switch (this._status) {\n        case C.STATUS_CANCELED:\n        case C.STATUS_TERMINATED:\n          return true;\n\n        default:\n          return false;\n      }\n    }\n  }, {\n    key: \"isMuted\",\n    value: function isMuted() {\n      return {\n        audio: this._audioMuted,\n        video: this._videoMuted\n      };\n    }\n  }, {\n    key: \"isOnHold\",\n    value: function isOnHold() {\n      return {\n        local: this._localHold,\n        remote: this._remoteHold\n      };\n    }\n  }, {\n    key: \"connect\",\n    value: function connect(target) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var initCallback = arguments.length > 2 ? arguments[2] : undefined;\n      logger.debug('connect()');\n      var originalTarget = target;\n      var eventHandlers = Utils.cloneObject(options.eventHandlers);\n      var extraHeaders = Utils.cloneArray(options.extraHeaders);\n      var mediaConstraints = Utils.cloneObject(options.mediaConstraints, {\n        audio: true,\n        video: true\n      });\n      var mediaStream = options.mediaStream || null;\n      var pcConfig = Utils.cloneObject(options.pcConfig, {\n        iceServers: []\n      });\n      var rtcConstraints = options.rtcConstraints || null;\n      var rtcOfferConstraints = options.rtcOfferConstraints || null;\n      this._rtcOfferConstraints = rtcOfferConstraints;\n      this._rtcAnswerConstraints = options.rtcAnswerConstraints || null;\n      this._data = options.data || this._data; // Check target.\n\n      if (target === undefined) {\n        throw new TypeError('Not enough arguments');\n      } // Check Session Status.\n\n\n      if (this._status !== C.STATUS_NULL) {\n        throw new Exceptions.InvalidStateError(this._status);\n      } // Check WebRTC support.\n\n\n      if (!window.RTCPeerConnection) {\n        throw new Exceptions.NotSupportedError('WebRTC not supported');\n      } // Check target validity.\n\n\n      target = this._ua.normalizeTarget(target);\n\n      if (!target) {\n        throw new TypeError(\"Invalid target: \".concat(originalTarget));\n      } // Session Timers.\n\n\n      if (this._sessionTimers.enabled) {\n        if (Utils.isDecimal(options.sessionTimersExpires)) {\n          if (options.sessionTimersExpires >= JsSIP_C.MIN_SESSION_EXPIRES) {\n            this._sessionTimers.defaultExpires = options.sessionTimersExpires;\n          } else {\n            this._sessionTimers.defaultExpires = JsSIP_C.SESSION_EXPIRES;\n          }\n        }\n      } // Set event handlers.\n\n\n      for (var event in eventHandlers) {\n        if (Object.prototype.hasOwnProperty.call(eventHandlers, event)) {\n          this.on(event, eventHandlers[event]);\n        }\n      } // Session parameter initialization.\n\n\n      this._from_tag = Utils.newTag(); // Set anonymous property.\n\n      var anonymous = options.anonymous || false;\n      var requestParams = {\n        from_tag: this._from_tag\n      };\n      this._contact = this._ua.contact.toString({\n        anonymous: anonymous,\n        outbound: true\n      });\n\n      if (anonymous) {\n        requestParams.from_display_name = 'Anonymous';\n        requestParams.from_uri = new URI('sip', 'anonymous', 'anonymous.invalid');\n        extraHeaders.push(\"P-Preferred-Identity: \".concat(this._ua.configuration.uri.toString()));\n        extraHeaders.push('Privacy: id');\n      } else if (options.fromUserName) {\n        requestParams.from_uri = new URI('sip', options.fromUserName, this._ua.configuration.uri.host);\n        extraHeaders.push(\"P-Preferred-Identity: \".concat(this._ua.configuration.uri.toString()));\n      }\n\n      if (options.fromDisplayName) {\n        requestParams.from_display_name = options.fromDisplayName;\n      }\n\n      extraHeaders.push(\"Contact: \".concat(this._contact));\n      extraHeaders.push('Content-Type: application/sdp');\n\n      if (this._sessionTimers.enabled) {\n        extraHeaders.push(\"Session-Expires: \".concat(this._sessionTimers.defaultExpires).concat(this._ua.configuration.session_timers_force_refresher ? ';refresher=uac' : ''));\n      }\n\n      this._request = new SIPMessage.InitialOutgoingInviteRequest(target, this._ua, requestParams, extraHeaders);\n      this._id = this._request.call_id + this._from_tag; // Create a new RTCPeerConnection instance.\n\n      this._createRTCConnection(pcConfig, rtcConstraints); // Set internal properties.\n\n\n      this._direction = 'outgoing';\n      this._local_identity = this._request.from;\n      this._remote_identity = this._request.to; // User explicitly provided a newRTCSession callback for this session.\n\n      if (initCallback) {\n        initCallback(this);\n      }\n\n      this._newRTCSession('local', this._request);\n\n      this._sendInitialRequest(mediaConstraints, rtcOfferConstraints, mediaStream);\n    }\n  }, {\n    key: \"init_incoming\",\n    value: function init_incoming(request, initCallback) {\n      var _this2 = this;\n\n      logger.debug('init_incoming()');\n      var expires;\n      var contentType = request.hasHeader('Content-Type') ? request.getHeader('Content-Type').toLowerCase() : undefined; // Check body and content type.\n\n      if (request.body && contentType !== 'application/sdp') {\n        request.reply(415);\n        return;\n      } // Session parameter initialization.\n\n\n      this._status = C.STATUS_INVITE_RECEIVED;\n      this._from_tag = request.from_tag;\n      this._id = request.call_id + this._from_tag;\n      this._request = request;\n      this._contact = this._ua.contact.toString(); // Get the Expires header value if exists.\n\n      if (request.hasHeader('expires')) {\n        expires = request.getHeader('expires') * 1000;\n      }\n      /* Set the to_tag before\n       * replying a response code that will create a dialog.\n       */\n\n\n      request.to_tag = Utils.newTag(); // An error on dialog creation will fire 'failed' event.\n\n      if (!this._createDialog(request, 'UAS', true)) {\n        request.reply(500, 'Missing Contact header field');\n        return;\n      }\n\n      if (request.body) {\n        this._late_sdp = false;\n      } else {\n        this._late_sdp = true;\n      }\n\n      this._status = C.STATUS_WAITING_FOR_ANSWER; // Set userNoAnswerTimer.\n\n      this._timers.userNoAnswerTimer = setTimeout(function () {\n        request.reply(408);\n\n        _this2._failed('local', null, JsSIP_C.causes.NO_ANSWER);\n      }, this._ua.configuration.no_answer_timeout);\n      /* Set expiresTimer\n       * RFC3261 13.3.1\n       */\n\n      if (expires) {\n        this._timers.expiresTimer = setTimeout(function () {\n          if (_this2._status === C.STATUS_WAITING_FOR_ANSWER) {\n            request.reply(487);\n\n            _this2._failed('system', null, JsSIP_C.causes.EXPIRES);\n          }\n        }, expires);\n      } // Set internal properties.\n\n\n      this._direction = 'incoming';\n      this._local_identity = request.to;\n      this._remote_identity = request.from; // A init callback was specifically defined.\n\n      if (initCallback) {\n        initCallback(this);\n      } // Fire 'newRTCSession' event.\n\n\n      this._newRTCSession('remote', request); // The user may have rejected the call in the 'newRTCSession' event.\n\n\n      if (this._status === C.STATUS_TERMINATED) {\n        return;\n      } // Reply 180.\n\n\n      request.reply(180, null, [\"Contact: \".concat(this._contact)]); // Fire 'progress' event.\n      // TODO: Document that 'response' field in 'progress' event is null for incoming calls.\n\n      this._progress('local', null);\n    }\n    /**\n     * Answer the call.\n     */\n\n  }, {\n    key: \"answer\",\n    value: function answer() {\n      var _this3 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      logger.debug('answer()');\n      var request = this._request;\n      var extraHeaders = Utils.cloneArray(options.extraHeaders);\n      var mediaConstraints = Utils.cloneObject(options.mediaConstraints);\n      var mediaStream = options.mediaStream || null;\n      var pcConfig = Utils.cloneObject(options.pcConfig, {\n        iceServers: []\n      });\n      var rtcConstraints = options.rtcConstraints || null;\n      var rtcAnswerConstraints = options.rtcAnswerConstraints || null;\n      var rtcOfferConstraints = Utils.cloneObject(options.rtcOfferConstraints);\n      var tracks;\n      var peerHasAudioLine = false;\n      var peerHasVideoLine = false;\n      var peerOffersFullAudio = false;\n      var peerOffersFullVideo = false;\n      this._rtcAnswerConstraints = rtcAnswerConstraints;\n      this._rtcOfferConstraints = options.rtcOfferConstraints || null;\n      this._data = options.data || this._data; // Check Session Direction and Status.\n\n      if (this._direction !== 'incoming') {\n        throw new Exceptions.NotSupportedError('\"answer\" not supported for outgoing RTCSession');\n      } // Check Session status.\n\n\n      if (this._status !== C.STATUS_WAITING_FOR_ANSWER) {\n        throw new Exceptions.InvalidStateError(this._status);\n      } // Session Timers.\n\n\n      if (this._sessionTimers.enabled) {\n        if (Utils.isDecimal(options.sessionTimersExpires)) {\n          if (options.sessionTimersExpires >= JsSIP_C.MIN_SESSION_EXPIRES) {\n            this._sessionTimers.defaultExpires = options.sessionTimersExpires;\n          } else {\n            this._sessionTimers.defaultExpires = JsSIP_C.SESSION_EXPIRES;\n          }\n        }\n      }\n\n      this._status = C.STATUS_ANSWERED; // An error on dialog creation will fire 'failed' event.\n\n      if (!this._createDialog(request, 'UAS')) {\n        request.reply(500, 'Error creating dialog');\n        return;\n      }\n\n      clearTimeout(this._timers.userNoAnswerTimer);\n      extraHeaders.unshift(\"Contact: \".concat(this._contact)); // Determine incoming media from incoming SDP offer (if any).\n\n      var sdp = request.parseSDP(); // Make sure sdp.media is an array, not the case if there is only one media.\n\n      if (!Array.isArray(sdp.media)) {\n        sdp.media = [sdp.media];\n      } // Go through all medias in SDP to find offered capabilities to answer with.\n\n\n      var _iterator = _createForOfIteratorHelper(sdp.media),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var m = _step.value;\n\n          if (m.type === 'audio') {\n            peerHasAudioLine = true;\n\n            if (!m.direction || m.direction === 'sendrecv') {\n              peerOffersFullAudio = true;\n            }\n          }\n\n          if (m.type === 'video') {\n            peerHasVideoLine = true;\n\n            if (!m.direction || m.direction === 'sendrecv') {\n              peerOffersFullVideo = true;\n            }\n          }\n        } // Remove audio from mediaStream if suggested by mediaConstraints.\n\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      if (mediaStream && mediaConstraints.audio === false) {\n        tracks = mediaStream.getAudioTracks();\n\n        var _iterator2 = _createForOfIteratorHelper(tracks),\n            _step2;\n\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var track = _step2.value;\n            mediaStream.removeTrack(track);\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      } // Remove video from mediaStream if suggested by mediaConstraints.\n\n\n      if (mediaStream && mediaConstraints.video === false) {\n        tracks = mediaStream.getVideoTracks();\n\n        var _iterator3 = _createForOfIteratorHelper(tracks),\n            _step3;\n\n        try {\n          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n            var _track = _step3.value;\n            mediaStream.removeTrack(_track);\n          }\n        } catch (err) {\n          _iterator3.e(err);\n        } finally {\n          _iterator3.f();\n        }\n      } // Set audio constraints based on incoming stream if not supplied.\n\n\n      if (!mediaStream && mediaConstraints.audio === undefined) {\n        mediaConstraints.audio = peerOffersFullAudio;\n      } // Set video constraints based on incoming stream if not supplied.\n\n\n      if (!mediaStream && mediaConstraints.video === undefined) {\n        mediaConstraints.video = peerOffersFullVideo;\n      } // Don't ask for audio if the incoming offer has no audio section.\n\n\n      if (!mediaStream && !peerHasAudioLine && !rtcOfferConstraints.offerToReceiveAudio) {\n        mediaConstraints.audio = false;\n      } // Don't ask for video if the incoming offer has no video section.\n\n\n      if (!mediaStream && !peerHasVideoLine && !rtcOfferConstraints.offerToReceiveVideo) {\n        mediaConstraints.video = false;\n      } // Create a new RTCPeerConnection instance.\n      // TODO: This may throw an error, should react.\n\n\n      this._createRTCConnection(pcConfig, rtcConstraints);\n\n      Promise.resolve() // Handle local MediaStream.\n      .then(function () {\n        // A local MediaStream is given, use it.\n        if (mediaStream) {\n          return mediaStream;\n        } // Audio and/or video requested, prompt getUserMedia.\n        else if (mediaConstraints.audio || mediaConstraints.video) {\n            _this3._localMediaStreamLocallyGenerated = true;\n            return navigator.mediaDevices.getUserMedia(mediaConstraints)[\"catch\"](function (error) {\n              if (_this3._status === C.STATUS_TERMINATED) {\n                throw new Error('terminated');\n              }\n\n              request.reply(480);\n\n              _this3._failed('local', null, JsSIP_C.causes.USER_DENIED_MEDIA_ACCESS);\n\n              logger.warn('emit \"getusermediafailed\" [error:%o]', error);\n\n              _this3.emit('getusermediafailed', error);\n\n              throw new Error('getUserMedia() failed');\n            });\n          }\n      }) // Attach MediaStream to RTCPeerconnection.\n      .then(function (stream) {\n        if (_this3._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        }\n\n        _this3._localMediaStream = stream;\n\n        if (stream) {\n          stream.getTracks().forEach(function (track) {\n            _this3._connection.addTrack(track, stream);\n          });\n        }\n      }) // Set remote description.\n      .then(function () {\n        if (_this3._late_sdp) {\n          return;\n        }\n\n        var e = {\n          originator: 'remote',\n          type: 'offer',\n          sdp: request.body\n        };\n        logger.debug('emit \"sdp\"');\n\n        _this3.emit('sdp', e);\n\n        var offer = new RTCSessionDescription({\n          type: 'offer',\n          sdp: e.sdp\n        });\n        _this3._connectionPromiseQueue = _this3._connectionPromiseQueue.then(function () {\n          return _this3._connection.setRemoteDescription(offer);\n        })[\"catch\"](function (error) {\n          request.reply(488);\n\n          _this3._failed('system', null, JsSIP_C.causes.WEBRTC_ERROR);\n\n          logger.warn('emit \"peerconnection:setremotedescriptionfailed\" [error:%o]', error);\n\n          _this3.emit('peerconnection:setremotedescriptionfailed', error);\n\n          throw new Error('peerconnection.setRemoteDescription() failed');\n        });\n        return _this3._connectionPromiseQueue;\n      }) // Create local description.\n      .then(function () {\n        if (_this3._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        } // TODO: Is this event already useful?\n\n\n        _this3._connecting(request);\n\n        if (!_this3._late_sdp) {\n          return _this3._createLocalDescription('answer', rtcAnswerConstraints)[\"catch\"](function () {\n            request.reply(500);\n            throw new Error('_createLocalDescription() failed');\n          });\n        } else {\n          return _this3._createLocalDescription('offer', _this3._rtcOfferConstraints)[\"catch\"](function () {\n            request.reply(500);\n            throw new Error('_createLocalDescription() failed');\n          });\n        }\n      }) // Send reply.\n      .then(function (desc) {\n        if (_this3._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        }\n\n        _this3._handleSessionTimersInIncomingRequest(request, extraHeaders);\n\n        request.reply(200, null, extraHeaders, desc, function () {\n          _this3._status = C.STATUS_WAITING_FOR_ACK;\n\n          _this3._setInvite2xxTimer(request, desc);\n\n          _this3._setACKTimer();\n\n          _this3._accepted('local');\n        }, function () {\n          _this3._failed('system', null, JsSIP_C.causes.CONNECTION_ERROR);\n        });\n      })[\"catch\"](function (error) {\n        if (_this3._status === C.STATUS_TERMINATED) {\n          return;\n        }\n\n        logger.warn(error);\n      });\n    }\n    /**\n     * Terminate the call.\n     */\n\n  }, {\n    key: \"terminate\",\n    value: function terminate() {\n      var _this4 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      logger.debug('terminate()');\n      var cause = options.cause || JsSIP_C.causes.BYE;\n      var extraHeaders = Utils.cloneArray(options.extraHeaders);\n      var body = options.body;\n      var cancel_reason;\n      var status_code = options.status_code;\n      var reason_phrase = options.reason_phrase; // Check Session Status.\n\n      if (this._status === C.STATUS_TERMINATED) {\n        throw new Exceptions.InvalidStateError(this._status);\n      }\n\n      switch (this._status) {\n        // - UAC -\n        case C.STATUS_NULL:\n        case C.STATUS_INVITE_SENT:\n        case C.STATUS_1XX_RECEIVED:\n          logger.debug('canceling session');\n\n          if (status_code && (status_code < 200 || status_code >= 700)) {\n            throw new TypeError(\"Invalid status_code: \".concat(status_code));\n          } else if (status_code) {\n            reason_phrase = reason_phrase || JsSIP_C.REASON_PHRASE[status_code] || '';\n            cancel_reason = \"SIP ;cause=\".concat(status_code, \" ;text=\\\"\").concat(reason_phrase, \"\\\"\");\n          } // Check Session Status.\n\n\n          if (this._status === C.STATUS_NULL || this._status === C.STATUS_INVITE_SENT) {\n            this._is_canceled = true;\n            this._cancel_reason = cancel_reason;\n          } else if (this._status === C.STATUS_1XX_RECEIVED) {\n            this._request.cancel(cancel_reason);\n          }\n\n          this._status = C.STATUS_CANCELED;\n\n          this._failed('local', null, JsSIP_C.causes.CANCELED);\n\n          break;\n        // - UAS -\n\n        case C.STATUS_WAITING_FOR_ANSWER:\n        case C.STATUS_ANSWERED:\n          logger.debug('rejecting session');\n          status_code = status_code || 480;\n\n          if (status_code < 300 || status_code >= 700) {\n            throw new TypeError(\"Invalid status_code: \".concat(status_code));\n          }\n\n          this._request.reply(status_code, reason_phrase, extraHeaders, body);\n\n          this._failed('local', null, JsSIP_C.causes.REJECTED);\n\n          break;\n\n        case C.STATUS_WAITING_FOR_ACK:\n        case C.STATUS_CONFIRMED:\n          logger.debug('terminating session');\n          reason_phrase = options.reason_phrase || JsSIP_C.REASON_PHRASE[status_code] || '';\n\n          if (status_code && (status_code < 200 || status_code >= 700)) {\n            throw new TypeError(\"Invalid status_code: \".concat(status_code));\n          } else if (status_code) {\n            extraHeaders.push(\"Reason: SIP ;cause=\".concat(status_code, \"; text=\\\"\").concat(reason_phrase, \"\\\"\"));\n          }\n          /* RFC 3261 section 15 (Terminating a session):\n            *\n            * \"...the callee's UA MUST NOT send a BYE on a confirmed dialog\n            * until it has received an ACK for its 2xx response or until the server\n            * transaction times out.\"\n            */\n\n\n          if (this._status === C.STATUS_WAITING_FOR_ACK && this._direction === 'incoming' && this._request.server_transaction.state !== Transactions.C.STATUS_TERMINATED) {\n            // Save the dialog for later restoration.\n            var dialog = this._dialog; // Send the BYE as soon as the ACK is received...\n\n            this.receiveRequest = function (_ref) {\n              var method = _ref.method;\n\n              if (method === JsSIP_C.ACK) {\n                _this4.sendRequest(JsSIP_C.BYE, {\n                  extraHeaders: extraHeaders,\n                  body: body\n                });\n\n                dialog.terminate();\n              }\n            }; // .., or when the INVITE transaction times out\n\n\n            this._request.server_transaction.on('stateChanged', function () {\n              if (_this4._request.server_transaction.state === Transactions.C.STATUS_TERMINATED) {\n                _this4.sendRequest(JsSIP_C.BYE, {\n                  extraHeaders: extraHeaders,\n                  body: body\n                });\n\n                dialog.terminate();\n              }\n            });\n\n            this._ended('local', null, cause); // Restore the dialog into 'this' in order to be able to send the in-dialog BYE :-).\n\n\n            this._dialog = dialog; // Restore the dialog into 'ua' so the ACK can reach 'this' session.\n\n            this._ua.newDialog(dialog);\n          } else {\n            this.sendRequest(JsSIP_C.BYE, {\n              extraHeaders: extraHeaders,\n              body: body\n            });\n\n            this._ended('local', null, cause);\n          }\n\n      }\n    }\n  }, {\n    key: \"sendDTMF\",\n    value: function sendDTMF(tones) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      logger.debug('sendDTMF() | tones: %s', tones);\n      var position = 0;\n      var duration = options.duration || null;\n      var interToneGap = options.interToneGap || null;\n      var transportType = options.transportType || JsSIP_C.DTMF_TRANSPORT.INFO;\n\n      if (tones === undefined) {\n        throw new TypeError('Not enough arguments');\n      } // Check Session Status.\n\n\n      if (this._status !== C.STATUS_CONFIRMED && this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_1XX_RECEIVED) {\n        throw new Exceptions.InvalidStateError(this._status);\n      } // Check Transport type.\n\n\n      if (transportType !== JsSIP_C.DTMF_TRANSPORT.INFO && transportType !== JsSIP_C.DTMF_TRANSPORT.RFC2833) {\n        throw new TypeError(\"invalid transportType: \".concat(transportType));\n      } // Convert to string.\n\n\n      if (typeof tones === 'number') {\n        tones = tones.toString();\n      } // Check tones.\n\n\n      if (!tones || typeof tones !== 'string' || !tones.match(/^[0-9A-DR#*,]+$/i)) {\n        throw new TypeError(\"Invalid tones: \".concat(tones));\n      } // Check duration.\n\n\n      if (duration && !Utils.isDecimal(duration)) {\n        throw new TypeError(\"Invalid tone duration: \".concat(duration));\n      } else if (!duration) {\n        duration = RTCSession_DTMF.C.DEFAULT_DURATION;\n      } else if (duration < RTCSession_DTMF.C.MIN_DURATION) {\n        logger.debug(\"\\\"duration\\\" value is lower than the minimum allowed, setting it to \".concat(RTCSession_DTMF.C.MIN_DURATION, \" milliseconds\"));\n        duration = RTCSession_DTMF.C.MIN_DURATION;\n      } else if (duration > RTCSession_DTMF.C.MAX_DURATION) {\n        logger.debug(\"\\\"duration\\\" value is greater than the maximum allowed, setting it to \".concat(RTCSession_DTMF.C.MAX_DURATION, \" milliseconds\"));\n        duration = RTCSession_DTMF.C.MAX_DURATION;\n      } else {\n        duration = Math.abs(duration);\n      }\n\n      options.duration = duration; // Check interToneGap.\n\n      if (interToneGap && !Utils.isDecimal(interToneGap)) {\n        throw new TypeError(\"Invalid interToneGap: \".concat(interToneGap));\n      } else if (!interToneGap) {\n        interToneGap = RTCSession_DTMF.C.DEFAULT_INTER_TONE_GAP;\n      } else if (interToneGap < RTCSession_DTMF.C.MIN_INTER_TONE_GAP) {\n        logger.debug(\"\\\"interToneGap\\\" value is lower than the minimum allowed, setting it to \".concat(RTCSession_DTMF.C.MIN_INTER_TONE_GAP, \" milliseconds\"));\n        interToneGap = RTCSession_DTMF.C.MIN_INTER_TONE_GAP;\n      } else {\n        interToneGap = Math.abs(interToneGap);\n      } // RFC2833. Let RTCDTMFSender enqueue the DTMFs.\n\n\n      if (transportType === JsSIP_C.DTMF_TRANSPORT.RFC2833) {\n        // Send DTMF in current audio RTP stream.\n        var sender = this._getDTMFRTPSender();\n\n        if (sender) {\n          // Add remaining buffered tones.\n          tones = sender.toneBuffer + tones; // Insert tones.\n\n          sender.insertDTMF(tones, duration, interToneGap);\n        }\n\n        return;\n      }\n\n      if (this._tones) {\n        // Tones are already queued, just add to the queue.\n        this._tones += tones;\n        return;\n      }\n\n      this._tones = tones; // Send the first tone.\n\n      _sendDTMF.call(this);\n\n      function _sendDTMF() {\n        var _this5 = this;\n\n        var timeout;\n\n        if (this._status === C.STATUS_TERMINATED || !this._tones || position >= this._tones.length) {\n          // Stop sending DTMF.\n          this._tones = null;\n          return;\n        }\n\n        var tone = this._tones[position];\n        position += 1;\n\n        if (tone === ',') {\n          timeout = 2000;\n        } else {\n          // Send DTMF via SIP INFO messages.\n          var dtmf = new RTCSession_DTMF(this);\n          options.eventHandlers = {\n            onFailed: function onFailed() {\n              _this5._tones = null;\n            }\n          };\n          dtmf.send(tone, options);\n          timeout = duration + interToneGap;\n        } // Set timeout for the next tone.\n\n\n        setTimeout(_sendDTMF.bind(this), timeout);\n      }\n    }\n  }, {\n    key: \"sendInfo\",\n    value: function sendInfo(contentType, body) {\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      logger.debug('sendInfo()'); // Check Session Status.\n\n      if (this._status !== C.STATUS_CONFIRMED && this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_1XX_RECEIVED) {\n        throw new Exceptions.InvalidStateError(this._status);\n      }\n\n      var info = new RTCSession_Info(this);\n      info.send(contentType, body, options);\n    }\n    /**\n     * Mute\n     */\n\n  }, {\n    key: \"mute\",\n    value: function mute() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n        audio: true,\n        video: false\n      };\n      logger.debug('mute()');\n      var audioMuted = false,\n          videoMuted = false;\n\n      if (this._audioMuted === false && options.audio) {\n        audioMuted = true;\n        this._audioMuted = true;\n\n        this._toggleMuteAudio(true);\n      }\n\n      if (this._videoMuted === false && options.video) {\n        videoMuted = true;\n        this._videoMuted = true;\n\n        this._toggleMuteVideo(true);\n      }\n\n      if (audioMuted === true || videoMuted === true) {\n        this._onmute({\n          audio: audioMuted,\n          video: videoMuted\n        });\n      }\n    }\n    /**\n     * Unmute\n     */\n\n  }, {\n    key: \"unmute\",\n    value: function unmute() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n        audio: true,\n        video: true\n      };\n      logger.debug('unmute()');\n      var audioUnMuted = false,\n          videoUnMuted = false;\n\n      if (this._audioMuted === true && options.audio) {\n        audioUnMuted = true;\n        this._audioMuted = false;\n\n        if (this._localHold === false) {\n          this._toggleMuteAudio(false);\n        }\n      }\n\n      if (this._videoMuted === true && options.video) {\n        videoUnMuted = true;\n        this._videoMuted = false;\n\n        if (this._localHold === false) {\n          this._toggleMuteVideo(false);\n        }\n      }\n\n      if (audioUnMuted === true || videoUnMuted === true) {\n        this._onunmute({\n          audio: audioUnMuted,\n          video: videoUnMuted\n        });\n      }\n    }\n    /**\n     * Hold\n     */\n\n  }, {\n    key: \"hold\",\n    value: function hold() {\n      var _this6 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var done = arguments.length > 1 ? arguments[1] : undefined;\n      logger.debug('hold()');\n\n      if (this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_CONFIRMED) {\n        return false;\n      }\n\n      if (this._localHold === true) {\n        return false;\n      }\n\n      if (!this._isReadyToReOffer()) {\n        return false;\n      }\n\n      this._localHold = true;\n\n      this._onhold('local');\n\n      var eventHandlers = {\n        succeeded: function succeeded() {\n          if (done) {\n            done();\n          }\n        },\n        failed: function failed() {\n          _this6.terminate({\n            cause: JsSIP_C.causes.WEBRTC_ERROR,\n            status_code: 500,\n            reason_phrase: 'Hold Failed'\n          });\n        }\n      };\n\n      if (options.useUpdate) {\n        this._sendUpdate({\n          sdpOffer: true,\n          eventHandlers: eventHandlers,\n          extraHeaders: options.extraHeaders\n        });\n      } else {\n        this._sendReinvite({\n          eventHandlers: eventHandlers,\n          extraHeaders: options.extraHeaders\n        });\n      }\n\n      return true;\n    }\n  }, {\n    key: \"unhold\",\n    value: function unhold() {\n      var _this7 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var done = arguments.length > 1 ? arguments[1] : undefined;\n      logger.debug('unhold()');\n\n      if (this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_CONFIRMED) {\n        return false;\n      }\n\n      if (this._localHold === false) {\n        return false;\n      }\n\n      if (!this._isReadyToReOffer()) {\n        return false;\n      }\n\n      this._localHold = false;\n\n      this._onunhold('local');\n\n      var eventHandlers = {\n        succeeded: function succeeded() {\n          if (done) {\n            done();\n          }\n        },\n        failed: function failed() {\n          _this7.terminate({\n            cause: JsSIP_C.causes.WEBRTC_ERROR,\n            status_code: 500,\n            reason_phrase: 'Unhold Failed'\n          });\n        }\n      };\n\n      if (options.useUpdate) {\n        this._sendUpdate({\n          sdpOffer: true,\n          eventHandlers: eventHandlers,\n          extraHeaders: options.extraHeaders\n        });\n      } else {\n        this._sendReinvite({\n          eventHandlers: eventHandlers,\n          extraHeaders: options.extraHeaders\n        });\n      }\n\n      return true;\n    }\n  }, {\n    key: \"renegotiate\",\n    value: function renegotiate() {\n      var _this8 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var done = arguments.length > 1 ? arguments[1] : undefined;\n      logger.debug('renegotiate()');\n      var rtcOfferConstraints = options.rtcOfferConstraints || null;\n\n      if (this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_CONFIRMED) {\n        return false;\n      }\n\n      if (!this._isReadyToReOffer()) {\n        return false;\n      }\n\n      var eventHandlers = {\n        succeeded: function succeeded() {\n          if (done) {\n            done();\n          }\n        },\n        failed: function failed() {\n          _this8.terminate({\n            cause: JsSIP_C.causes.WEBRTC_ERROR,\n            status_code: 500,\n            reason_phrase: 'Media Renegotiation Failed'\n          });\n        }\n      };\n\n      this._setLocalMediaStatus();\n\n      if (options.useUpdate) {\n        this._sendUpdate({\n          sdpOffer: true,\n          eventHandlers: eventHandlers,\n          rtcOfferConstraints: rtcOfferConstraints,\n          extraHeaders: options.extraHeaders\n        });\n      } else {\n        this._sendReinvite({\n          eventHandlers: eventHandlers,\n          rtcOfferConstraints: rtcOfferConstraints,\n          extraHeaders: options.extraHeaders\n        });\n      }\n\n      return true;\n    }\n    /**\n     * Refer\n     */\n\n  }, {\n    key: \"refer\",\n    value: function refer(target, options) {\n      var _this9 = this;\n\n      logger.debug('refer()');\n      var originalTarget = target;\n\n      if (this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_CONFIRMED) {\n        return false;\n      } // Check target validity.\n\n\n      target = this._ua.normalizeTarget(target);\n\n      if (!target) {\n        throw new TypeError(\"Invalid target: \".concat(originalTarget));\n      }\n\n      var referSubscriber = new RTCSession_ReferSubscriber(this);\n      referSubscriber.sendRefer(target, options); // Store in the map.\n\n      var id = referSubscriber.id;\n      this._referSubscribers[id] = referSubscriber; // Listen for ending events so we can remove it from the map.\n\n      referSubscriber.on('requestFailed', function () {\n        delete _this9._referSubscribers[id];\n      });\n      referSubscriber.on('accepted', function () {\n        delete _this9._referSubscribers[id];\n      });\n      referSubscriber.on('failed', function () {\n        delete _this9._referSubscribers[id];\n      });\n      return referSubscriber;\n    }\n    /**\n     * Send a generic in-dialog Request\n     */\n\n  }, {\n    key: \"sendRequest\",\n    value: function sendRequest(method, options) {\n      logger.debug('sendRequest()');\n      return this._dialog.sendRequest(method, options);\n    }\n    /**\n     * In dialog Request Reception\n     */\n\n  }, {\n    key: \"receiveRequest\",\n    value: function receiveRequest(request) {\n      var _this10 = this;\n\n      logger.debug('receiveRequest()');\n\n      if (request.method === JsSIP_C.CANCEL) {\n        /* RFC3261 15 States that a UAS may have accepted an invitation while a CANCEL\n        * was in progress and that the UAC MAY continue with the session established by\n        * any 2xx response, or MAY terminate with BYE. JsSIP does continue with the\n        * established session. So the CANCEL is processed only if the session is not yet\n        * established.\n        */\n\n        /*\n        * Terminate the whole session in case the user didn't accept (or yet send the answer)\n        * nor reject the request opening the session.\n        */\n        if (this._status === C.STATUS_WAITING_FOR_ANSWER || this._status === C.STATUS_ANSWERED) {\n          this._status = C.STATUS_CANCELED;\n\n          this._request.reply(487);\n\n          this._failed('remote', request, JsSIP_C.causes.CANCELED);\n        }\n      } else {\n        // Requests arriving here are in-dialog requests.\n        switch (request.method) {\n          case JsSIP_C.ACK:\n            if (this._status !== C.STATUS_WAITING_FOR_ACK) {\n              return;\n            } // Update signaling status.\n\n\n            this._status = C.STATUS_CONFIRMED;\n            clearTimeout(this._timers.ackTimer);\n            clearTimeout(this._timers.invite2xxTimer);\n\n            if (this._late_sdp) {\n              if (!request.body) {\n                this.terminate({\n                  cause: JsSIP_C.causes.MISSING_SDP,\n                  status_code: 400\n                });\n                break;\n              }\n\n              var e = {\n                originator: 'remote',\n                type: 'answer',\n                sdp: request.body\n              };\n              logger.debug('emit \"sdp\"');\n              this.emit('sdp', e);\n              var answer = new RTCSessionDescription({\n                type: 'answer',\n                sdp: e.sdp\n              });\n              this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n                return _this10._connection.setRemoteDescription(answer);\n              }).then(function () {\n                if (!_this10._is_confirmed) {\n                  _this10._confirmed('remote', request);\n                }\n              })[\"catch\"](function (error) {\n                _this10.terminate({\n                  cause: JsSIP_C.causes.BAD_MEDIA_DESCRIPTION,\n                  status_code: 488\n                });\n\n                logger.warn('emit \"peerconnection:setremotedescriptionfailed\" [error:%o]', error);\n\n                _this10.emit('peerconnection:setremotedescriptionfailed', error);\n              });\n            } else if (!this._is_confirmed) {\n              this._confirmed('remote', request);\n            }\n\n            break;\n\n          case JsSIP_C.BYE:\n            if (this._status === C.STATUS_CONFIRMED || this._status === C.STATUS_WAITING_FOR_ACK) {\n              request.reply(200);\n\n              this._ended('remote', request, JsSIP_C.causes.BYE);\n            } else if (this._status === C.STATUS_INVITE_RECEIVED || this._status === C.STATUS_WAITING_FOR_ANSWER) {\n              request.reply(200);\n\n              this._request.reply(487, 'BYE Received');\n\n              this._ended('remote', request, JsSIP_C.causes.BYE);\n            } else {\n              request.reply(403, 'Wrong Status');\n            }\n\n            break;\n\n          case JsSIP_C.INVITE:\n            if (this._status === C.STATUS_CONFIRMED) {\n              if (request.hasHeader('replaces')) {\n                this._receiveReplaces(request);\n              } else {\n                this._receiveReinvite(request);\n              }\n            } else {\n              request.reply(403, 'Wrong Status');\n            }\n\n            break;\n\n          case JsSIP_C.INFO:\n            if (this._status === C.STATUS_1XX_RECEIVED || this._status === C.STATUS_WAITING_FOR_ANSWER || this._status === C.STATUS_ANSWERED || this._status === C.STATUS_WAITING_FOR_ACK || this._status === C.STATUS_CONFIRMED) {\n              var contentType = request.hasHeader('Content-Type') ? request.getHeader('Content-Type').toLowerCase() : undefined;\n\n              if (contentType && contentType.match(/^application\\/dtmf-relay/i)) {\n                new RTCSession_DTMF(this).init_incoming(request);\n              } else if (contentType !== undefined) {\n                new RTCSession_Info(this).init_incoming(request);\n              } else {\n                request.reply(415);\n              }\n            } else {\n              request.reply(403, 'Wrong Status');\n            }\n\n            break;\n\n          case JsSIP_C.UPDATE:\n            if (this._status === C.STATUS_CONFIRMED) {\n              this._receiveUpdate(request);\n            } else {\n              request.reply(403, 'Wrong Status');\n            }\n\n            break;\n\n          case JsSIP_C.REFER:\n            if (this._status === C.STATUS_CONFIRMED) {\n              this._receiveRefer(request);\n            } else {\n              request.reply(403, 'Wrong Status');\n            }\n\n            break;\n\n          case JsSIP_C.NOTIFY:\n            if (this._status === C.STATUS_CONFIRMED) {\n              this._receiveNotify(request);\n            } else {\n              request.reply(403, 'Wrong Status');\n            }\n\n            break;\n\n          default:\n            request.reply(501);\n        }\n      }\n    }\n    /**\n     * Session Callbacks\n     */\n\n  }, {\n    key: \"onTransportError\",\n    value: function onTransportError() {\n      logger.warn('onTransportError()');\n\n      if (this._status !== C.STATUS_TERMINATED) {\n        this.terminate({\n          status_code: 500,\n          reason_phrase: JsSIP_C.causes.CONNECTION_ERROR,\n          cause: JsSIP_C.causes.CONNECTION_ERROR\n        });\n      }\n    }\n  }, {\n    key: \"onRequestTimeout\",\n    value: function onRequestTimeout() {\n      logger.warn('onRequestTimeout()');\n\n      if (this._status !== C.STATUS_TERMINATED) {\n        this.terminate({\n          status_code: 408,\n          reason_phrase: JsSIP_C.causes.REQUEST_TIMEOUT,\n          cause: JsSIP_C.causes.REQUEST_TIMEOUT\n        });\n      }\n    }\n  }, {\n    key: \"onDialogError\",\n    value: function onDialogError() {\n      logger.warn('onDialogError()');\n\n      if (this._status !== C.STATUS_TERMINATED) {\n        this.terminate({\n          status_code: 500,\n          reason_phrase: JsSIP_C.causes.DIALOG_ERROR,\n          cause: JsSIP_C.causes.DIALOG_ERROR\n        });\n      }\n    } // Called from DTMF handler.\n\n  }, {\n    key: \"newDTMF\",\n    value: function newDTMF(data) {\n      logger.debug('newDTMF()');\n      this.emit('newDTMF', data);\n    } // Called from Info handler.\n\n  }, {\n    key: \"newInfo\",\n    value: function newInfo(data) {\n      logger.debug('newInfo()');\n      this.emit('newInfo', data);\n    }\n    /**\n     * Check if RTCSession is ready for an outgoing re-INVITE or UPDATE with SDP.\n     */\n\n  }, {\n    key: \"_isReadyToReOffer\",\n    value: function _isReadyToReOffer() {\n      if (!this._rtcReady) {\n        logger.debug('_isReadyToReOffer() | internal WebRTC status not ready');\n        return false;\n      } // No established yet.\n\n\n      if (!this._dialog) {\n        logger.debug('_isReadyToReOffer() | session not established yet');\n        return false;\n      } // Another INVITE transaction is in progress.\n\n\n      if (this._dialog.uac_pending_reply === true || this._dialog.uas_pending_reply === true) {\n        logger.debug('_isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress');\n        return false;\n      }\n\n      return true;\n    }\n  }, {\n    key: \"_close\",\n    value: function _close() {\n      logger.debug('close()'); // Close local MediaStream if it was not given by the user.\n\n      if (this._localMediaStream && this._localMediaStreamLocallyGenerated) {\n        logger.debug('close() | closing local MediaStream');\n        Utils.closeMediaStream(this._localMediaStream);\n      }\n\n      if (this._status === C.STATUS_TERMINATED) {\n        return;\n      }\n\n      this._status = C.STATUS_TERMINATED; // Terminate RTC.\n\n      if (this._connection) {\n        try {\n          this._connection.close();\n        } catch (error) {\n          logger.warn('close() | error closing the RTCPeerConnection: %o', error);\n        }\n      } // Terminate signaling.\n      // Clear SIP timers.\n\n\n      for (var timer in this._timers) {\n        if (Object.prototype.hasOwnProperty.call(this._timers, timer)) {\n          clearTimeout(this._timers[timer]);\n        }\n      } // Clear Session Timers.\n\n\n      clearTimeout(this._sessionTimers.timer); // Terminate confirmed dialog.\n\n      if (this._dialog) {\n        this._dialog.terminate();\n\n        delete this._dialog;\n      } // Terminate early dialogs.\n\n\n      for (var dialog in this._earlyDialogs) {\n        if (Object.prototype.hasOwnProperty.call(this._earlyDialogs, dialog)) {\n          this._earlyDialogs[dialog].terminate();\n\n          delete this._earlyDialogs[dialog];\n        }\n      } // Terminate REFER subscribers.\n\n\n      for (var subscriber in this._referSubscribers) {\n        if (Object.prototype.hasOwnProperty.call(this._referSubscribers, subscriber)) {\n          delete this._referSubscribers[subscriber];\n        }\n      }\n\n      this._ua.destroyRTCSession(this);\n    }\n    /**\n     * Private API.\n     */\n\n    /**\n     * RFC3261 13.3.1.4\n     * Response retransmissions cannot be accomplished by transaction layer\n     *  since it is destroyed when receiving the first 2xx answer\n     */\n\n  }, {\n    key: \"_setInvite2xxTimer\",\n    value: function _setInvite2xxTimer(request, body) {\n      var timeout = Timers.T1;\n\n      function invite2xxRetransmission() {\n        if (this._status !== C.STATUS_WAITING_FOR_ACK) {\n          return;\n        }\n\n        request.reply(200, null, [\"Contact: \".concat(this._contact)], body);\n\n        if (timeout < Timers.T2) {\n          timeout = timeout * 2;\n\n          if (timeout > Timers.T2) {\n            timeout = Timers.T2;\n          }\n        }\n\n        this._timers.invite2xxTimer = setTimeout(invite2xxRetransmission.bind(this), timeout);\n      }\n\n      this._timers.invite2xxTimer = setTimeout(invite2xxRetransmission.bind(this), timeout);\n    }\n    /**\n     * RFC3261 14.2\n     * If a UAS generates a 2xx response and never receives an ACK,\n     *  it SHOULD generate a BYE to terminate the dialog.\n     */\n\n  }, {\n    key: \"_setACKTimer\",\n    value: function _setACKTimer() {\n      var _this11 = this;\n\n      this._timers.ackTimer = setTimeout(function () {\n        if (_this11._status === C.STATUS_WAITING_FOR_ACK) {\n          logger.debug('no ACK received, terminating the session');\n          clearTimeout(_this11._timers.invite2xxTimer);\n\n          _this11.sendRequest(JsSIP_C.BYE);\n\n          _this11._ended('remote', null, JsSIP_C.causes.NO_ACK);\n        }\n      }, Timers.TIMER_H);\n    }\n  }, {\n    key: \"_createRTCConnection\",\n    value: function _createRTCConnection(pcConfig, rtcConstraints) {\n      var _this12 = this;\n\n      this._connection = new RTCPeerConnection(pcConfig, rtcConstraints);\n\n      this._connection.addEventListener('iceconnectionstatechange', function () {\n        var state = _this12._connection.iceConnectionState; // TODO: Do more with different states.\n\n        if (state === 'failed') {\n          _this12.terminate({\n            cause: JsSIP_C.causes.RTP_TIMEOUT,\n            status_code: 408,\n            reason_phrase: JsSIP_C.causes.RTP_TIMEOUT\n          });\n        }\n      });\n\n      logger.debug('emit \"peerconnection\"');\n      this.emit('peerconnection', {\n        peerconnection: this._connection\n      });\n    }\n  }, {\n    key: \"_createLocalDescription\",\n    value: function _createLocalDescription(type, constraints) {\n      var _this13 = this;\n\n      logger.debug('createLocalDescription()');\n      if (type !== 'offer' && type !== 'answer') throw new Error(\"createLocalDescription() | invalid type \\\"\".concat(type, \"\\\"\"));\n      var connection = this._connection;\n      this._rtcReady = false;\n      return Promise.resolve() // Create Offer or Answer.\n      .then(function () {\n        if (type === 'offer') {\n          return connection.createOffer(constraints)[\"catch\"](function (error) {\n            logger.warn('emit \"peerconnection:createofferfailed\" [error:%o]', error);\n\n            _this13.emit('peerconnection:createofferfailed', error);\n\n            return Promise.reject(error);\n          });\n        } else {\n          return connection.createAnswer(constraints)[\"catch\"](function (error) {\n            logger.warn('emit \"peerconnection:createanswerfailed\" [error:%o]', error);\n\n            _this13.emit('peerconnection:createanswerfailed', error);\n\n            return Promise.reject(error);\n          });\n        }\n      }) // Set local description.\n      .then(function (desc) {\n        return connection.setLocalDescription(desc)[\"catch\"](function (error) {\n          _this13._rtcReady = true;\n          logger.warn('emit \"peerconnection:setlocaldescriptionfailed\" [error:%o]', error);\n\n          _this13.emit('peerconnection:setlocaldescriptionfailed', error);\n\n          return Promise.reject(error);\n        });\n      }).then(function () {\n        // Resolve right away if 'pc.iceGatheringState' is 'complete'.\n\n        /**\n         * Resolve right away if:\n         * - 'connection.iceGatheringState' is 'complete' and no 'iceRestart' constraint is set.\n         * - 'connection.iceGatheringState' is 'gathering' and 'iceReady' is true.\n         */\n        var iceRestart = constraints && constraints.iceRestart;\n\n        if (connection.iceGatheringState === 'complete' && !iceRestart || connection.iceGatheringState === 'gathering' && _this13._iceReady) {\n          _this13._rtcReady = true;\n          var e = {\n            originator: 'local',\n            type: type,\n            sdp: connection.localDescription.sdp\n          };\n          logger.debug('emit \"sdp\"');\n\n          _this13.emit('sdp', e);\n\n          return Promise.resolve(e.sdp);\n        } // Add 'pc.onicencandidate' event handler to resolve on last candidate.\n\n\n        return new Promise(function (resolve) {\n          var finished = false;\n          var iceCandidateListener;\n          var iceGatheringStateListener;\n          _this13._iceReady = false;\n\n          var ready = function ready() {\n            if (finished) {\n              return;\n            }\n\n            connection.removeEventListener('icecandidate', iceCandidateListener);\n            connection.removeEventListener('icegatheringstatechange', iceGatheringStateListener);\n            finished = true;\n            _this13._rtcReady = true; // connection.iceGatheringState will still indicate 'gathering' and thus be blocking.\n\n            _this13._iceReady = true;\n            var e = {\n              originator: 'local',\n              type: type,\n              sdp: connection.localDescription.sdp\n            };\n            logger.debug('emit \"sdp\"');\n\n            _this13.emit('sdp', e);\n\n            resolve(e.sdp);\n          };\n\n          connection.addEventListener('icecandidate', iceCandidateListener = function iceCandidateListener(event) {\n            var candidate = event.candidate;\n\n            if (candidate) {\n              _this13.emit('icecandidate', {\n                candidate: candidate,\n                ready: ready\n              });\n            } else {\n              ready();\n            }\n          });\n          connection.addEventListener('icegatheringstatechange', iceGatheringStateListener = function iceGatheringStateListener() {\n            if (connection.iceGatheringState === 'complete') {\n              ready();\n            }\n          });\n        });\n      });\n    }\n    /**\n     * Dialog Management\n     */\n\n  }, {\n    key: \"_createDialog\",\n    value: function _createDialog(message, type, early) {\n      var local_tag = type === 'UAS' ? message.to_tag : message.from_tag;\n      var remote_tag = type === 'UAS' ? message.from_tag : message.to_tag;\n      var id = message.call_id + local_tag + remote_tag;\n      var early_dialog = this._earlyDialogs[id]; // Early Dialog.\n\n      if (early) {\n        if (early_dialog) {\n          return true;\n        } else {\n          early_dialog = new Dialog(this, message, type, Dialog.C.STATUS_EARLY); // Dialog has been successfully created.\n\n          if (early_dialog.error) {\n            logger.debug(early_dialog.error);\n\n            this._failed('remote', message, JsSIP_C.causes.INTERNAL_ERROR);\n\n            return false;\n          } else {\n            this._earlyDialogs[id] = early_dialog;\n            return true;\n          }\n        }\n      } // Confirmed Dialog.\n      else {\n          this._from_tag = message.from_tag;\n          this._to_tag = message.to_tag; // In case the dialog is in _early_ state, update it.\n\n          if (early_dialog) {\n            early_dialog.update(message, type);\n            this._dialog = early_dialog;\n            delete this._earlyDialogs[id];\n            return true;\n          } // Otherwise, create a _confirmed_ dialog.\n\n\n          var dialog = new Dialog(this, message, type);\n\n          if (dialog.error) {\n            logger.debug(dialog.error);\n\n            this._failed('remote', message, JsSIP_C.causes.INTERNAL_ERROR);\n\n            return false;\n          } else {\n            this._dialog = dialog;\n            return true;\n          }\n        }\n    }\n    /**\n     * In dialog INVITE Reception\n     */\n\n  }, {\n    key: \"_receiveReinvite\",\n    value: function _receiveReinvite(request) {\n      var _this14 = this;\n\n      logger.debug('receiveReinvite()');\n      var contentType = request.hasHeader('Content-Type') ? request.getHeader('Content-Type').toLowerCase() : undefined;\n      var data = {\n        request: request,\n        callback: undefined,\n        reject: reject.bind(this)\n      };\n      var rejected = false;\n\n      function reject() {\n        var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n        rejected = true;\n        var status_code = options.status_code || 403;\n        var reason_phrase = options.reason_phrase || '';\n        var extraHeaders = Utils.cloneArray(options.extraHeaders);\n\n        if (this._status !== C.STATUS_CONFIRMED) {\n          return false;\n        }\n\n        if (status_code < 300 || status_code >= 700) {\n          throw new TypeError(\"Invalid status_code: \".concat(status_code));\n        }\n\n        request.reply(status_code, reason_phrase, extraHeaders);\n      } // Emit 'reinvite'.\n\n\n      this.emit('reinvite', data);\n\n      if (rejected) {\n        return;\n      }\n\n      this._late_sdp = false; // Request without SDP.\n\n      if (!request.body) {\n        this._late_sdp = true;\n\n        if (this._remoteHold) {\n          this._remoteHold = false;\n\n          this._onunhold('remote');\n        }\n\n        this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n          return _this14._createLocalDescription('offer', _this14._rtcOfferConstraints);\n        }).then(function (sdp) {\n          sendAnswer.call(_this14, sdp);\n        })[\"catch\"](function () {\n          request.reply(500);\n        });\n        return;\n      } // Request with SDP.\n\n\n      if (contentType !== 'application/sdp') {\n        logger.debug('invalid Content-Type');\n        request.reply(415);\n        return;\n      }\n\n      this._processInDialogSdpOffer(request) // Send answer.\n      .then(function (desc) {\n        if (_this14._status === C.STATUS_TERMINATED) {\n          return;\n        }\n\n        sendAnswer.call(_this14, desc);\n      })[\"catch\"](function (error) {\n        logger.warn(error);\n      });\n\n      function sendAnswer(desc) {\n        var _this15 = this;\n\n        var extraHeaders = [\"Contact: \".concat(this._contact)];\n\n        this._handleSessionTimersInIncomingRequest(request, extraHeaders);\n\n        if (this._late_sdp) {\n          desc = this._mangleOffer(desc);\n        }\n\n        request.reply(200, null, extraHeaders, desc, function () {\n          _this15._status = C.STATUS_WAITING_FOR_ACK;\n\n          _this15._setInvite2xxTimer(request, desc);\n\n          _this15._setACKTimer();\n        }); // If callback is given execute it.\n\n        if (typeof data.callback === 'function') {\n          data.callback();\n        }\n      }\n    }\n    /**\n     * In dialog UPDATE Reception\n     */\n\n  }, {\n    key: \"_receiveUpdate\",\n    value: function _receiveUpdate(request) {\n      var _this16 = this;\n\n      logger.debug('receiveUpdate()');\n      var contentType = request.hasHeader('Content-Type') ? request.getHeader('Content-Type').toLowerCase() : undefined;\n      var data = {\n        request: request,\n        callback: undefined,\n        reject: reject.bind(this)\n      };\n      var rejected = false;\n\n      function reject() {\n        var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n        rejected = true;\n        var status_code = options.status_code || 403;\n        var reason_phrase = options.reason_phrase || '';\n        var extraHeaders = Utils.cloneArray(options.extraHeaders);\n\n        if (this._status !== C.STATUS_CONFIRMED) {\n          return false;\n        }\n\n        if (status_code < 300 || status_code >= 700) {\n          throw new TypeError(\"Invalid status_code: \".concat(status_code));\n        }\n\n        request.reply(status_code, reason_phrase, extraHeaders);\n      } // Emit 'update'.\n\n\n      this.emit('update', data);\n\n      if (rejected) {\n        return;\n      }\n\n      if (!request.body) {\n        sendAnswer.call(this, null);\n        return;\n      }\n\n      if (contentType !== 'application/sdp') {\n        logger.debug('invalid Content-Type');\n        request.reply(415);\n        return;\n      }\n\n      this._processInDialogSdpOffer(request) // Send answer.\n      .then(function (desc) {\n        if (_this16._status === C.STATUS_TERMINATED) {\n          return;\n        }\n\n        sendAnswer.call(_this16, desc);\n      })[\"catch\"](function (error) {\n        logger.warn(error);\n      });\n\n      function sendAnswer(desc) {\n        var extraHeaders = [\"Contact: \".concat(this._contact)];\n\n        this._handleSessionTimersInIncomingRequest(request, extraHeaders);\n\n        request.reply(200, null, extraHeaders, desc); // If callback is given execute it.\n\n        if (typeof data.callback === 'function') {\n          data.callback();\n        }\n      }\n    }\n  }, {\n    key: \"_processInDialogSdpOffer\",\n    value: function _processInDialogSdpOffer(request) {\n      var _this17 = this;\n\n      logger.debug('_processInDialogSdpOffer()');\n      var sdp = request.parseSDP();\n      var hold = false;\n\n      var _iterator4 = _createForOfIteratorHelper(sdp.media),\n          _step4;\n\n      try {\n        for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n          var m = _step4.value;\n\n          if (holdMediaTypes.indexOf(m.type) === -1) {\n            continue;\n          }\n\n          var direction = m.direction || sdp.direction || 'sendrecv';\n\n          if (direction === 'sendonly' || direction === 'inactive') {\n            hold = true;\n          } // If at least one of the streams is active don't emit 'hold'.\n          else {\n              hold = false;\n              break;\n            }\n        }\n      } catch (err) {\n        _iterator4.e(err);\n      } finally {\n        _iterator4.f();\n      }\n\n      var e = {\n        originator: 'remote',\n        type: 'offer',\n        sdp: request.body\n      };\n      logger.debug('emit \"sdp\"');\n      this.emit('sdp', e);\n      var offer = new RTCSessionDescription({\n        type: 'offer',\n        sdp: e.sdp\n      });\n      this._connectionPromiseQueue = this._connectionPromiseQueue // Set remote description.\n      .then(function () {\n        if (_this17._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        }\n\n        return _this17._connection.setRemoteDescription(offer)[\"catch\"](function (error) {\n          request.reply(488);\n          logger.warn('emit \"peerconnection:setremotedescriptionfailed\" [error:%o]', error);\n\n          _this17.emit('peerconnection:setremotedescriptionfailed', error);\n\n          throw error;\n        });\n      }).then(function () {\n        if (_this17._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        }\n\n        if (_this17._remoteHold === true && hold === false) {\n          _this17._remoteHold = false;\n\n          _this17._onunhold('remote');\n        } else if (_this17._remoteHold === false && hold === true) {\n          _this17._remoteHold = true;\n\n          _this17._onhold('remote');\n        }\n      }) // Create local description.\n      .then(function () {\n        if (_this17._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        }\n\n        return _this17._createLocalDescription('answer', _this17._rtcAnswerConstraints)[\"catch\"](function (error) {\n          request.reply(500);\n          logger.warn('emit \"peerconnection:createtelocaldescriptionfailed\" [error:%o]', error);\n          throw error;\n        });\n      })[\"catch\"](function (error) {\n        logger.warn('_processInDialogSdpOffer() failed [error: %o]', error);\n      });\n      return this._connectionPromiseQueue;\n    }\n    /**\n     * In dialog Refer Reception\n     */\n\n  }, {\n    key: \"_receiveRefer\",\n    value: function _receiveRefer(request) {\n      var _this18 = this;\n\n      logger.debug('receiveRefer()');\n\n      if (!request.refer_to) {\n        logger.debug('no Refer-To header field present in REFER');\n        request.reply(400);\n        return;\n      }\n\n      if (request.refer_to.uri.scheme !== JsSIP_C.SIP) {\n        logger.debug('Refer-To header field points to a non-SIP URI scheme');\n        request.reply(416);\n        return;\n      } // Reply before the transaction timer expires.\n\n\n      request.reply(202);\n      var notifier = new RTCSession_ReferNotifier(this, request.cseq);\n      logger.debug('emit \"refer\"'); // Emit 'refer'.\n\n      this.emit('refer', {\n        request: request,\n        accept: function accept(initCallback, options) {\n          _accept.call(_this18, initCallback, options);\n        },\n        reject: function reject() {\n          _reject.call(_this18);\n        }\n      });\n\n      function _accept(initCallback) {\n        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n        initCallback = typeof initCallback === 'function' ? initCallback : null;\n\n        if (this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_CONFIRMED) {\n          return false;\n        }\n\n        var session = new RTCSession(this._ua);\n        session.on('progress', function (_ref2) {\n          var response = _ref2.response;\n          notifier.notify(response.status_code, response.reason_phrase);\n        });\n        session.on('accepted', function (_ref3) {\n          var response = _ref3.response;\n          notifier.notify(response.status_code, response.reason_phrase);\n        });\n        session.on('_failed', function (_ref4) {\n          var message = _ref4.message,\n              cause = _ref4.cause;\n\n          if (message) {\n            notifier.notify(message.status_code, message.reason_phrase);\n          } else {\n            notifier.notify(487, cause);\n          }\n        }); // Consider the Replaces header present in the Refer-To URI.\n\n        if (request.refer_to.uri.hasHeader('replaces')) {\n          var replaces = decodeURIComponent(request.refer_to.uri.getHeader('replaces'));\n          options.extraHeaders = Utils.cloneArray(options.extraHeaders);\n          options.extraHeaders.push(\"Replaces: \".concat(replaces));\n        }\n\n        session.connect(request.refer_to.uri.toAor(), options, initCallback);\n      }\n\n      function _reject() {\n        notifier.notify(603);\n      }\n    }\n    /**\n     * In dialog Notify Reception\n     */\n\n  }, {\n    key: \"_receiveNotify\",\n    value: function _receiveNotify(request) {\n      logger.debug('receiveNotify()');\n\n      if (!request.event) {\n        request.reply(400);\n      }\n\n      switch (request.event.event) {\n        case 'refer':\n          {\n            var id;\n            var referSubscriber;\n\n            if (request.event.params && request.event.params.id) {\n              id = request.event.params.id;\n              referSubscriber = this._referSubscribers[id];\n            } else if (Object.keys(this._referSubscribers).length === 1) {\n              referSubscriber = this._referSubscribers[Object.keys(this._referSubscribers)[0]];\n            } else {\n              request.reply(400, 'Missing event id parameter');\n              return;\n            }\n\n            if (!referSubscriber) {\n              request.reply(481, 'Subscription does not exist');\n              return;\n            }\n\n            referSubscriber.receiveNotify(request);\n            request.reply(200);\n            break;\n          }\n\n        default:\n          {\n            request.reply(489);\n          }\n      }\n    }\n    /**\n     * INVITE with Replaces Reception\n     */\n\n  }, {\n    key: \"_receiveReplaces\",\n    value: function _receiveReplaces(request) {\n      var _this20 = this;\n\n      logger.debug('receiveReplaces()');\n\n      function _accept2(initCallback) {\n        var _this19 = this;\n\n        if (this._status !== C.STATUS_WAITING_FOR_ACK && this._status !== C.STATUS_CONFIRMED) {\n          return false;\n        }\n\n        var session = new RTCSession(this._ua); // Terminate the current session when the new one is confirmed.\n\n        session.on('confirmed', function () {\n          _this19.terminate();\n        });\n        session.init_incoming(request, initCallback);\n      }\n\n      function _reject2() {\n        logger.debug('Replaced INVITE rejected by the user');\n        request.reply(486);\n      } // Emit 'replace'.\n\n\n      this.emit('replaces', {\n        request: request,\n        accept: function accept(initCallback) {\n          _accept2.call(_this20, initCallback);\n        },\n        reject: function reject() {\n          _reject2.call(_this20);\n        }\n      });\n    }\n    /**\n     * Initial Request Sender\n     */\n\n  }, {\n    key: \"_sendInitialRequest\",\n    value: function _sendInitialRequest(mediaConstraints, rtcOfferConstraints, mediaStream) {\n      var _this21 = this;\n\n      var request_sender = new RequestSender(this._ua, this._request, {\n        onRequestTimeout: function onRequestTimeout() {\n          _this21.onRequestTimeout();\n        },\n        onTransportError: function onTransportError() {\n          _this21.onTransportError();\n        },\n        // Update the request on authentication.\n        onAuthenticated: function onAuthenticated(request) {\n          _this21._request = request;\n        },\n        onReceiveResponse: function onReceiveResponse(response) {\n          _this21._receiveInviteResponse(response);\n        }\n      }); // This Promise is resolved within the next iteration, so the app has now\n      // a chance to set events such as 'peerconnection' and 'connecting'.\n\n      Promise.resolve() // Get a stream if required.\n      .then(function () {\n        // A stream is given, let the app set events such as 'peerconnection' and 'connecting'.\n        if (mediaStream) {\n          return mediaStream;\n        } // Request for user media access.\n        else if (mediaConstraints.audio || mediaConstraints.video) {\n            _this21._localMediaStreamLocallyGenerated = true;\n            return navigator.mediaDevices.getUserMedia(mediaConstraints)[\"catch\"](function (error) {\n              if (_this21._status === C.STATUS_TERMINATED) {\n                throw new Error('terminated');\n              }\n\n              _this21._failed('local', null, JsSIP_C.causes.USER_DENIED_MEDIA_ACCESS);\n\n              logger.warn('emit \"getusermediafailed\" [error:%o]', error);\n\n              _this21.emit('getusermediafailed', error);\n\n              throw error;\n            });\n          }\n      }).then(function (stream) {\n        if (_this21._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        }\n\n        _this21._localMediaStream = stream;\n\n        if (stream) {\n          stream.getTracks().forEach(function (track) {\n            _this21._connection.addTrack(track, stream);\n          });\n        } // TODO: should this be triggered here?\n\n\n        _this21._connecting(_this21._request);\n\n        return _this21._createLocalDescription('offer', rtcOfferConstraints)[\"catch\"](function (error) {\n          _this21._failed('local', null, JsSIP_C.causes.WEBRTC_ERROR);\n\n          throw error;\n        });\n      }).then(function (desc) {\n        if (_this21._is_canceled || _this21._status === C.STATUS_TERMINATED) {\n          throw new Error('terminated');\n        }\n\n        _this21._request.body = desc;\n        _this21._status = C.STATUS_INVITE_SENT;\n        logger.debug('emit \"sending\" [request:%o]', _this21._request); // Emit 'sending' so the app can mangle the body before the request is sent.\n\n        _this21.emit('sending', {\n          request: _this21._request\n        });\n\n        request_sender.send();\n      })[\"catch\"](function (error) {\n        if (_this21._status === C.STATUS_TERMINATED) {\n          return;\n        }\n\n        logger.warn(error);\n      });\n    }\n    /**\n     * Get DTMF RTCRtpSender.\n     */\n\n  }, {\n    key: \"_getDTMFRTPSender\",\n    value: function _getDTMFRTPSender() {\n      var sender = this._connection.getSenders().find(function (rtpSender) {\n        return rtpSender.track && rtpSender.track.kind === 'audio';\n      });\n\n      if (!(sender && sender.dtmf)) {\n        logger.warn('sendDTMF() | no local audio track to send DTMF with');\n        return;\n      }\n\n      return sender.dtmf;\n    }\n    /**\n     * Reception of Response for Initial INVITE\n     */\n\n  }, {\n    key: \"_receiveInviteResponse\",\n    value: function _receiveInviteResponse(response) {\n      var _this22 = this;\n\n      logger.debug('receiveInviteResponse()'); // Handle 2XX retransmissions and responses from forked requests.\n\n      if (this._dialog && response.status_code >= 200 && response.status_code <= 299) {\n        /*\n         * If it is a retransmission from the endpoint that established\n         * the dialog, send an ACK\n         */\n        if (this._dialog.id.call_id === response.call_id && this._dialog.id.local_tag === response.from_tag && this._dialog.id.remote_tag === response.to_tag) {\n          this.sendRequest(JsSIP_C.ACK);\n          return;\n        } // If not, send an ACK  and terminate.\n        else {\n            var dialog = new Dialog(this, response, 'UAC');\n\n            if (dialog.error !== undefined) {\n              logger.debug(dialog.error);\n              return;\n            }\n\n            this.sendRequest(JsSIP_C.ACK);\n            this.sendRequest(JsSIP_C.BYE);\n            return;\n          }\n      } // Proceed to cancellation if the user requested.\n\n\n      if (this._is_canceled) {\n        if (response.status_code >= 100 && response.status_code < 200) {\n          this._request.cancel(this._cancel_reason);\n        } else if (response.status_code >= 200 && response.status_code < 299) {\n          this._acceptAndTerminate(response);\n        }\n\n        return;\n      }\n\n      if (this._status !== C.STATUS_INVITE_SENT && this._status !== C.STATUS_1XX_RECEIVED) {\n        return;\n      }\n\n      switch (true) {\n        case /^100$/.test(response.status_code):\n          this._status = C.STATUS_1XX_RECEIVED;\n          break;\n\n        case /^1[0-9]{2}$/.test(response.status_code):\n          {\n            // Do nothing with 1xx responses without To tag.\n            if (!response.to_tag) {\n              logger.debug('1xx response received without to tag');\n              break;\n            } // Create Early Dialog if 1XX comes with contact.\n\n\n            if (response.hasHeader('contact')) {\n              // An error on dialog creation will fire 'failed' event.\n              if (!this._createDialog(response, 'UAC', true)) {\n                break;\n              }\n            }\n\n            this._status = C.STATUS_1XX_RECEIVED;\n\n            if (!response.body) {\n              this._progress('remote', response);\n\n              break;\n            }\n\n            var e = {\n              originator: 'remote',\n              type: 'answer',\n              sdp: response.body\n            };\n            logger.debug('emit \"sdp\"');\n            this.emit('sdp', e);\n            var answer = new RTCSessionDescription({\n              type: 'answer',\n              sdp: e.sdp\n            });\n            this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n              return _this22._connection.setRemoteDescription(answer);\n            }).then(function () {\n              return _this22._progress('remote', response);\n            })[\"catch\"](function (error) {\n              logger.warn('emit \"peerconnection:setremotedescriptionfailed\" [error:%o]', error);\n\n              _this22.emit('peerconnection:setremotedescriptionfailed', error);\n            });\n            break;\n          }\n\n        case /^2[0-9]{2}$/.test(response.status_code):\n          {\n            this._status = C.STATUS_CONFIRMED;\n\n            if (!response.body) {\n              this._acceptAndTerminate(response, 400, JsSIP_C.causes.MISSING_SDP);\n\n              this._failed('remote', response, JsSIP_C.causes.BAD_MEDIA_DESCRIPTION);\n\n              break;\n            } // An error on dialog creation will fire 'failed' event.\n\n\n            if (!this._createDialog(response, 'UAC')) {\n              break;\n            }\n\n            var _e = {\n              originator: 'remote',\n              type: 'answer',\n              sdp: response.body\n            };\n            logger.debug('emit \"sdp\"');\n            this.emit('sdp', _e);\n\n            var _answer = new RTCSessionDescription({\n              type: 'answer',\n              sdp: _e.sdp\n            });\n\n            this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n              // Be ready for 200 with SDP after a 180/183 with SDP.\n              // We created a SDP 'answer' for it, so check the current signaling state.\n              if (_this22._connection.signalingState === 'stable') {\n                return _this22._connection.createOffer(_this22._rtcOfferConstraints).then(function (offer) {\n                  return _this22._connection.setLocalDescription(offer);\n                })[\"catch\"](function (error) {\n                  _this22._acceptAndTerminate(response, 500, error.toString());\n\n                  _this22._failed('local', response, JsSIP_C.causes.WEBRTC_ERROR);\n                });\n              }\n            }).then(function () {\n              _this22._connection.setRemoteDescription(_answer).then(function () {\n                // Handle Session Timers.\n                _this22._handleSessionTimersInIncomingResponse(response);\n\n                _this22._accepted('remote', response);\n\n                _this22.sendRequest(JsSIP_C.ACK);\n\n                _this22._confirmed('local', null);\n              })[\"catch\"](function (error) {\n                _this22._acceptAndTerminate(response, 488, 'Not Acceptable Here');\n\n                _this22._failed('remote', response, JsSIP_C.causes.BAD_MEDIA_DESCRIPTION);\n\n                logger.warn('emit \"peerconnection:setremotedescriptionfailed\" [error:%o]', error);\n\n                _this22.emit('peerconnection:setremotedescriptionfailed', error);\n              });\n            });\n            break;\n          }\n\n        default:\n          {\n            var cause = Utils.sipErrorCause(response.status_code);\n\n            this._failed('remote', response, cause);\n          }\n      }\n    }\n    /**\n     * Send Re-INVITE\n     */\n\n  }, {\n    key: \"_sendReinvite\",\n    value: function _sendReinvite() {\n      var _this23 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      logger.debug('sendReinvite()');\n      var extraHeaders = Utils.cloneArray(options.extraHeaders);\n      var eventHandlers = Utils.cloneObject(options.eventHandlers);\n      var rtcOfferConstraints = options.rtcOfferConstraints || this._rtcOfferConstraints || null;\n      var succeeded = false;\n      extraHeaders.push(\"Contact: \".concat(this._contact));\n      extraHeaders.push('Content-Type: application/sdp'); // Session Timers.\n\n      if (this._sessionTimers.running) {\n        extraHeaders.push(\"Session-Expires: \".concat(this._sessionTimers.currentExpires, \";refresher=\").concat(this._sessionTimers.refresher ? 'uac' : 'uas'));\n      }\n\n      this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n        return _this23._createLocalDescription('offer', rtcOfferConstraints);\n      }).then(function (sdp) {\n        sdp = _this23._mangleOffer(sdp);\n        var e = {\n          originator: 'local',\n          type: 'offer',\n          sdp: sdp\n        };\n        logger.debug('emit \"sdp\"');\n\n        _this23.emit('sdp', e);\n\n        _this23.sendRequest(JsSIP_C.INVITE, {\n          extraHeaders: extraHeaders,\n          body: sdp,\n          eventHandlers: {\n            onSuccessResponse: function onSuccessResponse(response) {\n              onSucceeded.call(_this23, response);\n              succeeded = true;\n            },\n            onErrorResponse: function onErrorResponse(response) {\n              onFailed.call(_this23, response);\n            },\n            onTransportError: function onTransportError() {\n              _this23.onTransportError(); // Do nothing because session ends.\n\n            },\n            onRequestTimeout: function onRequestTimeout() {\n              _this23.onRequestTimeout(); // Do nothing because session ends.\n\n            },\n            onDialogError: function onDialogError() {\n              _this23.onDialogError(); // Do nothing because session ends.\n\n            }\n          }\n        });\n      })[\"catch\"](function () {\n        onFailed();\n      });\n\n      function onSucceeded(response) {\n        var _this24 = this;\n\n        if (this._status === C.STATUS_TERMINATED) {\n          return;\n        }\n\n        this.sendRequest(JsSIP_C.ACK); // If it is a 2XX retransmission exit now.\n\n        if (succeeded) {\n          return;\n        } // Handle Session Timers.\n\n\n        this._handleSessionTimersInIncomingResponse(response); // Must have SDP answer.\n\n\n        if (!response.body) {\n          onFailed.call(this);\n          return;\n        } else if (!response.hasHeader('Content-Type') || response.getHeader('Content-Type').toLowerCase() !== 'application/sdp') {\n          onFailed.call(this);\n          return;\n        }\n\n        var e = {\n          originator: 'remote',\n          type: 'answer',\n          sdp: response.body\n        };\n        logger.debug('emit \"sdp\"');\n        this.emit('sdp', e);\n        var answer = new RTCSessionDescription({\n          type: 'answer',\n          sdp: e.sdp\n        });\n        this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n          return _this24._connection.setRemoteDescription(answer);\n        }).then(function () {\n          if (eventHandlers.succeeded) {\n            eventHandlers.succeeded(response);\n          }\n        })[\"catch\"](function (error) {\n          onFailed.call(_this24);\n          logger.warn('emit \"peerconnection:setremotedescriptionfailed\" [error:%o]', error);\n\n          _this24.emit('peerconnection:setremotedescriptionfailed', error);\n        });\n      }\n\n      function onFailed(response) {\n        if (eventHandlers.failed) {\n          eventHandlers.failed(response);\n        }\n      }\n    }\n    /**\n     * Send UPDATE\n     */\n\n  }, {\n    key: \"_sendUpdate\",\n    value: function _sendUpdate() {\n      var _this25 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      logger.debug('sendUpdate()');\n      var extraHeaders = Utils.cloneArray(options.extraHeaders);\n      var eventHandlers = Utils.cloneObject(options.eventHandlers);\n      var rtcOfferConstraints = options.rtcOfferConstraints || this._rtcOfferConstraints || null;\n      var sdpOffer = options.sdpOffer || false;\n      var succeeded = false;\n      extraHeaders.push(\"Contact: \".concat(this._contact)); // Session Timers.\n\n      if (this._sessionTimers.running) {\n        extraHeaders.push(\"Session-Expires: \".concat(this._sessionTimers.currentExpires, \";refresher=\").concat(this._sessionTimers.refresher ? 'uac' : 'uas'));\n      }\n\n      if (sdpOffer) {\n        extraHeaders.push('Content-Type: application/sdp');\n        this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n          return _this25._createLocalDescription('offer', rtcOfferConstraints);\n        }).then(function (sdp) {\n          sdp = _this25._mangleOffer(sdp);\n          var e = {\n            originator: 'local',\n            type: 'offer',\n            sdp: sdp\n          };\n          logger.debug('emit \"sdp\"');\n\n          _this25.emit('sdp', e);\n\n          _this25.sendRequest(JsSIP_C.UPDATE, {\n            extraHeaders: extraHeaders,\n            body: sdp,\n            eventHandlers: {\n              onSuccessResponse: function onSuccessResponse(response) {\n                onSucceeded.call(_this25, response);\n                succeeded = true;\n              },\n              onErrorResponse: function onErrorResponse(response) {\n                onFailed.call(_this25, response);\n              },\n              onTransportError: function onTransportError() {\n                _this25.onTransportError(); // Do nothing because session ends.\n\n              },\n              onRequestTimeout: function onRequestTimeout() {\n                _this25.onRequestTimeout(); // Do nothing because session ends.\n\n              },\n              onDialogError: function onDialogError() {\n                _this25.onDialogError(); // Do nothing because session ends.\n\n              }\n            }\n          });\n        })[\"catch\"](function () {\n          onFailed.call(_this25);\n        });\n      } // No SDP.\n      else {\n          this.sendRequest(JsSIP_C.UPDATE, {\n            extraHeaders: extraHeaders,\n            eventHandlers: {\n              onSuccessResponse: function onSuccessResponse(response) {\n                onSucceeded.call(_this25, response);\n              },\n              onErrorResponse: function onErrorResponse(response) {\n                onFailed.call(_this25, response);\n              },\n              onTransportError: function onTransportError() {\n                _this25.onTransportError(); // Do nothing because session ends.\n\n              },\n              onRequestTimeout: function onRequestTimeout() {\n                _this25.onRequestTimeout(); // Do nothing because session ends.\n\n              },\n              onDialogError: function onDialogError() {\n                _this25.onDialogError(); // Do nothing because session ends.\n\n              }\n            }\n          });\n        }\n\n      function onSucceeded(response) {\n        var _this26 = this;\n\n        if (this._status === C.STATUS_TERMINATED) {\n          return;\n        } // If it is a 2XX retransmission exit now.\n\n\n        if (succeeded) {\n          return;\n        } // Handle Session Timers.\n\n\n        this._handleSessionTimersInIncomingResponse(response); // Must have SDP answer.\n\n\n        if (sdpOffer) {\n          if (!response.body) {\n            onFailed.call(this);\n            return;\n          } else if (!response.hasHeader('Content-Type') || response.getHeader('Content-Type').toLowerCase() !== 'application/sdp') {\n            onFailed.call(this);\n            return;\n          }\n\n          var e = {\n            originator: 'remote',\n            type: 'answer',\n            sdp: response.body\n          };\n          logger.debug('emit \"sdp\"');\n          this.emit('sdp', e);\n          var answer = new RTCSessionDescription({\n            type: 'answer',\n            sdp: e.sdp\n          });\n          this._connectionPromiseQueue = this._connectionPromiseQueue.then(function () {\n            return _this26._connection.setRemoteDescription(answer);\n          }).then(function () {\n            if (eventHandlers.succeeded) {\n              eventHandlers.succeeded(response);\n            }\n          })[\"catch\"](function (error) {\n            onFailed.call(_this26);\n            logger.warn('emit \"peerconnection:setremotedescriptionfailed\" [error:%o]', error);\n\n            _this26.emit('peerconnection:setremotedescriptionfailed', error);\n          });\n        } // No SDP answer.\n        else if (eventHandlers.succeeded) {\n            eventHandlers.succeeded(response);\n          }\n      }\n\n      function onFailed(response) {\n        if (eventHandlers.failed) {\n          eventHandlers.failed(response);\n        }\n      }\n    }\n  }, {\n    key: \"_acceptAndTerminate\",\n    value: function _acceptAndTerminate(response, status_code, reason_phrase) {\n      logger.debug('acceptAndTerminate()');\n      var extraHeaders = [];\n\n      if (status_code) {\n        reason_phrase = reason_phrase || JsSIP_C.REASON_PHRASE[status_code] || '';\n        extraHeaders.push(\"Reason: SIP ;cause=\".concat(status_code, \"; text=\\\"\").concat(reason_phrase, \"\\\"\"));\n      } // An error on dialog creation will fire 'failed' event.\n\n\n      if (this._dialog || this._createDialog(response, 'UAC')) {\n        this.sendRequest(JsSIP_C.ACK);\n        this.sendRequest(JsSIP_C.BYE, {\n          extraHeaders: extraHeaders\n        });\n      } // Update session status.\n\n\n      this._status = C.STATUS_TERMINATED;\n    }\n    /**\n     * Correctly set the SDP direction attributes if the call is on local hold\n     */\n\n  }, {\n    key: \"_mangleOffer\",\n    value: function _mangleOffer(sdp) {\n      if (!this._localHold && !this._remoteHold) {\n        return sdp;\n      }\n\n      sdp = sdp_transform.parse(sdp); // Local hold.\n\n      if (this._localHold && !this._remoteHold) {\n        logger.debug('mangleOffer() | me on hold, mangling offer');\n\n        var _iterator5 = _createForOfIteratorHelper(sdp.media),\n            _step5;\n\n        try {\n          for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n            var m = _step5.value;\n\n            if (holdMediaTypes.indexOf(m.type) === -1) {\n              continue;\n            }\n\n            if (!m.direction) {\n              m.direction = 'sendonly';\n            } else if (m.direction === 'sendrecv') {\n              m.direction = 'sendonly';\n            } else if (m.direction === 'recvonly') {\n              m.direction = 'inactive';\n            }\n          }\n        } catch (err) {\n          _iterator5.e(err);\n        } finally {\n          _iterator5.f();\n        }\n      } // Local and remote hold.\n      else if (this._localHold && this._remoteHold) {\n          logger.debug('mangleOffer() | both on hold, mangling offer');\n\n          var _iterator6 = _createForOfIteratorHelper(sdp.media),\n              _step6;\n\n          try {\n            for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n              var _m = _step6.value;\n\n              if (holdMediaTypes.indexOf(_m.type) === -1) {\n                continue;\n              }\n\n              _m.direction = 'inactive';\n            }\n          } catch (err) {\n            _iterator6.e(err);\n          } finally {\n            _iterator6.f();\n          }\n        } // Remote hold.\n        else if (this._remoteHold) {\n            logger.debug('mangleOffer() | remote on hold, mangling offer');\n\n            var _iterator7 = _createForOfIteratorHelper(sdp.media),\n                _step7;\n\n            try {\n              for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {\n                var _m2 = _step7.value;\n\n                if (holdMediaTypes.indexOf(_m2.type) === -1) {\n                  continue;\n                }\n\n                if (!_m2.direction) {\n                  _m2.direction = 'recvonly';\n                } else if (_m2.direction === 'sendrecv') {\n                  _m2.direction = 'recvonly';\n                } else if (_m2.direction === 'recvonly') {\n                  _m2.direction = 'inactive';\n                }\n              }\n            } catch (err) {\n              _iterator7.e(err);\n            } finally {\n              _iterator7.f();\n            }\n          }\n\n      return sdp_transform.write(sdp);\n    }\n  }, {\n    key: \"_setLocalMediaStatus\",\n    value: function _setLocalMediaStatus() {\n      var enableAudio = true,\n          enableVideo = true;\n\n      if (this._localHold || this._remoteHold) {\n        enableAudio = false;\n        enableVideo = false;\n      }\n\n      if (this._audioMuted) {\n        enableAudio = false;\n      }\n\n      if (this._videoMuted) {\n        enableVideo = false;\n      }\n\n      this._toggleMuteAudio(!enableAudio);\n\n      this._toggleMuteVideo(!enableVideo);\n    }\n    /**\n     * Handle SessionTimers for an incoming INVITE or UPDATE.\n     * @param  {IncomingRequest} request\n     * @param  {Array} responseExtraHeaders  Extra headers for the 200 response.\n     */\n\n  }, {\n    key: \"_handleSessionTimersInIncomingRequest\",\n    value: function _handleSessionTimersInIncomingRequest(request, responseExtraHeaders) {\n      if (!this._sessionTimers.enabled) {\n        return;\n      }\n\n      var session_expires_refresher;\n\n      if (request.session_expires && request.session_expires >= JsSIP_C.MIN_SESSION_EXPIRES) {\n        this._sessionTimers.currentExpires = request.session_expires;\n        session_expires_refresher = request.session_expires_refresher || 'uas';\n      } else {\n        this._sessionTimers.currentExpires = this._sessionTimers.defaultExpires;\n        session_expires_refresher = 'uas';\n      }\n\n      responseExtraHeaders.push(\"Session-Expires: \".concat(this._sessionTimers.currentExpires, \";refresher=\").concat(session_expires_refresher));\n      this._sessionTimers.refresher = session_expires_refresher === 'uas';\n\n      this._runSessionTimer();\n    }\n    /**\n     * Handle SessionTimers for an incoming response to INVITE or UPDATE.\n     * @param  {IncomingResponse} response\n     */\n\n  }, {\n    key: \"_handleSessionTimersInIncomingResponse\",\n    value: function _handleSessionTimersInIncomingResponse(response) {\n      if (!this._sessionTimers.enabled) {\n        return;\n      }\n\n      var session_expires_refresher;\n\n      if (response.session_expires && response.session_expires >= JsSIP_C.MIN_SESSION_EXPIRES) {\n        this._sessionTimers.currentExpires = response.session_expires;\n        session_expires_refresher = response.session_expires_refresher || 'uac';\n      } else {\n        this._sessionTimers.currentExpires = this._sessionTimers.defaultExpires;\n        session_expires_refresher = 'uac';\n      }\n\n      this._sessionTimers.refresher = session_expires_refresher === 'uac';\n\n      this._runSessionTimer();\n    }\n  }, {\n    key: \"_runSessionTimer\",\n    value: function _runSessionTimer() {\n      var _this27 = this;\n\n      var expires = this._sessionTimers.currentExpires;\n      this._sessionTimers.running = true;\n      clearTimeout(this._sessionTimers.timer); // I'm the refresher.\n\n      if (this._sessionTimers.refresher) {\n        this._sessionTimers.timer = setTimeout(function () {\n          if (_this27._status === C.STATUS_TERMINATED) {\n            return;\n          }\n\n          if (!_this27._isReadyToReOffer()) {\n            return;\n          }\n\n          logger.debug('runSessionTimer() | sending session refresh request');\n\n          if (_this27._sessionTimers.refreshMethod === JsSIP_C.UPDATE) {\n            _this27._sendUpdate();\n          } else {\n            _this27._sendReinvite();\n          }\n        }, expires * 500); // Half the given interval (as the RFC states).\n      } // I'm not the refresher.\n      else {\n          this._sessionTimers.timer = setTimeout(function () {\n            if (_this27._status === C.STATUS_TERMINATED) {\n              return;\n            }\n\n            logger.warn('runSessionTimer() | timer expired, terminating the session');\n\n            _this27.terminate({\n              cause: JsSIP_C.causes.REQUEST_TIMEOUT,\n              status_code: 408,\n              reason_phrase: 'Session Timer Expired'\n            });\n          }, expires * 1100);\n        }\n    }\n  }, {\n    key: \"_toggleMuteAudio\",\n    value: function _toggleMuteAudio(mute) {\n      var senders = this._connection.getSenders().filter(function (sender) {\n        return sender.track && sender.track.kind === 'audio';\n      });\n\n      var _iterator8 = _createForOfIteratorHelper(senders),\n          _step8;\n\n      try {\n        for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {\n          var sender = _step8.value;\n          sender.track.enabled = !mute;\n        }\n      } catch (err) {\n        _iterator8.e(err);\n      } finally {\n        _iterator8.f();\n      }\n    }\n  }, {\n    key: \"_toggleMuteVideo\",\n    value: function _toggleMuteVideo(mute) {\n      var senders = this._connection.getSenders().filter(function (sender) {\n        return sender.track && sender.track.kind === 'video';\n      });\n\n      var _iterator9 = _createForOfIteratorHelper(senders),\n          _step9;\n\n      try {\n        for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {\n          var sender = _step9.value;\n          sender.track.enabled = !mute;\n        }\n      } catch (err) {\n        _iterator9.e(err);\n      } finally {\n        _iterator9.f();\n      }\n    }\n  }, {\n    key: \"_newRTCSession\",\n    value: function _newRTCSession(originator, request) {\n      logger.debug('newRTCSession()');\n\n      this._ua.newRTCSession(this, {\n        originator: originator,\n        session: this,\n        request: request\n      });\n    }\n  }, {\n    key: \"_connecting\",\n    value: function _connecting(request) {\n      logger.debug('session connecting');\n      logger.debug('emit \"connecting\"');\n      this.emit('connecting', {\n        request: request\n      });\n    }\n  }, {\n    key: \"_progress\",\n    value: function _progress(originator, response) {\n      logger.debug('session progress');\n      logger.debug('emit \"progress\"');\n      this.emit('progress', {\n        originator: originator,\n        response: response || null\n      });\n    }\n  }, {\n    key: \"_accepted\",\n    value: function _accepted(originator, message) {\n      logger.debug('session accepted');\n      this._start_time = new Date();\n      logger.debug('emit \"accepted\"');\n      this.emit('accepted', {\n        originator: originator,\n        response: message || null\n      });\n    }\n  }, {\n    key: \"_confirmed\",\n    value: function _confirmed(originator, ack) {\n      logger.debug('session confirmed');\n      this._is_confirmed = true;\n      logger.debug('emit \"confirmed\"');\n      this.emit('confirmed', {\n        originator: originator,\n        ack: ack || null\n      });\n    }\n  }, {\n    key: \"_ended\",\n    value: function _ended(originator, message, cause) {\n      logger.debug('session ended');\n      this._end_time = new Date();\n\n      this._close();\n\n      logger.debug('emit \"ended\"');\n      this.emit('ended', {\n        originator: originator,\n        message: message || null,\n        cause: cause\n      });\n    }\n  }, {\n    key: \"_failed\",\n    value: function _failed(originator, message, cause) {\n      logger.debug('session failed'); // Emit private '_failed' event first.\n\n      logger.debug('emit \"_failed\"');\n      this.emit('_failed', {\n        originator: originator,\n        message: message || null,\n        cause: cause\n      });\n\n      this._close();\n\n      logger.debug('emit \"failed\"');\n      this.emit('failed', {\n        originator: originator,\n        message: message || null,\n        cause: cause\n      });\n    }\n  }, {\n    key: \"_onhold\",\n    value: function _onhold(originator) {\n      logger.debug('session onhold');\n\n      this._setLocalMediaStatus();\n\n      logger.debug('emit \"hold\"');\n      this.emit('hold', {\n        originator: originator\n      });\n    }\n  }, {\n    key: \"_onunhold\",\n    value: function _onunhold(originator) {\n      logger.debug('session onunhold');\n\n      this._setLocalMediaStatus();\n\n      logger.debug('emit \"unhold\"');\n      this.emit('unhold', {\n        originator: originator\n      });\n    }\n  }, {\n    key: \"_onmute\",\n    value: function _onmute(_ref5) {\n      var audio = _ref5.audio,\n          video = _ref5.video;\n      logger.debug('session onmute');\n\n      this._setLocalMediaStatus();\n\n      logger.debug('emit \"muted\"');\n      this.emit('muted', {\n        audio: audio,\n        video: video\n      });\n    }\n  }, {\n    key: \"_onunmute\",\n    value: function _onunmute(_ref6) {\n      var audio = _ref6.audio,\n          video = _ref6.video;\n      logger.debug('session onunmute');\n\n      this._setLocalMediaStatus();\n\n      logger.debug('emit \"unmuted\"');\n      this.emit('unmuted', {\n        audio: audio,\n        video: video\n      });\n    }\n  }, {\n    key: \"C\",\n    get: function get() {\n      return C;\n    } // Expose session failed/ended causes as a property of the RTCSession instance.\n\n  }, {\n    key: \"causes\",\n    get: function get() {\n      return JsSIP_C.causes;\n    }\n  }, {\n    key: \"id\",\n    get: function get() {\n      return this._id;\n    }\n  }, {\n    key: \"connection\",\n    get: function get() {\n      return this._connection;\n    }\n  }, {\n    key: \"contact\",\n    get: function get() {\n      return this._contact;\n    }\n  }, {\n    key: \"direction\",\n    get: function get() {\n      return this._direction;\n    }\n  }, {\n    key: \"local_identity\",\n    get: function get() {\n      return this._local_identity;\n    }\n  }, {\n    key: \"remote_identity\",\n    get: function get() {\n      return this._remote_identity;\n    }\n  }, {\n    key: \"start_time\",\n    get: function get() {\n      return this._start_time;\n    }\n  }, {\n    key: \"end_time\",\n    get: function get() {\n      return this._end_time;\n    }\n  }, {\n    key: \"data\",\n    get: function get() {\n      return this._data;\n    },\n    set: function set(_data) {\n      this._data = _data;\n    }\n  }, {\n    key: \"status\",\n    get: function get() {\n      return this._status;\n    }\n  }]);\n\n  return RTCSession;\n}(EventEmitter);"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}