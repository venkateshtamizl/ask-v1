{"ast":null,"code":"var grammar = require('./grammar');\n\n// customized util.format - discards excess arguments and can void middle ones\nvar formatRegExp = /%[sdv%]/g;\nvar format = function (formatStr) {\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  return formatStr.replace(formatRegExp, function (x) {\n    if (i >= len) {\n      return x; // missing argument\n    }\n    var arg = args[i];\n    i += 1;\n    switch (x) {\n      case '%%':\n        return '%';\n      case '%s':\n        return String(arg);\n      case '%d':\n        return Number(arg);\n      case '%v':\n        return '';\n    }\n  });\n  // NB: we discard excess arguments - they are typically undefined from makeLine\n};\nvar makeLine = function (type, obj, location) {\n  var str = obj.format instanceof Function ? obj.format(obj.push ? location : location[obj.name]) : obj.format;\n  var args = [type + '=' + str];\n  if (obj.names) {\n    for (var i = 0; i < obj.names.length; i += 1) {\n      var n = obj.names[i];\n      if (obj.name) {\n        args.push(location[obj.name][n]);\n      } else {\n        // for mLine and push attributes\n        args.push(location[obj.names[i]]);\n      }\n    }\n  } else {\n    args.push(location[obj.name]);\n  }\n  return format.apply(null, args);\n};\n\n// RFC specified order\n// TODO: extend this with all the rest\nvar defaultOuterOrder = ['v', 'o', 's', 'i', 'u', 'e', 'p', 'c', 'b', 't', 'r', 'z', 'a'];\nvar defaultInnerOrder = ['i', 'c', 'b', 'a'];\nmodule.exports = function (session, opts) {\n  opts = opts || {};\n  // ensure certain properties exist\n  if (session.version == null) {\n    session.version = 0; // 'v=0' must be there (only defined version atm)\n  }\n  if (session.name == null) {\n    session.name = ' '; // 's= ' must be there if no meaningful name set\n  }\n  session.media.forEach(function (mLine) {\n    if (mLine.payloads == null) {\n      mLine.payloads = '';\n    }\n  });\n  var outerOrder = opts.outerOrder || defaultOuterOrder;\n  var innerOrder = opts.innerOrder || defaultInnerOrder;\n  var sdp = [];\n\n  // loop through outerOrder for matching properties on session\n  outerOrder.forEach(function (type) {\n    grammar[type].forEach(function (obj) {\n      if (obj.name in session && session[obj.name] != null) {\n        sdp.push(makeLine(type, obj, session));\n      } else if (obj.push in session && session[obj.push] != null) {\n        session[obj.push].forEach(function (el) {\n          sdp.push(makeLine(type, obj, el));\n        });\n      }\n    });\n  });\n\n  // then for each media line, follow the innerOrder\n  session.media.forEach(function (mLine) {\n    sdp.push(makeLine('m', grammar.m[0], mLine));\n    innerOrder.forEach(function (type) {\n      grammar[type].forEach(function (obj) {\n        if (obj.name in mLine && mLine[obj.name] != null) {\n          sdp.push(makeLine(type, obj, mLine));\n        } else if (obj.push in mLine && mLine[obj.push] != null) {\n          mLine[obj.push].forEach(function (el) {\n            sdp.push(makeLine(type, obj, el));\n          });\n        }\n      });\n    });\n  });\n  return sdp.join('\\r\\n') + '\\r\\n';\n};","map":{"version":3,"names":["grammar","require","formatRegExp","format","formatStr","i","args","arguments","len","length","replace","x","arg","String","Number","makeLine","type","obj","location","str","Function","push","name","names","n","apply","defaultOuterOrder","defaultInnerOrder","module","exports","session","opts","version","media","forEach","mLine","payloads","outerOrder","innerOrder","sdp","el","m","join"],"sources":["/etc/asterisk/webrtc-phone/node_modules/sdp-transform/lib/writer.js"],"sourcesContent":["var grammar = require('./grammar');\n\n// customized util.format - discards excess arguments and can void middle ones\nvar formatRegExp = /%[sdv%]/g;\nvar format = function (formatStr) {\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  return formatStr.replace(formatRegExp, function (x) {\n    if (i >= len) {\n      return x; // missing argument\n    }\n    var arg = args[i];\n    i += 1;\n    switch (x) {\n    case '%%':\n      return '%';\n    case '%s':\n      return String(arg);\n    case '%d':\n      return Number(arg);\n    case '%v':\n      return '';\n    }\n  });\n  // NB: we discard excess arguments - they are typically undefined from makeLine\n};\n\nvar makeLine = function (type, obj, location) {\n  var str = obj.format instanceof Function ?\n    (obj.format(obj.push ? location : location[obj.name])) :\n    obj.format;\n\n  var args = [type + '=' + str];\n  if (obj.names) {\n    for (var i = 0; i < obj.names.length; i += 1) {\n      var n = obj.names[i];\n      if (obj.name) {\n        args.push(location[obj.name][n]);\n      }\n      else { // for mLine and push attributes\n        args.push(location[obj.names[i]]);\n      }\n    }\n  }\n  else {\n    args.push(location[obj.name]);\n  }\n  return format.apply(null, args);\n};\n\n// RFC specified order\n// TODO: extend this with all the rest\nvar defaultOuterOrder = [\n  'v', 'o', 's', 'i',\n  'u', 'e', 'p', 'c',\n  'b', 't', 'r', 'z', 'a'\n];\nvar defaultInnerOrder = ['i', 'c', 'b', 'a'];\n\n\nmodule.exports = function (session, opts) {\n  opts = opts || {};\n  // ensure certain properties exist\n  if (session.version == null) {\n    session.version = 0; // 'v=0' must be there (only defined version atm)\n  }\n  if (session.name == null) {\n    session.name = ' '; // 's= ' must be there if no meaningful name set\n  }\n  session.media.forEach(function (mLine) {\n    if (mLine.payloads == null) {\n      mLine.payloads = '';\n    }\n  });\n\n  var outerOrder = opts.outerOrder || defaultOuterOrder;\n  var innerOrder = opts.innerOrder || defaultInnerOrder;\n  var sdp = [];\n\n  // loop through outerOrder for matching properties on session\n  outerOrder.forEach(function (type) {\n    grammar[type].forEach(function (obj) {\n      if (obj.name in session && session[obj.name] != null) {\n        sdp.push(makeLine(type, obj, session));\n      }\n      else if (obj.push in session && session[obj.push] != null) {\n        session[obj.push].forEach(function (el) {\n          sdp.push(makeLine(type, obj, el));\n        });\n      }\n    });\n  });\n\n  // then for each media line, follow the innerOrder\n  session.media.forEach(function (mLine) {\n    sdp.push(makeLine('m', grammar.m[0], mLine));\n\n    innerOrder.forEach(function (type) {\n      grammar[type].forEach(function (obj) {\n        if (obj.name in mLine && mLine[obj.name] != null) {\n          sdp.push(makeLine(type, obj, mLine));\n        }\n        else if (obj.push in mLine && mLine[obj.push] != null) {\n          mLine[obj.push].forEach(function (el) {\n            sdp.push(makeLine(type, obj, el));\n          });\n        }\n      });\n    });\n  });\n\n  return sdp.join('\\r\\n') + '\\r\\n';\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}