{"ast":null,"code":"\"use strict\";\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\nvar JsSIP_C = require('../Constants');\nvar Transactions = require('../Transactions');\nvar RequestSender = require('../RequestSender'); // Default event handlers.\n\nvar EventHandlers = {\n  onRequestTimeout: function onRequestTimeout() {},\n  onTransportError: function onTransportError() {},\n  onSuccessResponse: function onSuccessResponse() {},\n  onErrorResponse: function onErrorResponse() {},\n  onAuthenticated: function onAuthenticated() {},\n  onDialogError: function onDialogError() {}\n};\nmodule.exports = /*#__PURE__*/function () {\n  function DialogRequestSender(dialog, request, eventHandlers) {\n    _classCallCheck(this, DialogRequestSender);\n    this._dialog = dialog;\n    this._ua = dialog._ua;\n    this._request = request;\n    this._eventHandlers = eventHandlers; // RFC3261 14.1 Modifying an Existing Session. UAC Behavior.\n\n    this._reattempt = false;\n    this._reattemptTimer = null; // Define the undefined handlers.\n\n    for (var handler in EventHandlers) {\n      if (Object.prototype.hasOwnProperty.call(EventHandlers, handler)) {\n        if (!this._eventHandlers[handler]) {\n          this._eventHandlers[handler] = EventHandlers[handler];\n        }\n      }\n    }\n  }\n  _createClass(DialogRequestSender, [{\n    key: \"send\",\n    value: function send() {\n      var _this = this;\n      var request_sender = new RequestSender(this._ua, this._request, {\n        onRequestTimeout: function onRequestTimeout() {\n          _this._eventHandlers.onRequestTimeout();\n        },\n        onTransportError: function onTransportError() {\n          _this._eventHandlers.onTransportError();\n        },\n        onAuthenticated: function onAuthenticated(request) {\n          _this._eventHandlers.onAuthenticated(request);\n        },\n        onReceiveResponse: function onReceiveResponse(response) {\n          _this._receiveResponse(response);\n        }\n      });\n      request_sender.send(); // RFC3261 14.2 Modifying an Existing Session -UAC BEHAVIOR-.\n\n      if ((this._request.method === JsSIP_C.INVITE || this._request.method === JsSIP_C.UPDATE && this._request.body) && request_sender.clientTransaction.state !== Transactions.C.STATUS_TERMINATED) {\n        this._dialog.uac_pending_reply = true;\n        var stateChanged = function stateChanged() {\n          if (request_sender.clientTransaction.state === Transactions.C.STATUS_ACCEPTED || request_sender.clientTransaction.state === Transactions.C.STATUS_COMPLETED || request_sender.clientTransaction.state === Transactions.C.STATUS_TERMINATED) {\n            request_sender.clientTransaction.removeListener('stateChanged', stateChanged);\n            _this._dialog.uac_pending_reply = false;\n          }\n        };\n        request_sender.clientTransaction.on('stateChanged', stateChanged);\n      }\n    }\n  }, {\n    key: \"_receiveResponse\",\n    value: function _receiveResponse(response) {\n      var _this2 = this;\n\n      // RFC3261 12.2.1.2 408 or 481 is received for a request within a dialog.\n      if (response.status_code === 408 || response.status_code === 481) {\n        this._eventHandlers.onDialogError(response);\n      } else if (response.method === JsSIP_C.INVITE && response.status_code === 491) {\n        if (this._reattempt) {\n          if (response.status_code >= 200 && response.status_code < 300) {\n            this._eventHandlers.onSuccessResponse(response);\n          } else if (response.status_code >= 300) {\n            this._eventHandlers.onErrorResponse(response);\n          }\n        } else {\n          this._request.cseq = this._dialog.local_seqnum += 1;\n          this._reattemptTimer = setTimeout(function () {\n            if (!_this2._dialog.isTerminated()) {\n              _this2._reattempt = true;\n              _this2.send();\n            }\n          }, 1000);\n        }\n      } else if (response.status_code >= 200 && response.status_code < 300) {\n        this._eventHandlers.onSuccessResponse(response);\n      } else if (response.status_code >= 300) {\n        this._eventHandlers.onErrorResponse(response);\n      }\n    }\n  }, {\n    key: \"request\",\n    get: function get() {\n      return this._request;\n    }\n  }]);\n  return DialogRequestSender;\n}();","map":{"version":3,"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","JsSIP_C","require","Transactions","RequestSender","EventHandlers","onRequestTimeout","onTransportError","onSuccessResponse","onErrorResponse","onAuthenticated","onDialogError","module","exports","DialogRequestSender","dialog","request","eventHandlers","_dialog","_ua","_request","_eventHandlers","_reattempt","_reattemptTimer","handler","hasOwnProperty","call","value","send","_this","request_sender","onReceiveResponse","response","_receiveResponse","method","INVITE","UPDATE","body","clientTransaction","state","C","STATUS_TERMINATED","uac_pending_reply","stateChanged","STATUS_ACCEPTED","STATUS_COMPLETED","removeListener","on","_this2","status_code","cseq","local_seqnum","setTimeout","isTerminated","get"],"sources":["/app/node_modules/jssip/lib-es5/Dialog/RequestSender.js"],"sourcesContent":["\"use strict\";\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar JsSIP_C = require('../Constants');\n\nvar Transactions = require('../Transactions');\n\nvar RequestSender = require('../RequestSender'); // Default event handlers.\n\n\nvar EventHandlers = {\n  onRequestTimeout: function onRequestTimeout() {},\n  onTransportError: function onTransportError() {},\n  onSuccessResponse: function onSuccessResponse() {},\n  onErrorResponse: function onErrorResponse() {},\n  onAuthenticated: function onAuthenticated() {},\n  onDialogError: function onDialogError() {}\n};\n\nmodule.exports = /*#__PURE__*/function () {\n  function DialogRequestSender(dialog, request, eventHandlers) {\n    _classCallCheck(this, DialogRequestSender);\n\n    this._dialog = dialog;\n    this._ua = dialog._ua;\n    this._request = request;\n    this._eventHandlers = eventHandlers; // RFC3261 14.1 Modifying an Existing Session. UAC Behavior.\n\n    this._reattempt = false;\n    this._reattemptTimer = null; // Define the undefined handlers.\n\n    for (var handler in EventHandlers) {\n      if (Object.prototype.hasOwnProperty.call(EventHandlers, handler)) {\n        if (!this._eventHandlers[handler]) {\n          this._eventHandlers[handler] = EventHandlers[handler];\n        }\n      }\n    }\n  }\n\n  _createClass(DialogRequestSender, [{\n    key: \"send\",\n    value: function send() {\n      var _this = this;\n\n      var request_sender = new RequestSender(this._ua, this._request, {\n        onRequestTimeout: function onRequestTimeout() {\n          _this._eventHandlers.onRequestTimeout();\n        },\n        onTransportError: function onTransportError() {\n          _this._eventHandlers.onTransportError();\n        },\n        onAuthenticated: function onAuthenticated(request) {\n          _this._eventHandlers.onAuthenticated(request);\n        },\n        onReceiveResponse: function onReceiveResponse(response) {\n          _this._receiveResponse(response);\n        }\n      });\n      request_sender.send(); // RFC3261 14.2 Modifying an Existing Session -UAC BEHAVIOR-.\n\n      if ((this._request.method === JsSIP_C.INVITE || this._request.method === JsSIP_C.UPDATE && this._request.body) && request_sender.clientTransaction.state !== Transactions.C.STATUS_TERMINATED) {\n        this._dialog.uac_pending_reply = true;\n\n        var stateChanged = function stateChanged() {\n          if (request_sender.clientTransaction.state === Transactions.C.STATUS_ACCEPTED || request_sender.clientTransaction.state === Transactions.C.STATUS_COMPLETED || request_sender.clientTransaction.state === Transactions.C.STATUS_TERMINATED) {\n            request_sender.clientTransaction.removeListener('stateChanged', stateChanged);\n            _this._dialog.uac_pending_reply = false;\n          }\n        };\n\n        request_sender.clientTransaction.on('stateChanged', stateChanged);\n      }\n    }\n  }, {\n    key: \"_receiveResponse\",\n    value: function _receiveResponse(response) {\n      var _this2 = this;\n\n      // RFC3261 12.2.1.2 408 or 481 is received for a request within a dialog.\n      if (response.status_code === 408 || response.status_code === 481) {\n        this._eventHandlers.onDialogError(response);\n      } else if (response.method === JsSIP_C.INVITE && response.status_code === 491) {\n        if (this._reattempt) {\n          if (response.status_code >= 200 && response.status_code < 300) {\n            this._eventHandlers.onSuccessResponse(response);\n          } else if (response.status_code >= 300) {\n            this._eventHandlers.onErrorResponse(response);\n          }\n        } else {\n          this._request.cseq = this._dialog.local_seqnum += 1;\n          this._reattemptTimer = setTimeout(function () {\n            if (!_this2._dialog.isTerminated()) {\n              _this2._reattempt = true;\n\n              _this2.send();\n            }\n          }, 1000);\n        }\n      } else if (response.status_code >= 200 && response.status_code < 300) {\n        this._eventHandlers.onSuccessResponse(response);\n      } else if (response.status_code >= 300) {\n        this._eventHandlers.onErrorResponse(response);\n      }\n    }\n  }, {\n    key: \"request\",\n    get: function get() {\n      return this._request;\n    }\n  }]);\n\n  return DialogRequestSender;\n}();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}