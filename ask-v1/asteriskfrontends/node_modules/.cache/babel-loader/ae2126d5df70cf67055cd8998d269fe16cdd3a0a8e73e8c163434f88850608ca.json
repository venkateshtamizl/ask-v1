{"ast":null,"code":"\"use strict\";\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\nvar Logger = require('../Logger');\nvar JsSIP_C = require('../Constants');\nvar logger = new Logger('RTCSession:ReferNotifier');\nvar C = {\n  event_type: 'refer',\n  body_type: 'message/sipfrag;version=2.0',\n  expires: 300\n};\nmodule.exports = /*#__PURE__*/function () {\n  function ReferNotifier(session, id, expires) {\n    _classCallCheck(this, ReferNotifier);\n    this._session = session;\n    this._id = id;\n    this._expires = expires || C.expires;\n    this._active = true; // The creation of a Notifier results in an immediate NOTIFY.\n\n    this.notify(100);\n  }\n  _createClass(ReferNotifier, [{\n    key: \"notify\",\n    value: function notify(code, reason) {\n      logger.debug('notify()');\n      if (this._active === false) {\n        return;\n      }\n      reason = reason || JsSIP_C.REASON_PHRASE[code] || '';\n      var state;\n      if (code >= 200) {\n        state = 'terminated;reason=noresource';\n      } else {\n        state = \"active;expires=\".concat(this._expires);\n      } // Put this in a try/catch block.\n\n      this._session.sendRequest(JsSIP_C.NOTIFY, {\n        extraHeaders: [\"Event: \".concat(C.event_type, \";id=\").concat(this._id), \"Subscription-State: \".concat(state), \"Content-Type: \".concat(C.body_type)],\n        body: \"SIP/2.0 \".concat(code, \" \").concat(reason),\n        eventHandlers: {\n          // If a negative response is received, subscription is canceled.\n          onErrorResponse: function onErrorResponse() {\n            this._active = false;\n          }\n        }\n      });\n    }\n  }]);\n  return ReferNotifier;\n}();","map":{"version":3,"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","Logger","require","JsSIP_C","logger","C","event_type","body_type","expires","module","exports","ReferNotifier","session","id","_session","_id","_expires","_active","notify","value","code","reason","debug","REASON_PHRASE","state","concat","sendRequest","NOTIFY","extraHeaders","body","eventHandlers","onErrorResponse"],"sources":["/app/node_modules/jssip/lib-es5/RTCSession/ReferNotifier.js"],"sourcesContent":["\"use strict\";\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar Logger = require('../Logger');\n\nvar JsSIP_C = require('../Constants');\n\nvar logger = new Logger('RTCSession:ReferNotifier');\nvar C = {\n  event_type: 'refer',\n  body_type: 'message/sipfrag;version=2.0',\n  expires: 300\n};\n\nmodule.exports = /*#__PURE__*/function () {\n  function ReferNotifier(session, id, expires) {\n    _classCallCheck(this, ReferNotifier);\n\n    this._session = session;\n    this._id = id;\n    this._expires = expires || C.expires;\n    this._active = true; // The creation of a Notifier results in an immediate NOTIFY.\n\n    this.notify(100);\n  }\n\n  _createClass(ReferNotifier, [{\n    key: \"notify\",\n    value: function notify(code, reason) {\n      logger.debug('notify()');\n\n      if (this._active === false) {\n        return;\n      }\n\n      reason = reason || JsSIP_C.REASON_PHRASE[code] || '';\n      var state;\n\n      if (code >= 200) {\n        state = 'terminated;reason=noresource';\n      } else {\n        state = \"active;expires=\".concat(this._expires);\n      } // Put this in a try/catch block.\n\n\n      this._session.sendRequest(JsSIP_C.NOTIFY, {\n        extraHeaders: [\"Event: \".concat(C.event_type, \";id=\").concat(this._id), \"Subscription-State: \".concat(state), \"Content-Type: \".concat(C.body_type)],\n        body: \"SIP/2.0 \".concat(code, \" \").concat(reason),\n        eventHandlers: {\n          // If a negative response is received, subscription is canceled.\n          onErrorResponse: function onErrorResponse() {\n            this._active = false;\n          }\n        }\n      });\n    }\n  }]);\n\n  return ReferNotifier;\n}();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}